<!DOCTYPE html><html lang="en">
<!-- Mirrored from overiq.com/django-1-10/django-logging-users-in-and-out/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:05:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"/>
<script>var __ezHttpConsent={setByCat:function(src,tagType,attributes,category,force){var setScript=function(){if(force||window.ezTcfConsent[category]){var scriptElement=document.createElement(tagType);scriptElement.src=src;attributes.forEach(function(attr){for(var key in attr){if(attr.hasOwnProperty(key)){scriptElement.setAttribute(key,attr[key]);}}});var firstScript=document.getElementsByTagName(tagType)[0];firstScript.parentNode.insertBefore(scriptElement,firstScript);}};if(force||(window.ezTcfConsent&&window.ezTcfConsent.loaded)){setScript();}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){setScript();}else{console.error("cannot get ez consent data");force=true;setScript();}});}else{force=true;setScript();console.error("getEzConsentData is not a function");}},};</script>
<script>var ezTcfConsent=window.ezTcfConsent?window.ezTcfConsent:{loaded:false,store_info:false,develop_and_improve_services:false,measure_ad_performance:false,measure_content_performance:false,select_basic_ads:false,create_ad_profile:false,select_personalized_ads:false,create_content_profile:false,select_personalized_content:false,understand_audiences:false,use_limited_data_to_select_content:false,};function getEzConsentData(){return new Promise(function(resolve){document.addEventListener("ezConsentEvent",function(event){var ezTcfConsent=event.detail.ezTcfConsent;resolve(ezTcfConsent);});});}</script>
<script>if(typeof _setEzCookies!=='function'){function _setEzCookies(ezConsentData){var cookies=window.ezCookieQueue;for(var i=0;i<cookies.length;i++){var cookie=cookies[i];if(ezConsentData&&ezConsentData.loaded&&ezConsentData[cookie.tcfCategory]){document.cookie=cookie.name+"="+cookie.value;}}}}
window.ezCookieQueue=window.ezCookieQueue||[];if(typeof addEzCookies!=='function'){function addEzCookies(arr){window.ezCookieQueue=[...window.ezCookieQueue,...arr];}}
addEzCookies([]);if(window.ezTcfConsent&&window.ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else{console.error("cannot get ez consent data");_setEzCookies(window.ezTcfConsent);}});}else{console.error("getEzConsentData is not a function");_setEzCookies(window.ezTcfConsent);}</script>
<script data-ezscrex='false' data-cfasync='false' data-pagespeed-no-defer>var __ez=__ez||{};__ez.stms=Date.now();__ez.evt={};__ez.script={};__ez.ck=__ez.ck||{};__ez.template={};__ez.template.isOrig=true;window.__ezScriptHost="//www.ezojs.com";__ez.queue=__ez.queue||function(){var e=0,i=0,t=[],n=!1,o=[],r=[],s=!0,a=function(e,i,n,o,r,s,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,d=this;this.name=e,this.funcName=i,this.parameters=null===n?null:w(n)?n:[n],this.isBlock=o,this.blockedBy=r,this.deleteWhenComplete=s,this.isError=!1,this.isComplete=!1,this.isInitialized=!1,this.proceedIfError=a,this.fWindow=l,this.isTimeDelay=!1,this.process=function(){f("... func = "+e),d.isInitialized=!0,d.isComplete=!0,f("... func.apply: "+e);var i=d.funcName.split("."),n=null,o=this.fWindow||window;i.length>3||(n=3===i.length?o[i[0]][i[1]][i[2]]:2===i.length?o[i[0]][i[1]]:o[d.funcName]),null!=n&&n.apply(null,this.parameters),!0===d.deleteWhenComplete&&delete t[e],!0===d.isBlock&&(f("----- F'D: "+d.name),m())}},l=function(e,i,t,n,o,r,s){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,l=this;this.name=e,this.path=i,this.async=o,this.defer=r,this.isBlock=t,this.blockedBy=n,this.isInitialized=!1,this.isError=!1,this.isComplete=!1,this.proceedIfError=s,this.fWindow=a,this.isTimeDelay=!1,this.isPath=function(e){return"/"===e[0]&&"/"!==e[1]},this.getSrc=function(e){return void 0!==window.__ezScriptHost&&this.isPath(e)&&"banger.js"!==this.name?window.__ezScriptHost+e:e},this.process=function(){l.isInitialized=!0,f("... file = "+e);var i=this.fWindow?this.fWindow.document:document,t=i.createElement("script");t.src=this.getSrc(this.path),!0===o?t.async=!0:!0===r&&(t.defer=!0),t.onerror=function(){var e={url:window.location.href,name:l.name,path:l.path,user_agent:window.navigator.userAgent};"undefined"!=typeof _ezaq&&(e.pageview_id=_ezaq.page_view_id);var i=encodeURIComponent(JSON.stringify(e)),t=new XMLHttpRequest;t.open("GET/index.html","//g.ezoic.net/ezqlog?d="+i,!0),t.send(),f("----- ERR'D: "+l.name),l.isError=!0,!0===l.isBlock&&m()},t.onreadystatechange=t.onload=function(){var e=t.readyState;f("----- F'D: "+l.name),e&&!/loaded|complete/.test(e)||(l.isComplete=!0,!0===l.isBlock&&m())},i.getElementsByTagName("head")[0].appendChild(t)}},d=function(e,i){this.name=e,this.path="",this.async=!1,this.defer=!1,this.isBlock=!1,this.blockedBy=[],this.isInitialized=!0,this.isError=!1,this.isComplete=i,this.proceedIfError=!1,this.isTimeDelay=!1,this.process=function(){}};function c(e,i,n,s,a,d,c,u,f){var m=new l(e,i,n,s,a,d,c,f);!0===u?o[e]=m:r[e]=m,t[e]=m,h(m)}function h(e){!0!==u(e)&&0!=s&&e.process()}function u(e){if(!0===e.isTimeDelay&&!1===n)return f(e.name+" blocked = TIME DELAY!"),!0;if(w(e.blockedBy))for(var i=0;i<e.blockedBy.length;i++){var o=e.blockedBy[i];if(!1===t.hasOwnProperty(o))return f(e.name+" blocked = "+o),!0;if(!0===e.proceedIfError&&!0===t[o].isError)return!1;if(!1===t[o].isComplete)return f(e.name+" blocked = "+o),!0}return!1}function f(e){var i=window.location.href,t=new RegExp("[?&]ezq=([^&#]*)","i").exec(i);"1"===(t?t[1]:null)&&console.debug(e)}function m(){++e>200||(f("let's go"),p(o),p(r))}function p(e){for(var i in e)if(!1!==e.hasOwnProperty(i)){var t=e[i];!0===t.isComplete||u(t)||!0===t.isInitialized||!0===t.isError?!0===t.isError?f(t.name+": error"):!0===t.isComplete?f(t.name+": complete already"):!0===t.isInitialized&&f(t.name+": initialized already"):t.process()}}function w(e){return"[object Array]"==Object.prototype.toString.call(e)}return window.addEventListener("load",(function(){setTimeout((function(){n=!0,f("TDELAY -----"),m()}),5e3)}),!1),{addFile:c,addFileOnce:function(e,i,n,o,r,s,a,l,d){t[e]||c(e,i,n,o,r,s,a,l,d)},addDelayFile:function(e,i){var n=new l(e,i,!1,[],!1,!1,!0);n.isTimeDelay=!0,f(e+" ...  FILE! TDELAY"),r[e]=n,t[e]=n,h(n)},addFunc:function(e,n,s,l,d,c,u,f,m,p){!0===c&&(e=e+"_"+i++);var w=new a(e,n,s,l,d,u,f,p);!0===m?o[e]=w:r[e]=w,t[e]=w,h(w)},addDelayFunc:function(e,i,n){var o=new a(e,i,n,!1,[],!0,!0);o.isTimeDelay=!0,f(e+" ...  FUNCTION! TDELAY"),r[e]=o,t[e]=o,h(o)},items:t,processAll:m,setallowLoad:function(e){s=e},markLoaded:function(e){if(e&&0!==e.length){if(e in t){var i=t[e];!0===i.isComplete?f(i.name+" "+e+": error loaded duplicate"):(i.isComplete=!0,i.isInitialized=!0)}else t[e]=new d(e,!0);f("markLoaded dummyfile: "+t[e].name)}},logWhatsBlocked:function(){for(var e in t)!1!==t.hasOwnProperty(e)&&u(t[e])}}}();__ez.evt.add=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n()},__ez.evt.remove=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):delete e["on"+t]};__ez.script.add=function(e){var t=document.createElement("script");t.src=e,t.async=!0,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t)};__ez.dot={};__ez.queue.addFile('../../detroitchicago/boise.js', '../../detroitchicago/boisebb26.js?gcb=195-3&amp;cb=5', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/abilene.js', '../../parsonsmaize/abilenec0f9.js?gcb=195-3&amp;cb=7f81d60744', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/mulvane.js', '../../parsonsmaize/mulvane2d63.js?gcb=195-3&amp;cb=e75e48eec0', true, ['/parsonsmaize/abilene.js'], true, false, true, false);__ez.queue.addFile('../../detroitchicago/birmingham.js', '../../detroitchicago/birminghame7ec.js?gcb=195-3&amp;cb=539c47377c', true, ['/parsonsmaize/abilene.js'], true, false, true, false);</script>
<script data-ezscrex="false" type="text/javascript" data-cfasync="false">window._ezaq = Object.assign({"ad_cache_level":1,"adpicker_placement_cnt":0,"ai_placeholder_cache_level":1,"ai_placeholder_placement_cnt":-1,"domain_id":92771,"ezcache_level":1,"ezcache_skip_code":0,"has_bad_image":0,"has_bad_words":0,"is_sitespeed":0,"lt_cache_level":0,"response_size":83617,"response_size_orig":77849,"response_time_orig":866,"template_id":5,"url":"https://overiq.com/django-1-10/django-logging-users-in-and-out/","word_count":0,"worst_bad_word_level":0}, typeof window._ezaq !== "undefined" ? window._ezaq : {});__ez.queue.markLoaded('ezaqBaseReady');</script>
<script type='text/javascript' data-ezscrex='false' data-cfasync='false'>
window.ezAnalyticsStatic = true;

function analyticsAddScript(script) {
	var ezDynamic = document.createElement('script');
	ezDynamic.type = 'text/javascript';
	ezDynamic.innerHTML = script;
	document.head.appendChild(ezDynamic);
}
function getCookiesWithPrefix() {
    var allCookies = document.cookie.split(';');
    var cookiesWithPrefix = {};

    for (var i = 0; i < allCookies.length; i++) {
        var cookie = allCookies[i].trim();

        for (var j = 0; j < arguments.length; j++) {
            var prefix = arguments[j];
            if (cookie.indexOf(prefix) === 0) {
                var cookieParts = cookie.split('=');
                var cookieName = cookieParts[0];
                var cookieValue = cookieParts.slice(1).join('=');
                cookiesWithPrefix[cookieName] = decodeURIComponent(cookieValue);
                break; // Once matched, no need to check other prefixes
            }
        }
    }

    return cookiesWithPrefix;
}
function productAnalytics() {
	var d = {"pr":[6],"omd5":"0db2b39cd7ed453658288796823f7786"};
	d.u = _ezaq.url;
	d.p = _ezaq.page_view_id;
	d.v = _ezaq.visit_uuid;
	d.ab = _ezaq.ab_test_id;
	d.e = JSON.stringify(_ezaq);
	d.ref = document.referrer;
	d.c = getCookiesWithPrefix('active_template', 'ez', 'lp_');
	if(typeof ez_utmParams !== 'undefined') {
		d.utm = ez_utmParams;
	}

	var dataText = JSON.stringify(d);
	var xhr = new XMLHttpRequest();
	xhr.open('POST/index.html','/ezais/analytics?cb=1', true);
	xhr.onload = function () {
		if (xhr.status!=200) {
            return;
		}

        if(document.readyState !== 'loading') {
            analyticsAddScript(xhr.response);
            return;
        }

        var eventFunc = function() {
            if(document.readyState === 'loading') {
                return;
            }
            document.removeEventListener('readystatechange', eventFunc, false);
            analyticsAddScript(xhr.response);
        };

        document.addEventListener('readystatechange', eventFunc, false);
	};
	xhr.setRequestHeader('Content-Type','text/plain');
	xhr.send(dataText);
}
__ez.queue.addFunc("productAnalytics", "productAnalytics", null, true, ['ezaqBaseReady'], false, false, false, true);
</script><base />
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Django Logging Users In and Out - Django 1.10 Tutorial - OverIQ.com</title>

    
    



    <meta name="description" content="Django provides built-in URL patterns and view functions which makes adding login and logout system to your site a breeze. But before we add them to …"/>



    <link rel="canonical" href="index.html"/>


<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Django Logging Users In and Out"/>

    <meta property="og:description" content="Django provides built-in URL patterns and view functions which makes adding login and logout system to your site a breeze. But before we add them to …"/>


<meta property="og:url" content="https://overiq.com/django-1-10/django-logging-users-in-and-out/"/>
<meta property="og:site_name" content="OverIQ.com"/>


<meta property="article:publisher" content="https://www.facebook.com/OverIQ/"/>



<meta name="twitter:card" content="summary_large_image"/>

    <meta name="twitter:description" content="Django provides built-in URL patterns and view functions which makes adding login and logout system to your site a breeze. But before we add them to …"/>


<meta name="twitter:title" content="Django Logging Users In and Out"/>
<meta name="twitter:site" content="@infoOverIQ"/>

<meta name="twitter:creator" content="@infoOverIQ"/>




    
    
    


    
    
    


    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../feed.xml/index.html"/>
    
    
    <link href="../../../fonts.googleapis.com/cssd2d5.css?family=Open+Sans" rel="stylesheet"/>
    <link rel="stylesheet" href="../../../maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="icon" href="../../static/wiki/favicon.png" sizes="32x32"/>

    <link rel="stylesheet" href="../../static/CACHE/css/output.db46da465a8b.css" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-125424793-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125424793-1');
    </script>


<script type='text/javascript'>
var ezoTemplate = 'orig_site';
var ezouid = '1';
var ezoFormfactor = '1';
</script><script data-ezscrex="false" type='text/javascript'>
var soc_app_id = '0';
var did = 92771;
var ezdomain = 'overiq.com';
var ezoicSearchable = 1;
</script></head>
<body>

<div class="overiq-header text-center">
    <div class="site-branding">
        <p class="main-title">
            <a href="../../index.html" rel="home">
                OverIQ.com
            </a>
        </p>
    </div>
</div>

<!-- Navigation -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html">Home</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                

                <li>
                    <a href="../../blog/index.html">Blog</a>
                </li>
                <li>
                    <a href="../../contact/index.html">Contact</a>
                </li>
                <li>
                    <a href="../../about/index.html">About</a>
                </li>
            </ul>

            <ul class="nav navbar-nav navbar-right visible-lg visible-md">
                <li>
                    <a href="../../feed.xml/index.html" title="RSS" target="_blank">
                        <i class="fa fa-rss fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/overiq/" target="_blank" title="Github">
                        <i class="fa fa-github fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://www.facebook.com/OverIQ/" target="_blank" title="Facebook">
                        <i class="fa fa-facebook fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://twitter.com/infoOverIQ" target="_blank" title="Twitter">
                        <i class="fa fa-twitter fa-lg" aria-hidden="true"></i>
                    </a>
                </li>

                

            </ul>

            <form action="https://overiq.com/search/" class="navbar-form navbar-left" role="search">

                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search" name="query" value=""/>
                </div>

                <button type="submit" class="btn btn-default">Submit</button>
            </form>

        </div>



        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<div class="container">

    


    <div class="se-pre-con"></div>

    

    <div class="row">

        
        <div class="main">
            <div class="col-lg-8 col-md-8 col-sm-12">
                

    


    
        <ol class="breadcrumb">

    <li><a href="../../index.html">Home</a></li>

    
        
        <li><a href="../index.html">Django 1.10 Tutorial</a></li>
        

        

        
    
        

        

        
            <li class="active">Django Logging Users In and Out</li>
        
    

</ol>
    


<h1>Django Logging Users In and Out</h1>




    <p><i class="fa fa-calendar" aria-hidden="true"></i>
        Last updated on July 27, 2020
    </p>


<hr/>



<p>Django provides built-in URL patterns and view functions which makes adding login and logout system to your site a breeze. But before we add them to our project, we will create login and logout system on our own by using some utility functions provided by the Django authentication framework.</p>
<span id="the-authenticate-and-login-functions" class="anchor-target"></span><h2 class="heading">The authenticate() and login() functions <a class="header-link" href="#the-authenticate-and-login-functions">#</a></h2>

<p>Django authentication framework (<code>django.contrib.auth</code>) provides <code>authenticate()</code> and <code>login()</code> functions whose job is to authenticate and login users respectively.</p>

<p>The <code>authenticate()</code> function accepts two keyword arguments, <code>username</code> and <code>password</code> and returns an object of type <code>User</code>, if <code>username</code> and <code>password</code> are valid. Otherwise, it returns <code>None</code>.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;noisyboy&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">user</span>
<span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">noisyboy</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="o">...</span>   <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Credentials are valid&#34;</span><span class="p">)</span>
<span class="o">...</span> <span class="k">else</span><span class="p">:</span>
<span class="o">...</span>   <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Invalid Credentials&#34;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">Credentials</span> <span class="n">are</span> <span class="n">valid</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The <code>authenticate()</code> function only verifies whether the credentials provided are valid or not. It doesn&#39;t login the user.</p>

<p>To login user we use <code>login()</code> function. It takes two arguments, <code>request</code> object (<code>HttpRequest</code>) and a <code>User</code> object. To login user it saves the user&#39;s ID in the session, using <a href="../sessions-in-django/index.html">Django session framework</a>.</p>

<p>Once a user is logged in, he should be able to logout and this is the responsibility of <code>logout()</code> function.</p>
<span id="the-logout-function" class="anchor-target"></span><h2 class="heading">The logout() function <a class="header-link" href="#the-logout-function">#</a></h2>

<p>To logout users we use <code>logout()</code> function. It accepts a request (<code>HttpRequest</code>) object and returns <code>None</code>. Calling <code>logout()</code> function completely deletes the session data associated with the logged in user.</p>

<p>It is important to note that calling <code>logout()</code> function doesn&#39;t throw any errors if the user is not logged in.</p>

<p>The <code>logout()</code> function also removes the cookie from the browser.</p>
<span id="another-login-system" class="anchor-target"></span><h2 class="heading">Another Login System <a class="header-link" href="#another-login-system">#</a></h2>

<p>Now we have enough knowledge to roll out our own login system.</p>

<p>In the blog&#39;s app <code>views.py</code> add <code>login()</code>, <code>logout()</code> and <code>admin_page()</code> views as follows:</p>

<p><strong>TGDB/django_project/blog/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="kn">from</span> <span class="nn">django_project</span> <span class="kn">import</span> <span class="n">helpers</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">auth</span>
</span><span class="c1">#...</span>

<span class="k">def</span> <span class="nf">lousy_logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1">#...</span>

<span class="hll"><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;admin_page&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span><span class="hll">        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="hll">            <span class="c1"># correct username and password login the user</span>
</span><span class="hll">            <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;admin_page&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Error wrong username/password&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/login.html&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">auth</span><span class="o">.</span><span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;blog/logout.html&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">def</span> <span class="nf">admin_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;blog_login&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/admin_page.html&#39;</span><span class="p">)</span>
</span></pre></div>
</td></tr></tbody></table></div>
<p>Then create three templates <code>login.html</code>, <code>logout.html</code> and <code>admin_page.html</code> as follows:</p>

<p><strong>TGDB/django_project/blog/templates/blog/login.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&#34;blog/base.html&#34;</span>  <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    Blog - </span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">    &lt;div class=&#34;content&#34;&gt;</span>
<span class="x">        &lt;div class=&#34;section-inner clearfix&#34;&gt;</span>

<span class="x">        &lt;h3&gt;Login Form&lt;/h3&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;ul&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                &lt;li&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;/ul&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">        &lt;form action=&#34;&#34; method=&#34;post&#34;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;table&gt;</span>
<span class="x">                &lt;tr&gt;</span>
<span class="x">                    &lt;td&gt;&lt;label for=&#34;id_username&#34;&gt;Enter username&lt;/label&gt;&lt;/td&gt;</span>
<span class="x">                    &lt;td&gt;&lt;input type=&#34;text&#34; id=&#34;id_username&#34; name=&#34;username&#34;&gt;&lt;/td&gt;</span>
<span class="x">                &lt;/tr&gt;</span>
<span class="x">                &lt;tr&gt;</span>
<span class="x">                    &lt;td&gt;&lt;label for=&#34;id_username&#34;&gt;Enter password&lt;/label&gt;&lt;/td&gt;</span>
<span class="x">                    &lt;td&gt;&lt;input type=&#34;password&#34; id=&#34;id_password&#34; name=&#34;password&#34;&gt;&lt;/td&gt;</span>
<span class="x">                &lt;/tr&gt;</span>
<span class="x">                &lt;tr&gt;</span>
<span class="x">                    &lt;td&gt;&lt;/td&gt;</span>
<span class="x">                    &lt;td&gt;&lt;input type=&#34;submit&#34; value=&#34;Submit&#34;&gt;&lt;/td&gt;</span>
<span class="x">                &lt;/tr&gt;</span>
<span class="x">            &lt;/table&gt;</span>
<span class="x">        &lt;/form&gt;</span>

<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>TGDB/django_project/blog/templates/blog/logout.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&#34;blog/base.html&#34;</span>  <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    Blog - </span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">    &lt;div class=&#34;content&#34;&gt;</span>
<span class="x">        &lt;div class=&#34;section-inner clearfix&#34;&gt;</span>

<span class="x">        &lt;p&gt;You are logged out. &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_login&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Click here&lt;/a&gt; to login again.&lt;/p&gt;</span>

<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>TGDB/django_project/blog/templates/blog/admin_page.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&#34;blog/base.html&#34;</span>  <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    Blog - </span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">    &lt;div class=&#34;content&#34;&gt;</span>
<span class="x">        &lt;div class=&#34;section-inner clearfix&#34;&gt;</span>

<span class="x">        &lt;p&gt;Welcome </span><span class="cp">{{</span> <span class="nv">request.user.username</span> <span class="cp">}}</span><span class="x"> !&lt;/p&gt;</span>

<span class="x">        &lt;p&gt;User Details:&lt;/p&gt;</span>

<span class="x">        &lt;ul&gt;</span>
<span class="x">            &lt;li&gt;Email: </span><span class="cp">{{</span> <span class="nv">request.user.username.email</span><span class="o">|</span><span class="nf">default</span><span class="s2">:&#34;NA&#34;</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;SuperUser: </span><span class="cp">{{</span> <span class="nv">request.user.is_superuser</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;Staff: </span><span class="cp">{{</span> <span class="nv">request.user.is_staff</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;Date Joined: </span><span class="cp">{{</span> <span class="nv">request.user.date_joined</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;Last Login: </span><span class="cp">{{</span> <span class="nv">request.user.last_login</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">        &lt;/ul&gt;</span>

<span class="x">        &lt;p&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_logout&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Logout&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>Finally, add the following URL patterns in the blog&#39;s <code>urls.py</code> file:</p>

<p><strong>TGDB/django_project/blog/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^login/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_login&#39;</span><span class="p">),</span>
</span><span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^logout/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_logout&#39;</span><span class="p">),</span>
</span><span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin_page/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">admin_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;admin_page&#39;</span><span class="p">),</span>
</span>    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^lousy-login/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">lousy_login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lousy_login&#39;</span><span class="p">),</span>
    <span class="c1">#...</span>
<span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Start the development server and visit <code>http://127.0.0.1:8000/login/</code>. You should get a page like this:</p>

<p><img src="../../media/uploads/2017/09/11/login-page.png" loading="lazy" alt=""/></p>

<p>Enter correct username and password and you will be greeted with a page like this:</p>

<p><img src="../../media/uploads/2017/09/11/admin-page.png" loading="lazy" alt=""/></p>

<p>Nothing extraordinary here, we are just using some of the attributes we have learned in <a href="../django-authentication-framework-basics/index.html#creating-a-user-object">earlier lesson</a> to get some information about the current logged in user.</p>

<p>To logout, click the logout link at the bottom of the page.</p>

<p><img src="../../media/uploads/2017/09/11/logout-page.png" loading="lazy" alt=""/></p>
<span id="using-built-in-login-and-logout-views" class="anchor-target"></span><h2 class="heading">Using built-in login() and logout() views <a class="header-link" href="#using-built-in-login-and-logout-views">#</a></h2>

<p>Django provides two views <code>django.contrib.auth.login()</code> and <code>django.contrib.auth.logout()</code> to login and logout users respectively.</p>

<p>To use these views, import <code>django.contrib.auth</code> package and then add the following two URL patterns in the cadmin&#39;s app urls.py file:</p>

<p><strong>TGDB/django_project/cadmin/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/login/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
</span><span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/logout/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>
</span>    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^post/add/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">post_add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;post_add&#39;</span><span class="p">),</span>
    <span class="c1">#...</span>
<span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>By default, Django uses <code>/accounts/login/</code> and <code>/accounts/logout/</code> URL for login and logout respectively.</p>

<p>Save the <code>urls.py</code> file and visit <code>http://127.0.0.1:8000/cadmin/accounts/login/</code>. You will get a <code>TemplateDoesNotExist</code> exception as follows:</p>

<p><img src="../../media/uploads/2017/09/11/templatedoesnotexist-image.png" loading="lazy" alt=""/></p>

<p>The problem is that by default, <code>django.contrib.auth.login()</code> view looks for <code>registration/login.html</code> template in the <code>templates</code> directory of the auth app (<code>django.contrib.auth</code>). Because there is no such file in the <code>templates</code> directory of the auth app, Django raises a <code>TemplateDoesNotExist</code> exception.</p>

<p>We can pass a different template to the <code>django.contrib.auth.login()</code> view using the <code>template_name</code> keyword argument as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/login/$&#39;</span><span class="p">,</span>
    <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> 
    <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;blog/login.html&#39;</span><span class="p">},</span> 
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span>
<span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Similarly, by default the <code>django.contrib.auth.logout()</code> view uses <code>registration/logged_out.html</code> template from the admin app (<code>django.contrib.admin</code>). This is the same template which you would see if you logout from the Django Admin site.</p>

<p>Visit <code>http://127.0.0.1:8000/cadmin/accounts/logout/</code> and see it yourself.</p>

<p><img src="../../media/uploads/2017/09/11/django-admin-default-logout-page.png" loading="lazy" alt=""/></p>

<p>Just as with <code>django.contrib.auth.login()</code> view, we can use a different template by passing <code>template_name</code> keyword argument to <code>django.contrib.auth.logout()</code> view as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/logout/$&#39;</span><span class="p">,</span> 
    <span class="n">auth_views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> 
    <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;blog/logout.html&#39;</span><span class="p">},</span> 
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span>
<span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>We will create custom templates for login and logout page. So modify login and logout URLs to include template name in cadmin&#39;s <code>urls.py</code> file as follows:</p>

<p><strong>TGDB/django_project/cadmin/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/login/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;cadmin/login.html&#39;</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
</span><span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/logout/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;cadmin/logout.html&#39;</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>
</span>    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^post/add/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">post_add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;post_add&#39;</span><span class="p">),</span>
    <span class="c1">#...</span>
<span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Before we create login and logout templates, let&#39;s create another URL pattern which points to the root URL (i.e <code>http://127.0.0.1:8000/cadmin/</code>) of the cadmin app. Add a URL pattern named <code>home</code> to the <code>urlpatterns</code> list in <code>urls.py</code> file as follows:</p>

<p><strong>TGDB/django_project/cadmin/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>
</span>    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/login/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;cadmin/login.html&#39;</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
    <span class="c1">#...</span>
<span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Then, in the cadmin <code>views.py</code> file add the <code>home()</code> view just below <code>post_update()</code> view as follows:</p>

<p><strong>TGDB/django_project/cadmin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="k">def</span> <span class="nf">post_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="c1">#...</span>

<span class="hll"><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;cadmin/admin_page.html&#39;</span><span class="p">)</span>
</span></pre></div>
</td></tr></tbody></table></div>
<p>The only thing that remains now is the templates for the login, logout and admin page. Let&#39;s start by creating login template first.</p>

<p>Create a new file named <code>login.html</code> inside cadmin app&#39;s <code>templates</code> directory (i.e <code>cadmin/templates/cadmin/</code>) and add the following code to it:</p>

<p><strong>TGDB/django_project/cadmin/templates/cadmin/login.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&#34;cadmin/base.html&#34;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">    &lt;div class=&#34;login&#34;&gt;</span>
<span class="x">        &lt;h1&gt;The Great Django Blog - Login&lt;/h1&gt;</span>

<span class="x">        &lt;form method=&#34;post&#34; action=&#34;&#34;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;table&gt;</span>
<span class="x">                </span><span class="cp">{{</span> <span class="nv">form.as_table</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">                &lt;tr&gt;</span>
<span class="x">                    &lt;td&gt;&amp;nbsp;&lt;/td&gt;</span>
<span class="x">                    &lt;td&gt;&lt;input type=&#34;submit&#34; value=&#34;Submit&#34;&gt;&lt;/td&gt;</span>
<span class="x">                &lt;/tr&gt;                </span>
<span class="x">            &lt;/table&gt;</span>

<span class="x">        &lt;/form&gt;</span>

<span class="x">    &lt;/div&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>The value of the <code>form</code> template variable will be provided by <code>django.contrib.auth.login()</code> view using context.</p>

<p>Create another template named <code>logout.html</code> with the following code.</p>

<p><strong>TGDB/django_project/cadmin/templates/cadmin/logout.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&#34;cadmin/base.html&#34;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">&lt;div class=&#34;logout&#34;&gt;</span>
<span class="x">        &lt;p&gt;You have successfully logged out. &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;login&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Click&lt;/a&gt; to login again.&lt;/p&gt;</span>
<span class="x">&lt;/div&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>Finally, create <code>admin_page.html</code> and add the following code to it.</p>

<p><strong>TGDB/django_project/cadmin/templates/cadmin/admin_page.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&#34;blog/base.html&#34;</span>  <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    Blog - </span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">    &lt;div class=&#34;content&#34;&gt;</span>
<span class="x">        &lt;div class=&#34;section-inner clearfix&#34;&gt;</span>

<span class="x">        &lt;p&gt;Welcome </span><span class="cp">{{</span> <span class="nv">request.user.username</span> <span class="cp">}}</span><span class="x"> !&lt;/p&gt;</span>

<span class="x">        &lt;p&gt;User Details:&lt;/p&gt;</span>

<span class="x">        &lt;ul&gt;</span>
<span class="x">            &lt;li&gt;Email: </span><span class="cp">{{</span> <span class="nv">request.user.email</span><span class="o">|</span><span class="nf">default</span><span class="s2">:&#34;NA&#34;</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;SuperUser: </span><span class="cp">{{</span> <span class="nv">request.user.is_superuser</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;Staff: </span><span class="cp">{{</span> <span class="nv">request.user.is_staff</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;Date Joined: </span><span class="cp">{{</span> <span class="nv">request.user.date_joined</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">            &lt;li&gt;Last Login: </span><span class="cp">{{</span> <span class="nv">request.user.last_login</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">        &lt;/ul&gt;</span>

<span class="x">        &lt;p&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;logout&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Logout&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>Our login view is almost ready. Visit <code>http://127.0.0.1:8000/cadmin/accounts/login/</code> and try logging in using wrong username and password. You will be greeted with errors like this:</p>

<p><img src="../../media/uploads/2018/2/20/Selection_017-bef20c39-0f72-4da3-9ffe-a1201d5415b4.png" loading="lazy" alt=""/></p>

<p>Try logging in one more time using the correct username and password. If user logged in successfully then the <code>django.contrib.auth.login()</code> view will redirect the user to <code>/accounts/profile/</code> URL, this is Django&#39;s another default setting kicking in.</p>

<p><img src="../../media/uploads/2017/09/11/accounts-profile.png" loading="lazy" alt=""/></p>

<p>We don&#39;t have any URL pattern in cadmin&#39;s <code>urls.py</code> for <code>/accounts/profile/</code> that&#39;s why an HTTP 404 error is displayed.</p>

<p>We can override this setting by adding a hidden field (in <code>login.html</code>) named <code>next</code> with the URL to redirect after login.</p>
<div class="codeblock language-jinja"><div class="highlight"><pre><span></span><span class="x">&lt;td&gt;&lt;input type=&#34;hidden&#34; name=&#34;next&#34; value=&#34;/cadmin/&#34;&gt;&lt;/td&gt;</span>
</pre></div>
</div>
<p>This will redirect the user to <code>http://127.0.0.1:8000/cadmin/</code>, after successful login.</p>

<p>Instead of hardcoding the URL. We could also pass the value of the <code>next</code> field using query string like this:</p>

<p><code>http://127.0.0.1:8000/cadmin/accounts/login/?next=/cadmin/</code></p>

<p>Open <code>login.html</code> and add the hidden field named <code>next</code> as follows:</p>

<p><strong>TGDB/django_project/cadmin/templates/cadmin/login.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# ... #}</span><span class="x"></span>
<span class="x">&lt;form method=&#34;post&#34; action=&#34;&#34;&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;table&gt;</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_table</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">        &lt;tr&gt;</span>
<span class="hll"><span class="x">            &lt;td&gt;&lt;input type=&#34;hidden&#34; name=&#34;next&#34; value=&#34;</span><span class="cp">{{</span> <span class="nv">next</span><span class="o">|</span><span class="nf">default</span><span class="s1">:&#39;/cadmin/&#39;</span> <span class="cp">}}</span><span class="x">&#34;&gt;&lt;/td&gt;</span>
</span><span class="x">            &lt;td&gt;&lt;input type=&#34;submit&#34; value=&#34;Submit&#34;&gt;&lt;/td&gt;</span>
<span class="x">        &lt;/tr&gt;</span>
<span class="x">    &lt;/table&gt;</span>
<span class="x">&lt;/form&gt;</span>
<span class="c">{# ... #}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>This is how the above code works:</p>

<p>If we don&#39;t provide any value to <code>next</code> form field as query string then the default value i.e <code>/cadmin/</code> will be used. Otherwise, the user will be redirected to the URL given by the <code>next</code> as a query string.</p>

<p>Visit <code>http://127.0.0.1:8000/cadmin/accounts/login/</code>, enter correct username/password and hit enter. This time you will be redirected to <code>http://127.0.0.1:8000/cadmin/</code>, which looks like this:</p>

<p><img src="../../media/uploads/2017/09/11/cadmin-admin_page.png" loading="lazy" alt=""/></p>

<p>To logout click &#34;Logout&#34; link at the bottom of the page or visit <code>http://127.0.0.1:8000/cadmin/accounts/logout/</code> and you will see a page like this:</p>

<p><img src="../../media/uploads/2018/2/20/Selection_018-c532223e-7e2e-4eee-98de-8557fdd58f92.png" loading="lazy" alt=""/></p>

<p>Our login and logout system is working as expected, but from the usability point of view, there is still one problem.</p>

<p>Visit <code>http://127.0.0.1:8000/cadmin/accounts/login/</code> once again and login using the correct username and password. As expected, you will be redirected to <code>http://127.0.0.1:8000/cadmin/</code>. At this point, if we visit <code>http://127.0.0.1:8000/cadmin/accounts/login/</code> again, Django will redisplay the login the form. Redisplaying login form to a logged in user is absolutely pointless.</p>

<p>We can change this behavior by creating a custom login view function. Open cadmin app&#39;s <code>views.py</code> and append the <code>login()</code> view as follows:</p>

<p><strong>TGDB/django_project/cadmin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#... </span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Author</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
</span><span class="c1">#...</span>

<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1">#...</span>

<span class="hll"><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/cadmin/&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">else</span><span class="p">:</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>
</td></tr></tbody></table></div>
<p>Nothing new here except the additional <code>**kwargs</code> argument. The <code>kwargs</code> enables us to pass the all the extra keyword arguments passed to this view function to the built-in <code>django.contrib.auth.login()</code> view function.</p>

<p>Here is how it works:</p>

<p>The <code>login()</code> view first checks whether the user is authenticated or not. If the user is authenticated then it will redirect him to the admin page. Otherwise, it will display the login form by calling built-in <code>django.contrib.auth.login()</code> view.</p>

<p>Next, we have to update our login URL pattern to use our <code>login()</code> view instead of one provided by Django Authentication framework. Update <code>login</code> URL pattern in <code>urls.py</code> as follows:</p>

<p><strong>TGDB/django_project/cadmin/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="n">urlpatterns</span><span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>
<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/login/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;blog/login.html&#39;</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
</span>    <span class="c1">#...</span>
<span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Now if you visit <code>http://127.0.0.1:8000/cadmin/accounts/login/</code> after logging in, you will be redirected to <code>http://127.0.0.1:8000/cadmin/</code>.</p>
<span id="limiting-access" class="anchor-target"></span><h2 class="heading">Limiting Access <a class="header-link" href="#limiting-access">#</a></h2>

<p>The whole point of implementing login system to our site is to prevent unauthorized access to administrative pages.</p>

<p>A simple way to restrict access to a page is to first check whether the user is authenticated or not using <code>is_authenticated()</code> method then redirect the user accordingly. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">our_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;login&#34;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;app/view.html&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>We have already employed this technique in the <code>home()</code> and <code>login()</code> view functions.</p>

<p><strong>TGDB/django_project/cadmin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;cadmin/admin_page.html&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/cadmin/&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>In Django, the preferred way to limit access to pages is to use <code>login_required</code> decorator. To use <code>login_required</code> decorator you must import it from <code>django.contrib.auth.decorators</code>. </p>

<p>Let&#39;s update <code>home()</code> view to use <code>login_required</code> decorator as follows:</p>

<p><strong>TGDB/django_project/cadmin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
</span>
<span class="c1">#...</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;cadmin/admin_page.html&#39;</span><span class="p">)</span>
<span class="c1">#...</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Here is how the <code>login_required</code> decorator work:</p>

<p>If the user is not logged then it will redirect the user to <code>/accounts/login/</code> (Django&#39;s default login URL), passing the current absolute URL as a value to the <code>next</code> query parameter. For example, open your browser and visit <code>http://127.0.0.1:8000/cadmin/</code> (without logging in). The <code>login_required</code> will redirect you to <code>http://127.0.0.1:8000/accounts/login/?next=/cadmin/</code> URL.</p>

<p><img src="../../media/uploads/2017/09/11/django-default-login-url.png" loading="lazy" alt=""/></p>

<p>On the other hand, if the user is logged in then the <code>login_required</code> would do nothing. In the next section, we are going to change Django&#39;s default login URL i.e <code>/accounts/login/</code>.</p>
<span id="updating-default-login-url" class="anchor-target"></span><h2 class="heading">Updating default Login URL <a class="header-link" href="#updating-default-login-url">#</a></h2>

<p>In the earlier sections, we have encountered many places where Django uses <code>/accounts/login/</code> as default URL for login. To change default login URL we use <code>LOGIN_URL</code> setting in <code>settings.py</code> file. <code>LOGIN_URL</code> accepts URL or name of the URL pattern. Open <code>settings.py</code> file and add the following variable at the end of the file.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;login&#39;</span>
</pre></div>
</div>
<p>Here we are assigning the value of the <code>name</code> attribute of login URL pattern from cadmin&#39;s <code>urls.py</code>. In other words, the above code changes the default login URL from <code>/accounts/login/</code> to <code>/cadmin/accounts/login/</code>. As a result, if you try to visit a view which has <code>login_required</code> decorator applied to it, you will be redirected to <code>/cadmin/accounts/login/</code> URL instead of <code>/accounts/login/</code>.</p>

<p>In our case, we want users to let users to login and logout using <code>/cadmin/login/</code> and <code>/cadmin/logout/</code> URLs respectively. To do so, open cadmin&#39;s <code>urls.py</code> file and make the following changes:</p>

<p><strong>TGDB/django_project/cadmin/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>
<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^login/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;cadmin/login.html&#39;</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
</span><span class="hll">    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^logout/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;cadmin/logout.html&#39;</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>
</span>    <span class="c1">#...</span>
<span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>As we are using named URL pattern in <code>LOGIN_URL</code> setting we don&#39;t need to update anything else. Now our updated login and logout URLs are <code>/cadmin/login/</code> and <code>/cadmin/logout/</code> respectively. To verify the changes visit <code>http://127.0.0.1:8000/cadmin/</code> and you will be redirected to <code>http://127.0.0.1:8000/cadmin/login/?next=/cadmin/</code>.</p>

<p><img src="../../media/uploads/2018/2/20/Selection_019-ac5877ea-37f5-4b12-b3c2-b200494b0603.png" loading="lazy" alt=""/></p>

<p>Enter correct username and password and you will get a page like this:</p>

<p><img src="../../media/uploads/2017/09/11/updated-logout-url.png" loading="lazy" alt=""/></p>

<p><strong>Note:</strong> To checkout this version of the repository type <code>git checkout 30a</code>.</p>



    



        <nav aria-label="pagination">
            <ul class="pager">
                
                    <li class="previous">
                        <a href="../django-authentication-framework-basics/index.html" title="Django Authentication Framework Basics">
                            <span class="fa fa-arrow-left" aria-hidden="true"></span>
                            Django Authentication Framework Basics
                        </a>
                    </li>
                

                
                    <li class="next">
                        <a href="../django-password_change-view/index.html" title="Django password_change() View">
                            Django password_change() View
                            <span class="fa fa-arrow-right" aria-hidden="true"></span>
                        </a>
                    </li>
                
            </ul>
        </nav>







    <hr/>
    <div id="disqus_thread">
    <p style="margin-bottom: 10px" class="text-center">
        <a href="#" class=" btn btn-primary comments-holder" onclick="loadDisqus();return false;">
            <i class="fa fa-comments" aria-hidden="true"></i> Load Comments
        </a>
    </p>
    </div>
    <hr/>
    <script>
        var is_disqus_loaded = false;
        function loadDisqus() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '../../../overiqcom.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        };
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>







            </div>
        </div>


        <div class="sidebar">
        
            <div class="col-lg-4 col-md-4 col-sm-12">
                

    
        
    <div class="well">
        <h4>Django 1.10 Tutorial</h4>
        <ul>
            
                <li><a href="../intro-to-django/index.html">Intro to Django</a></li>
            
                <li><a href="../installing-django/index.html">Installing Django</a></li>
            
                <li><a href="../creating-django-project/index.html">Creating Django Project</a></li>
            
                <li><a href="../mvc-pattern-and-django/index.html">MVC Pattern and Django</a></li>
            
                <li><a href="../views-and-urlconfs-in-django/index.html">Views and URLconfs in Django</a></li>
            
                <li><a href="../basics-of-django-templates/index.html">Basics of Django Templates</a></li>
            
                <li><a href="../template-tags-in-django/index.html">Template tags in Django</a></li>
            
                <li><a href="../template-filters-in-django/index.html">Template filters in Django</a></li>
            
                <li><a href="../loading-templates-in-django/index.html">Loading Templates in Django</a></li>
            
                <li><a href="../template-inheritance-in-django/index.html">Template Inheritance in Django</a></li>
            
                <li><a href="../basics-of-models-in-django/index.html">Basics of Models in Django</a></li>
            
                <li><a href="../migrations-in-django/index.html">Migrations in Django</a></li>
            
                <li><a href="../django-orm-basics/index.html">Django ORM Basics</a></li>
            
                <li><a href="../accessing-related-data-using-django-orm/index.html">Accessing Related Data Using Django ORM</a></li>
            
                <li><a href="../building-blog-the-first-steps/index.html">Building Blog The First Steps</a></li>
            
                <li><a href="../django-admin-app/index.html">Django Admin App</a></li>
            
                <li><a href="../creating-urls-in-django/index.html">Creating URLs in Django</a></li>
            
                <li><a href="../showing-404-errors-in-django/index.html">Showing 404 errors In Django</a></li>
            
                <li><a href="../redirecting-urls-in-django/index.html">Redirecting URLs in Django</a></li>
            
                <li><a href="../django-form-basics/index.html">Django Form Basics</a></li>
            
                <li><a href="../displaying-forms-in-django/index.html">Displaying Forms in Django</a></li>
            
                <li><a href="../building-contact-us-page/index.html">Building Contact Us Page</a></li>
            
                <li><a href="../django-rendering-fields-manually/index.html">Django Rendering Fields Manually</a></li>
            
                <li><a href="../handling-static-content-in-django/index.html">Handling Static Content in Django</a></li>
            
                <li><a href="../handling-media-files-in-django/index.html">Handling Media Files in Django</a></li>
            
                <li><a href="../pagination-in-django/index.html">Pagination in Django</a></li>
            
                <li><a href="../cookies-in-django/index.html">Cookies in Django</a></li>
            
                <li><a href="../sessions-in-django/index.html">Sessions in Django</a></li>
            
                <li><a href="../django-authentication-framework-basics/index.html">Django Authentication Framework Basics</a></li>
            
                <li><a href="index.html">Django Logging Users In and Out</a></li>
            
                <li><a href="../django-password_change-view/index.html">Django password_change() View</a></li>
            
                <li><a href="../django-creating-users-using-usercreationform/index.html">Django Creating Users using UserCreationForm</a></li>
            
                <li><a href="../django-extending-user-model/index.html">Django Extending User model</a></li>
            
                <li><a href="../flatpages-in-django/index.html">Flatpages in Django</a></li>
            
                <li><a href="../creating-sitemaps-in-django/index.html">Creating Sitemaps in Django</a></li>
            
                <li><a href="../revisiting-cadmin-app/index.html">Revisiting cadmin App</a></li>
            
                <li><a href="../integrating-ckeditor-in-django/index.html">Integrating CKeditor in Django</a></li>
            
        </ul>
    </div>

    

    
        

<div class="well">
    <h4>Recent Posts</h4>
    <ul>
        
            <li><a href="../../machine-learning-experts-you-should-be-following-online/index.html">Machine Learning Experts You Should Be Following Online</a></li>
        
            <li><a href="../../4-ways-to-prepare-for-the-ap-computer-science-a-exam/index.html">4 Ways to Prepare for the AP Computer Science A Exam</a></li>
        
            <li><a href="../../finance-assignment-online-help-for-the-busy-and-tired-students-get-help-from-experts/index.html">Finance Assignment Online Help for the Busy and Tired Students: Get Help from Experts</a></li>
        
            <li><a href="../../top-9-machine-learning-algorithms-for-data-scientists/index.html">Top 9 Machine Learning Algorithms for Data Scientists</a></li>
        
            <li><a href="../../data-science-learning-path-or-steps-to-become-a-data-scientist-final/index.html">Data Science Learning Path or Steps to become a data scientist Final</a></li>
        
            <li><a href="../../enable-edit-button-in-shutter-in-linux-mint-19-and-ubuntu-18-04/index.html">Enable Edit Button in Shutter In Linux Mint 19 and Ubuntu 18.04</a></li>
        
            <li><a href="../../python-3-time-module/index.html">Python 3 time module</a></li>
        
            <li><a href="../../pygments-tutorial/index.html">Pygments Tutorial</a></li>
        
            <li><a href="../../how-to-use-virtualenv/index.html">How to use Virtualenv?</a></li>
        
            <li><a href="../../installing-mysql-windows-linux-and-mac/index.html">Installing MySQL (Windows, Linux and Mac)</a></li>
        
            <li><a href="../../what-is-if-__name__-__main__-in-python/index.html">What is if __name__ == &#39;__main__&#39;  in Python ?</a></li>
        
            <li><a href="../../installing-goaccess-a-real-time-web-log-analyzer/index.html">Installing GoAccess (A Real-time web log analyzer)</a></li>
        
            <li><a href="../../installing-isso/index.html">Installing Isso</a></li>
        
    </ul>
</div>

<!-- Blog Search Well -->





















    



            </div>
        </div>
    </div>



    

</div>

<!-- Footer -->
<footer class="overiq-footer">
    <div class="container">
        <div class="row">

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../terms-of-use/index.html">Terms</a></li>
                    <li><a href="../../privacy-policy/index.html">Privacy Policy</a></li>
                    <li><a href="../../sitemap.xml/index.html">Sitemap</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../contact/index.html">Contact</a></li>
                    <li><a href="../../blog/index.html">Blog</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="https://www.facebook.com/OverIQ/">Facebook</a></li>
                    <li><a href="https://twitter.com/infoOverIQ">Twitter</a></li>
                    <li><a href="https://github.com/overiq">Github</a></li>
                </ul>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../c-programming-101/index.html">C Tutorial</a></li>
                    <li><a href="../../python-101/index.html">Python Tutorial</a></li>
                    <li><a href="../../django-1-11/index.html">Django Tutorial</a></li>
                    <li><a href="../../flask-101/index.html">Flask Tutorial</a></li>
                    <li><a href="../../mysql-connector-python-101/index.html">MySQL Connector/Python Tutorial</a></li>
                    <li><a href="../../sqlalchemy-101/index.html">SQLAlchemy Tutorial</a></li>
                    <li><a href="../../c-examples/index.html">C Programming Examples</a></li>
                </ul>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row text-center">
            <p>© 2025 OverIQ.com</p>
            <small><a href="#">Back to top</a></small>
        </div>

        <!-- /.row -->
    </div>
</footer>



<script type="text/javascript" src="../../static/CACHE/js/output.2e0ff002c1a4.js"></script>




<script async="" src="../../../cdn.jsdelivr.net/npm/cookieconsent%403/build/cookieconsent.min.js" data-cfasync="false"></script>

<script>

    
    window.addEventListener('load', function () {
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#5ca9e0",
                    "text": "#ffffff"
                },
                "button": {
                    "background": "#fff",
                    "text": "#237afc"
                }
            },
            "theme": "classic",
            "position": "top",
            "static": true,
            "content": {
                "href": "https://overiq.com/privacy-policy/"
            }
        });
    });


</script>

<script src="../../../polyfill.io/v3/polyfill.min1162.js?features=es6"></script>
<script id="MathJax-script" defer="" src="../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml.js"></script>

<script async="" type="text/javascript" src="../../../cdn.carbonads.com/carbonfbdb.js?serve=CE7DC53E&amp;placement=overiqcom" id="_carbonads_js"></script>





<script data-cfasync="false">function _emitEzConsentEvent(){var customEvent=new CustomEvent("ezConsentEvent",{detail:{ezTcfConsent:window.ezTcfConsent},bubbles:true,cancelable:true,});document.dispatchEvent(customEvent);}
(function(window,document){function _setAllEzConsentTrue(){window.ezTcfConsent.loaded=true;window.ezTcfConsent.store_info=true;window.ezTcfConsent.develop_and_improve_services=true;window.ezTcfConsent.measure_ad_performance=true;window.ezTcfConsent.measure_content_performance=true;window.ezTcfConsent.select_basic_ads=true;window.ezTcfConsent.create_ad_profile=true;window.ezTcfConsent.select_personalized_ads=true;window.ezTcfConsent.create_content_profile=true;window.ezTcfConsent.select_personalized_content=true;window.ezTcfConsent.understand_audiences=true;window.ezTcfConsent.use_limited_data_to_select_content=true;window.ezTcfConsent.select_personalized_content=true;}
function _clearEzConsentCookie(){document.cookie="ezCMPCookieConsent=tcf2;Domain=.overiq.com;Path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT";}
_clearEzConsentCookie();if(typeof window.__tcfapi!=="undefined"){window.ezgconsent=false;var amazonHasRun=false;function _ezAllowed(tcdata,purpose){return(tcdata.purpose.consents[purpose]||tcdata.purpose.legitimateInterests[purpose]);}
function _handleConsentDecision(tcdata){window.ezTcfConsent.loaded=true;if(!tcdata.vendor.consents["347"]&&!tcdata.vendor.legitimateInterests["347"]){window._emitEzConsentEvent();return;}
window.ezTcfConsent.store_info=_ezAllowed(tcdata,"1");window.ezTcfConsent.develop_and_improve_services=_ezAllowed(tcdata,"10");window.ezTcfConsent.measure_content_performance=_ezAllowed(tcdata,"8");window.ezTcfConsent.select_basic_ads=_ezAllowed(tcdata,"2");window.ezTcfConsent.create_ad_profile=_ezAllowed(tcdata,"3");window.ezTcfConsent.select_personalized_ads=_ezAllowed(tcdata,"4");window.ezTcfConsent.create_content_profile=_ezAllowed(tcdata,"5");window.ezTcfConsent.measure_ad_performance=_ezAllowed(tcdata,"7");window.ezTcfConsent.use_limited_data_to_select_content=_ezAllowed(tcdata,"11");window.ezTcfConsent.select_personalized_content=_ezAllowed(tcdata,"6");window.ezTcfConsent.understand_audiences=_ezAllowed(tcdata,"9");window._emitEzConsentEvent();}
function _handleGoogleConsentV2(tcdata){if(!tcdata||!tcdata.purpose||!tcdata.purpose.consents){return;}
var googConsentV2={};if(tcdata.purpose.consents[1]){googConsentV2.ad_storage='granted';googConsentV2.analytics_storage='granted';}
if(tcdata.purpose.consents[3]&&tcdata.purpose.consents[4]){googConsentV2.ad_personalization='granted';}
if(tcdata.purpose.consents[1]&&tcdata.purpose.consents[7]){googConsentV2.ad_user_data='granted';}
if(googConsentV2.analytics_storage=='denied'){gtag('set','url_passthrough',true);}
gtag('consent','update',googConsentV2);}
__tcfapi("addEventListener",2,function(tcdata,success){if(!success||!tcdata){window._emitEzConsentEvent();return;}
if(!tcdata.gdprApplies){_setAllEzConsentTrue();window._emitEzConsentEvent();return;}
if(tcdata.eventStatus==="useractioncomplete"||tcdata.eventStatus==="tcloaded"){if(typeof gtag!='undefined'){_handleGoogleConsentV2(tcdata);}
_handleConsentDecision(tcdata);if(tcdata.purpose.consents["1"]===true&&tcdata.vendor.consents["755"]!==false){window.ezgconsent=true;(adsbygoogle=window.adsbygoogle||[]).pauseAdRequests=0;}
if(window.__ezconsent){__ezconsent.setEzoicConsentSettings(ezConsentCategories);}
__tcfapi("removeEventListener",2,function(success){return null;},tcdata.listenerId);if(!(tcdata.purpose.consents["1"]===true&&_ezAllowed(tcdata,"2")&&_ezAllowed(tcdata,"3")&&_ezAllowed(tcdata,"4"))){if(typeof __ez=="object"&&typeof __ez.bit=="object"&&typeof window["_ezaq"]=="object"&&typeof window["_ezaq"]["page_view_id"]=="string"){__ez.bit.Add(window["_ezaq"]["page_view_id"],[new __ezDotData("non_personalized_ads",true),]);}}}});}else{_setAllEzConsentTrue();window._emitEzConsentEvent();}})(window,document);</script></body>
<!-- Mirrored from overiq.com/django-1-10/django-logging-users-in-and-out/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:05:34 GMT -->
</html>