<!DOCTYPE html><html lang="en">
<!-- Mirrored from overiq.com/django-1-11/building-profile-pages-for-djangobin/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:14:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"/>
<script>var __ezHttpConsent={setByCat:function(src,tagType,attributes,category,force){var setScript=function(){if(force||window.ezTcfConsent[category]){var scriptElement=document.createElement(tagType);scriptElement.src=src;attributes.forEach(function(attr){for(var key in attr){if(attr.hasOwnProperty(key)){scriptElement.setAttribute(key,attr[key]);}}});var firstScript=document.getElementsByTagName(tagType)[0];firstScript.parentNode.insertBefore(scriptElement,firstScript);}};if(force||(window.ezTcfConsent&&window.ezTcfConsent.loaded)){setScript();}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){setScript();}else{console.error("cannot get ez consent data");force=true;setScript();}});}else{force=true;setScript();console.error("getEzConsentData is not a function");}},};</script>
<script>var ezTcfConsent=window.ezTcfConsent?window.ezTcfConsent:{loaded:false,store_info:false,develop_and_improve_services:false,measure_ad_performance:false,measure_content_performance:false,select_basic_ads:false,create_ad_profile:false,select_personalized_ads:false,create_content_profile:false,select_personalized_content:false,understand_audiences:false,use_limited_data_to_select_content:false,};function getEzConsentData(){return new Promise(function(resolve){document.addEventListener("ezConsentEvent",function(event){var ezTcfConsent=event.detail.ezTcfConsent;resolve(ezTcfConsent);});});}</script>
<script>if(typeof _setEzCookies!=='function'){function _setEzCookies(ezConsentData){var cookies=window.ezCookieQueue;for(var i=0;i<cookies.length;i++){var cookie=cookies[i];if(ezConsentData&&ezConsentData.loaded&&ezConsentData[cookie.tcfCategory]){document.cookie=cookie.name+"="+cookie.value;}}}}
window.ezCookieQueue=window.ezCookieQueue||[];if(typeof addEzCookies!=='function'){function addEzCookies(arr){window.ezCookieQueue=[...window.ezCookieQueue,...arr];}}
addEzCookies([]);if(window.ezTcfConsent&&window.ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else{console.error("cannot get ez consent data");_setEzCookies(window.ezTcfConsent);}});}else{console.error("getEzConsentData is not a function");_setEzCookies(window.ezTcfConsent);}</script>
<script data-ezscrex='false' data-cfasync='false' data-pagespeed-no-defer>var __ez=__ez||{};__ez.stms=Date.now();__ez.evt={};__ez.script={};__ez.ck=__ez.ck||{};__ez.template={};__ez.template.isOrig=true;window.__ezScriptHost="//www.ezojs.com";__ez.queue=__ez.queue||function(){var e=0,i=0,t=[],n=!1,o=[],r=[],s=!0,a=function(e,i,n,o,r,s,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,d=this;this.name=e,this.funcName=i,this.parameters=null===n?null:w(n)?n:[n],this.isBlock=o,this.blockedBy=r,this.deleteWhenComplete=s,this.isError=!1,this.isComplete=!1,this.isInitialized=!1,this.proceedIfError=a,this.fWindow=l,this.isTimeDelay=!1,this.process=function(){f("... func = "+e),d.isInitialized=!0,d.isComplete=!0,f("... func.apply: "+e);var i=d.funcName.split("."),n=null,o=this.fWindow||window;i.length>3||(n=3===i.length?o[i[0]][i[1]][i[2]]:2===i.length?o[i[0]][i[1]]:o[d.funcName]),null!=n&&n.apply(null,this.parameters),!0===d.deleteWhenComplete&&delete t[e],!0===d.isBlock&&(f("----- F'D: "+d.name),m())}},l=function(e,i,t,n,o,r,s){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,l=this;this.name=e,this.path=i,this.async=o,this.defer=r,this.isBlock=t,this.blockedBy=n,this.isInitialized=!1,this.isError=!1,this.isComplete=!1,this.proceedIfError=s,this.fWindow=a,this.isTimeDelay=!1,this.isPath=function(e){return"/"===e[0]&&"/"!==e[1]},this.getSrc=function(e){return void 0!==window.__ezScriptHost&&this.isPath(e)&&"banger.js"!==this.name?window.__ezScriptHost+e:e},this.process=function(){l.isInitialized=!0,f("... file = "+e);var i=this.fWindow?this.fWindow.document:document,t=i.createElement("script");t.src=this.getSrc(this.path),!0===o?t.async=!0:!0===r&&(t.defer=!0),t.onerror=function(){var e={url:window.location.href,name:l.name,path:l.path,user_agent:window.navigator.userAgent};"undefined"!=typeof _ezaq&&(e.pageview_id=_ezaq.page_view_id);var i=encodeURIComponent(JSON.stringify(e)),t=new XMLHttpRequest;t.open("GET/index.html","//g.ezoic.net/ezqlog?d="+i,!0),t.send(),f("----- ERR'D: "+l.name),l.isError=!0,!0===l.isBlock&&m()},t.onreadystatechange=t.onload=function(){var e=t.readyState;f("----- F'D: "+l.name),e&&!/loaded|complete/.test(e)||(l.isComplete=!0,!0===l.isBlock&&m())},i.getElementsByTagName("head")[0].appendChild(t)}},d=function(e,i){this.name=e,this.path="",this.async=!1,this.defer=!1,this.isBlock=!1,this.blockedBy=[],this.isInitialized=!0,this.isError=!1,this.isComplete=i,this.proceedIfError=!1,this.isTimeDelay=!1,this.process=function(){}};function c(e,i,n,s,a,d,c,u,f){var m=new l(e,i,n,s,a,d,c,f);!0===u?o[e]=m:r[e]=m,t[e]=m,h(m)}function h(e){!0!==u(e)&&0!=s&&e.process()}function u(e){if(!0===e.isTimeDelay&&!1===n)return f(e.name+" blocked = TIME DELAY!"),!0;if(w(e.blockedBy))for(var i=0;i<e.blockedBy.length;i++){var o=e.blockedBy[i];if(!1===t.hasOwnProperty(o))return f(e.name+" blocked = "+o),!0;if(!0===e.proceedIfError&&!0===t[o].isError)return!1;if(!1===t[o].isComplete)return f(e.name+" blocked = "+o),!0}return!1}function f(e){var i=window.location.href,t=new RegExp("[?&]ezq=([^&#]*)","i").exec(i);"1"===(t?t[1]:null)&&console.debug(e)}function m(){++e>200||(f("let's go"),p(o),p(r))}function p(e){for(var i in e)if(!1!==e.hasOwnProperty(i)){var t=e[i];!0===t.isComplete||u(t)||!0===t.isInitialized||!0===t.isError?!0===t.isError?f(t.name+": error"):!0===t.isComplete?f(t.name+": complete already"):!0===t.isInitialized&&f(t.name+": initialized already"):t.process()}}function w(e){return"[object Array]"==Object.prototype.toString.call(e)}return window.addEventListener("load",(function(){setTimeout((function(){n=!0,f("TDELAY -----"),m()}),5e3)}),!1),{addFile:c,addFileOnce:function(e,i,n,o,r,s,a,l,d){t[e]||c(e,i,n,o,r,s,a,l,d)},addDelayFile:function(e,i){var n=new l(e,i,!1,[],!1,!1,!0);n.isTimeDelay=!0,f(e+" ...  FILE! TDELAY"),r[e]=n,t[e]=n,h(n)},addFunc:function(e,n,s,l,d,c,u,f,m,p){!0===c&&(e=e+"_"+i++);var w=new a(e,n,s,l,d,u,f,p);!0===m?o[e]=w:r[e]=w,t[e]=w,h(w)},addDelayFunc:function(e,i,n){var o=new a(e,i,n,!1,[],!0,!0);o.isTimeDelay=!0,f(e+" ...  FUNCTION! TDELAY"),r[e]=o,t[e]=o,h(o)},items:t,processAll:m,setallowLoad:function(e){s=e},markLoaded:function(e){if(e&&0!==e.length){if(e in t){var i=t[e];!0===i.isComplete?f(i.name+" "+e+": error loaded duplicate"):(i.isComplete=!0,i.isInitialized=!0)}else t[e]=new d(e,!0);f("markLoaded dummyfile: "+t[e].name)}},logWhatsBlocked:function(){for(var e in t)!1!==t.hasOwnProperty(e)&&u(t[e])}}}();__ez.evt.add=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n()},__ez.evt.remove=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):delete e["on"+t]};__ez.script.add=function(e){var t=document.createElement("script");t.src=e,t.async=!0,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t)};__ez.dot={};__ez.queue.addFile('../../detroitchicago/boise.js', '../../detroitchicago/boisebb26.js?gcb=195-3&amp;cb=5', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/abilene.js', '../../parsonsmaize/abilenec0f9.js?gcb=195-3&amp;cb=7f81d60744', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/mulvane.js', '../../parsonsmaize/mulvane2d63.js?gcb=195-3&amp;cb=e75e48eec0', true, ['/parsonsmaize/abilene.js'], true, false, true, false);__ez.queue.addFile('../../detroitchicago/birmingham.js', '../../detroitchicago/birminghame7ec.js?gcb=195-3&amp;cb=539c47377c', true, ['/parsonsmaize/abilene.js'], true, false, true, false);</script>
<script data-ezscrex="false" type="text/javascript" data-cfasync="false">window._ezaq = Object.assign({"ad_cache_level":1,"adpicker_placement_cnt":0,"ai_placeholder_cache_level":1,"ai_placeholder_placement_cnt":-1,"domain_id":92771,"ezcache_level":1,"ezcache_skip_code":0,"has_bad_image":0,"has_bad_words":0,"is_sitespeed":0,"lt_cache_level":0,"response_size":115981,"response_size_orig":110213,"response_time_orig":1021,"template_id":5,"url":"https://overiq.com/django-1-11/building-profile-pages-for-djangobin/","word_count":0,"worst_bad_word_level":0}, typeof window._ezaq !== "undefined" ? window._ezaq : {});__ez.queue.markLoaded('ezaqBaseReady');</script>
<script type='text/javascript' data-ezscrex='false' data-cfasync='false'>
window.ezAnalyticsStatic = true;

function analyticsAddScript(script) {
	var ezDynamic = document.createElement('script');
	ezDynamic.type = 'text/javascript';
	ezDynamic.innerHTML = script;
	document.head.appendChild(ezDynamic);
}
function getCookiesWithPrefix() {
    var allCookies = document.cookie.split(';');
    var cookiesWithPrefix = {};

    for (var i = 0; i < allCookies.length; i++) {
        var cookie = allCookies[i].trim();

        for (var j = 0; j < arguments.length; j++) {
            var prefix = arguments[j];
            if (cookie.indexOf(prefix) === 0) {
                var cookieParts = cookie.split('=');
                var cookieName = cookieParts[0];
                var cookieValue = cookieParts.slice(1).join('=');
                cookiesWithPrefix[cookieName] = decodeURIComponent(cookieValue);
                break; // Once matched, no need to check other prefixes
            }
        }
    }

    return cookiesWithPrefix;
}
function productAnalytics() {
	var d = {"pr":[6],"omd5":"6c3afc77d95c9d84f0c0a0ca5fdcb296"};
	d.u = _ezaq.url;
	d.p = _ezaq.page_view_id;
	d.v = _ezaq.visit_uuid;
	d.ab = _ezaq.ab_test_id;
	d.e = JSON.stringify(_ezaq);
	d.ref = document.referrer;
	d.c = getCookiesWithPrefix('active_template', 'ez', 'lp_');
	if(typeof ez_utmParams !== 'undefined') {
		d.utm = ez_utmParams;
	}

	var dataText = JSON.stringify(d);
	var xhr = new XMLHttpRequest();
	xhr.open('POST/index.html','/ezais/analytics?cb=1', true);
	xhr.onload = function () {
		if (xhr.status!=200) {
            return;
		}

        if(document.readyState !== 'loading') {
            analyticsAddScript(xhr.response);
            return;
        }

        var eventFunc = function() {
            if(document.readyState === 'loading') {
                return;
            }
            document.removeEventListener('readystatechange', eventFunc, false);
            analyticsAddScript(xhr.response);
        };

        document.addEventListener('readystatechange', eventFunc, false);
	};
	xhr.setRequestHeader('Content-Type','text/plain');
	xhr.send(dataText);
}
__ez.queue.addFunc("productAnalytics", "productAnalytics", null, true, ['ezaqBaseReady'], false, false, false, true);
</script><base />
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Building profile pages for Djangobin - Django 1.11 Tutorial - OverIQ.com</title>

    
    



    <meta name="description" content="Creating Settings View #

The settings view will allow a logged in user to change preferences like default language, expiration and exposure. It also…"/>



    <link rel="canonical" href="index.html"/>


<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Building profile pages for Djangobin"/>

    <meta property="og:description" content="Creating Settings View #

The settings view will allow a logged in user to change preferences like default language, expiration and exposure. It also…"/>


<meta property="og:url" content="https://overiq.com/django-1-11/building-profile-pages-for-djangobin/"/>
<meta property="og:site_name" content="OverIQ.com"/>


<meta property="article:publisher" content="https://www.facebook.com/OverIQ/"/>



<meta name="twitter:card" content="summary_large_image"/>

    <meta name="twitter:description" content="Creating Settings View #

The settings view will allow a logged in user to change preferences like default language, expiration and exposure. It also…"/>


<meta name="twitter:title" content="Building profile pages for Djangobin"/>
<meta name="twitter:site" content="@infoOverIQ"/>

<meta name="twitter:creator" content="@infoOverIQ"/>




    
    
    


    
    
    


    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../feed.xml/index.html"/>
    
    
    <link href="../../../fonts.googleapis.com/cssd2d5.css?family=Open+Sans" rel="stylesheet"/>
    <link rel="stylesheet" href="../../../maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="icon" href="../../static/wiki/favicon.png" sizes="32x32"/>

    <link rel="stylesheet" href="../../static/CACHE/css/output.db46da465a8b.css" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-125424793-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125424793-1');
    </script>


<script type='text/javascript'>
var ezoTemplate = 'orig_site';
var ezouid = '1';
var ezoFormfactor = '1';
</script><script data-ezscrex="false" type='text/javascript'>
var soc_app_id = '0';
var did = 92771;
var ezdomain = 'overiq.com';
var ezoicSearchable = 1;
</script></head>
<body>

<div class="overiq-header text-center">
    <div class="site-branding">
        <p class="main-title">
            <a href="../../index.html" rel="home">
                OverIQ.com
            </a>
        </p>
    </div>
</div>

<!-- Navigation -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html">Home</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                

                <li>
                    <a href="../../blog/index.html">Blog</a>
                </li>
                <li>
                    <a href="../../contact/index.html">Contact</a>
                </li>
                <li>
                    <a href="../../about/index.html">About</a>
                </li>
            </ul>

            <ul class="nav navbar-nav navbar-right visible-lg visible-md">
                <li>
                    <a href="../../feed.xml/index.html" title="RSS" target="_blank">
                        <i class="fa fa-rss fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/overiq/" target="_blank" title="Github">
                        <i class="fa fa-github fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://www.facebook.com/OverIQ/" target="_blank" title="Facebook">
                        <i class="fa fa-facebook fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://twitter.com/infoOverIQ" target="_blank" title="Twitter">
                        <i class="fa fa-twitter fa-lg" aria-hidden="true"></i>
                    </a>
                </li>

                

            </ul>

            <form action="https://overiq.com/search/" class="navbar-form navbar-left" role="search">

                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search" name="query" value=""/>
                </div>

                <button type="submit" class="btn btn-default">Submit</button>
            </form>

        </div>



        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<div class="container">

    


    <div class="se-pre-con"></div>

    

    <div class="row">

        
        <div class="main">
            <div class="col-lg-8 col-md-8 col-sm-12">
                

    


    
        <ol class="breadcrumb">

    <li><a href="../../index.html">Home</a></li>

    
        
        <li><a href="../index.html">Django 1.11 Tutorial</a></li>
        

        

        
    
        

        

        
            <li class="active">Building profile pages for Djangobin</li>
        
    

</ol>
    


<h1>Building profile pages for Djangobin</h1>




    <p><i class="fa fa-calendar" aria-hidden="true"></i>
        Last updated on July 27, 2020
    </p>


<hr/>



<span id="creating-settings-view" class="anchor-target"></span><h2 class="heading">Creating Settings View <a class="header-link" href="#creating-settings-view">#</a></h2>

<p>The settings view will allow a logged in user to change preferences like default language, expiration and exposure. It also allows a user to change the profile visibility option.</p>

<p>The profile view (which we will create next) shows a paginated list of snippets created by the user in reverse chronological order (i.e latest first). By default, the profile page is public.</p>

<p>All these settings are defined by the <code>Author</code> model. For your reference, here is how it looks like:</p>

<p><strong>djangobin/django_project/djangobin/models.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>
    <span class="n">default_language</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Language</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                                         <span class="n">default</span><span class="o">=</span><span class="n">get_default_language</span><span class="p">)</span>
    <span class="n">default_exposure</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">Pref</span><span class="o">.</span><span class="n">exposure_choices</span><span class="p">,</span>
                                        <span class="n">default</span><span class="o">=</span><span class="n">Pref</span><span class="o">.</span><span class="n">SNIPPET_EXPOSURE_PUBLIC</span><span class="p">)</span>
    <span class="n">default_expiration</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">Pref</span><span class="o">.</span><span class="n">expiration_choices</span><span class="p">,</span>
                                        <span class="n">default</span><span class="o">=</span><span class="n">Pref</span><span class="o">.</span><span class="n">SNIPPET_EXPIRE_NEVER</span><span class="p">)</span>
    <span class="n">private</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">views</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#...</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Let&#39;s start by adding a class named <code>SettingForm</code> in <code>forms.py</code> as follows:</p>

<p><strong>djangobin/django_project/djangobin/forms.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="k">class</span> <span class="nc">SettingForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>    

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;default_language&#39;</span><span class="p">,</span> <span class="s1">&#39;default_expiration&#39;</span> <span class="p">,</span> <span class="s1">&#39;default_exposure&#39;</span> <span class="p">,</span> <span class="s1">&#39;private&#39;</span><span class="p">)</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;default_language&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;selectpicker foo form-control&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;data-live-search&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;data-size&#39;</span><span class="p">:</span> <span class="s1">&#39;5&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;default_expiration&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;selectpicker form-control&#39;</span><span class="p">}),</span>
            <span class="s1">&#39;default_exposure&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;selectpicker form-control&#39;</span><span class="p">})</span>

        <span class="p">}</span>
</pre></div>
</td></tr></tbody></table></div>
<p>In the <code>views.py</code>, add <code>settings()</code> view just below the <code>activate_account()</code> view as follows:</p>

<p><strong>djangobin/django_project/djangobin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">SnippetForm</span><span class="p">,</span> <span class="n">ContactForm</span><span class="p">,</span> <span class="n">LoginForm</span><span class="p">,</span> <span class="n">CreateUserForm</span><span class="p">,</span> <span class="n">SettingForm</span>
<span class="c1">#...</span>


<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">SettingForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;Settings Saved.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;djangobin:settings&#39;</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">SettingForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangobin/settings.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The code for <code>settings.html</code> template is as follows:</p>

<p><strong>djangobin/django_project/djangobin/templates/djangobin/settings.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;djangobin/base.html&#39;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">humanize</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    Account Preferences - </span><span class="cp">{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">main</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">    &lt;div class=&#34;row&#34;&gt;</span>

<span class="x">        &lt;div class=&#34;col-lg-6 col-md-6 col-sm-6&#34;&gt;</span>

<span class="x">            &lt;h4&gt;Change Account Preferences&lt;/h4&gt;</span>

<span class="x">            &lt;hr&gt;</span>

<span class="x">            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                    &lt;p class=&#34;alert alert-info&#34;&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x">&lt;/p&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">            &lt;form action=&#34;&#34; method=&#34;post&#34; class=&#34;form-horizontal&#34; &gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">                &lt;table class=&#34;table&#34;&gt;</span>
<span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.as_table</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">                    &lt;tr&gt;</span>
<span class="x">                        &lt;td&gt;&amp;nbsp;&lt;/td&gt;</span>
<span class="x">                        &lt;td&gt;&lt;button type=&#34;submit&#34; class=&#34;btn btn-primary&#34;&gt;Submit&lt;/button&gt;&lt;/td&gt;</span>
<span class="x">                    &lt;/tr&gt;</span>
<span class="x">                &lt;/table&gt;</span>

<span class="x">            &lt;/form&gt;</span>

<span class="x">        &lt;/div&gt;</span>

<span class="x">        &lt;div class=&#34;col-lg-6 col-md-6 col-sm-6&#34;&gt;</span>
<span class="x">            &lt;h4&gt;Related Links&lt;/h4&gt;</span>
<span class="x">            &lt;p&gt;</span>
<span class="x">                &lt;a href=&#34;&#34;&gt;My Pastes&lt;/a&gt; &lt;br&gt;</span>
<span class="x">                &lt;a href=&#34;&#34;&gt;Account Details&lt;/a&gt; &lt;br&gt;</span>
<span class="x">                &lt;a href=&#34;/password-change/&#34;&gt;Change Password.&lt;/a&gt; &lt;br&gt;</span>
<span class="x">            &lt;/p&gt;</span>
<span class="x">        &lt;/div&gt;</span>

<span class="x">    &lt;/div&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>Add a new URL pattern named <code>settings</code> to <code>urls.py</code> as follows:</p>

<p><strong>djangobin/django_project/djangobin/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">#...</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;password-reset-complete/$&#39;</span><span class="p">,</span>
        <span class="n">auth_views</span><span class="o">.</span><span class="n">password_reset_complete</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span><span class="s1">&#39;djangobin/password_reset_complete.html&#39;</span><span class="p">},</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_complete&#39;</span><span class="p">),</span>

<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="s1">&#39;^settings/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;settings&#39;</span><span class="p">),</span>
</span><span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>At last, add a link to the settings page to <code>base.html</code> as follows:</p>

<p><strong>djangobin/django_project/djangobin/templates/djangobin/base.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# ... #}</span><span class="x"></span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                        &lt;ul class=&#34;dropdown-menu&#34;&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;&#34;&gt;My Pastes&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;&#34;&gt;Account Details&lt;/a&gt;&lt;/li&gt;</span>
<span class="hll"><span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:settings&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Settings&lt;/a&gt;&lt;/li&gt;</span>
</span><span class="x">                            &lt;li role=&#34;separator&#34; class=&#34;divider&#34;&gt;&lt;/li&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:logout&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Logout&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                        &lt;/ul&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                        &lt;ul class=&#34;dropdown-menu&#34;&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:signup&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Sign Up&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:login&#39;</span> <span class="cp">%}</span><span class="x">?next=</span><span class="cp">{{</span> <span class="nv">request.path</span> <span class="cp">}}</span><span class="x">&#34;&gt;Login&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                        &lt;/ul&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="c">{# ... #}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>Login to Djangobin and visit <code>http://localhost:8000/settings/</code>. You should see Account Preferences page like this:</p>

<p><img src="../../media/uploads/2018/5/28/Selection_214-e40de002-dc18-4c09-a831-6661f44a647e.png" loading="lazy" alt=""/></p>

<p>Select the desired preferences and hit submit. You should see a <code>&#34;Settings Saved.&#34;</code> message as follows:</p>

<p><img src="../../media/uploads/2018/5/28/Selection_215-571282cc-c238-49a5-a937-2a5ccf8a0e7d.png" loading="lazy" alt=""/></p>
<span id="creating-profile-view" class="anchor-target"></span><h2 class="heading">Creating Profile View <a class="header-link" href="#creating-profile-view">#</a></h2>

<p>The profile view shows a paginated list of snippets created by a user in reverse chronological order (i.e latest first). If the user&#39;s profile is private then its username will not appear in the trending snippet page, and tag list page.</p>

<p>Open <code>views.py</code> and update <code>profile()</code> view function as follows:</p>

<p><strong>djangobin/django_project/djangobin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="p">(</span><span class="n">HttpResponse</span><span class="p">,</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span>
                        <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">get_list_or_404</span><span class="p">,</span> <span class="n">Http404</span><span class="p">)</span>
<span class="c1">#...</span>


<span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

    <span class="c1"># if the profile is private and logged in user is not same as the user being viewed,</span>
    <span class="c1"># show 404 error</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">private</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span>

    <span class="c1"># if the profile is not private and logged in user is not same as the user being viewed,</span>
    <span class="c1"># then only show public snippets of the user</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">private</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">:</span>
        <span class="n">snippet_list</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">snippet_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">exposure</span><span class="o">=</span><span class="s1">&#39;public&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c1"># logged in user is same as the user being viewed</span>
    <span class="c1"># show everything</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">snippet_list</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">snippet_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">snippets</span> <span class="o">=</span> <span class="n">paginate_result</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">snippet_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangobin/profile.html&#39;</span><span class="p">,</span>
                  <span class="p">{</span><span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="n">user</span><span class="p">,</span> <span class="s1">&#39;snippets&#39;</span> <span class="p">:</span> <span class="n">snippets</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>This is how the view function works:</p>

<ol>
<li><p>The view takes an additional argument named <code>username</code> which will come from the URL.</p></li>
<li><p>In line 7, we are using <code>get_object_or_404()</code> to fetch the relevant <code>User</code> object. If no matching object found, <code>get_object_or_404()</code> will return an HTTP 404 error.</p></li>
<li><p>In line 11, we are checking if the profile is private and logged in user is not same as the user being viewed. If the condition comes out to be true we show an HTTP 404 error; otherwise, the program control is transferred to the elif statement in line 16.</p></li>
<li><p>In line 16, we are checking if the profile is not private and logged in user is not same as the user being viewed. If the condition is true, we retrieve the public snippets of the user and increment the profile view count by 1; otherwise, the program control is transferred to the else statement in line 23.</p></li>
<li><p>If the program control comes to the else statement then it means that the logged in user is same as the user being viewed. As a result, we fetch all the snippets of the user.</p></li>
<li><p>In line 26, we are calling <code>paginate_result()</code> to get the paginated result. Finally, in line 28, we render the template with the context data by calling <code>render()</code> function. </p></li>
</ol>

<p>The code for the <code>profile.html</code> is as follows:</p>

<p><strong>djangobin/django_project/djangobin/templates/djangobin/profile.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;djangobin/base.html&#39;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">humanize</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">main</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">    &lt;div class=&#34;media post-meta&#34;&gt;</span>
<span class="x">        &lt;div class=&#34;media-left&#34;&gt;</span>
<span class="x">            &lt;a href=&#34;#&#34;&gt;</span>
<span class="x">                &lt;img alt=&#34;64x64&#34; class=&#34;media-object&#34; data-src=&#34;holder.js/64x64&#34; src=&#34;data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PCEtLQpTb3VyY2UgVVJMOiBob2xkZXIuanMvNjR4NjQKQ3JlYXRlZCB3aXRoIEhvbGRlci5qcyAyLjYuMC4KTGVhcm4gbW9yZSBhdCBodHRwOi8vaG9sZGVyanMuY29tCihjKSAyMDEyLTIwMTUgSXZhbiBNYWxvcGluc2t5IC0gaHR0cDovL2ltc2t5LmNvCi0tPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbI2hvbGRlcl8xNjFkYzE3YWQ0ZiB0ZXh0IHsgZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQgfSBdXT48L3N0eWxlPjwvZGVmcz48ZyBpZD0iaG9sZGVyXzE2MWRjMTdhZDRmIj48cmVjdCB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIGZpbGw9IiNFRUVFRUUiLz48Zz48dGV4dCB4PSIxMi4xNzk2ODc1IiB5PSIzNi41Ij42NHg2NDwvdGV4dD48L2c+PC9nPjwvc3ZnPg==&#34; data-holder-rendered=&#34;true&#34; style=&#34;width: 64px; height: 64px;&#34;&gt;</span>
<span class="x">            &lt;/a&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;div class=&#34;media-body&#34;&gt;</span>
<span class="x">            &lt;h4 class=&#34;media-heading&#34;&gt;</span><span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">capfirst</span> <span class="cp">}}</span><span class="x">&#39;s Pastes&lt;/h4&gt;</span>
<span class="x">            &lt;p&gt;</span>
<span class="x">                &lt;i class=&#34;fas fa-calendar-alt&#34; data-toggle=&#34;tooltip&#34; title=&#34;&#34; data-original-title=&#34;Account creation date&#34; &gt;&lt;/i&gt; </span><span class="cp">{{</span> <span class="nv">user.date_joined</span> <span class="cp">}}</span><span class="x"> &amp;nbsp;</span>
<span class="x">                &lt;i class=&#34;fas fa-eye&#34; data-toggle=&#34;tooltip&#34; title=&#34;&#34; data-original-title=&#34;Visits to this page&#34;&gt;&lt;/i&gt; </span><span class="cp">{{</span> <span class="nv">user.profile.views</span> <span class="cp">}}</span><span class="x"> &amp;nbsp;</span>
<span class="x">            &lt;/p&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>


<span class="x">    &lt;table class=&#34;table&#34;&gt;</span>
<span class="x">        &lt;thead&gt;</span>
<span class="x">        &lt;tr&gt;</span>
<span class="x">            &lt;th&gt;Title&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;Date&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;Hits&lt;/th&gt;</span>
<span class="x">            &lt;th class=&#34;hidden-md&#34;&gt;Expires&lt;/th&gt;</span>
<span class="x">            &lt;th class=&#34;hidden-md&#34;&gt;Exposure&lt;/th&gt;</span>
<span class="x">            &lt;th class=&#34;hidden-md&#34;&gt;Language&lt;/th&gt;</span>
<span class="x">        &lt;/tr&gt;</span>
<span class="x">        &lt;/thead&gt;</span>
<span class="x">        &lt;tbody&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">snippet</span> <span class="k">in</span> <span class="nv">snippets</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;tr&gt;</span>
<span class="x">                &lt;td&gt;&lt;i class=&#34;fas fa-globe&#34;&gt;&lt;/i&gt;</span>
<span class="x">                    &lt;a href=&#34;</span><span class="cp">{{</span> <span class="nv">snippet.get_absolute_url</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">snippet.title</span><span class="o">|</span><span class="nf">default</span><span class="s2">:&#34;Untitled&#34;</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
<span class="x">                &lt;/td&gt;</span>
<span class="x">                &lt;td title=&#34;</span><span class="cp">{{</span> <span class="nv">snippet.created_on</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">snippet.created_on</span><span class="o">|</span><span class="nf">naturaltime</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">snippet.hits</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">snippet.expiration</span><span class="o">|</span><span class="nf">capfirst</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">snippet.exposure</span><span class="o">|</span><span class="nf">capfirst</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&#34;</span><span class="cp">{{</span> <span class="nv">snippet.language.get_absolute_url</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">snippet.language</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">            &lt;/tr&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;/tbody&gt;</span>
<span class="x">    &lt;/table&gt;</span>

<span class="x">    </span><span class="c">{#  display pagination links  #}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">snippets.paginator.num_pages</span> <span class="o">&gt;</span> <span class="m">1</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;nav aria-label=&#34;...&#34;&gt;</span>
<span class="x">            &lt;ul class=&#34;pager&#34;&gt;</span>

<span class="x">                &lt;li&gt;Page </span><span class="cp">{{</span> <span class="nv">snippets.number</span> <span class="cp">}}</span><span class="x"> of </span><span class="cp">{{</span> <span class="nv">snippets.paginator.num_pages</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>

<span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">snippets.has_previous</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                    &lt;li&gt;&lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">snippets.previous_page_number</span> <span class="cp">}}</span><span class="x">&#34;&gt;Previous&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">snippets.has_next</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                    &lt;li&gt;&lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">snippets.next_page_number</span> <span class="cp">}}</span><span class="x">&#34;&gt;Next&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">            &lt;/ul&gt;</span>
<span class="x">        &lt;/nav&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>Next, add a link to the profile view in <code>base.html</code> template as follows:</p>

<p><strong>djangobin/django_project/djangobin/templates/djangobin/base.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# ... #}</span><span class="x"></span>
<span class="x">            &lt;ul class=&#34;nav navbar-nav navbar-right&#34;&gt;</span>
<span class="x">                &lt;li class=&#34;dropdown&#34;&gt;</span>
<span class="x">                    &lt;a href=&#34;#&#34; class=&#34;dropdown-toggle&#34; data-toggle=&#34;dropdown&#34; role=&#34;button&#34;</span>
<span class="x">                       aria-haspopup=&#34;true&#34; aria-expanded=&#34;false&#34;&gt;</span>
<span class="x">                        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                            </span><span class="cp">{{</span> <span class="nv">request.user.username</span><span class="o">|</span><span class="nf">upper</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">                        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                            GUEST</span>
<span class="x">                        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                        &lt;span class=&#34;caret&#34;&gt;&lt;/span&gt;</span>
<span class="x">                    &lt;/a&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                        &lt;ul class=&#34;dropdown-menu&#34;&gt;</span>
<span class="hll"><span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:profile&#39;</span> <span class="nv">request.user</span> <span class="cp">%}</span><span class="x">&#34;&gt;My Pastes&lt;/a&gt;&lt;/li&gt;</span>
</span><span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:user_details&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Account Details&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:settings&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Settings&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                            &lt;li role=&#34;separator&#34; class=&#34;divider&#34;&gt;&lt;/li&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:logout&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;Logout&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                        &lt;/ul&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                        &lt;ul class=&#34;dropdown-menu&#34;&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;&#34;&gt;Sign Up&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:login&#39;</span> <span class="cp">%}</span><span class="x">?next=</span><span class="cp">{{</span> <span class="nv">request.path</span> <span class="cp">}}</span><span class="x">&#34;&gt;Login&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">                        &lt;/ul&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">                &lt;/li&gt;</span>
<span class="x">            &lt;/ul&gt;</span>
<span class="c">{# ... #}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>To view the profile page login to Djangobin, click the dropdown at the top right corner of the screen and select My Pastes.</p>

<p><img src="../../media/uploads/2018/5/28/Selection_216-47c868b4-2213-4b04-bf7e-aefdbba87943.png" loading="lazy" alt=""/></p>

<p>You should see profile page of the logged in user as follows:</p>

<p><img src="../../media/uploads/2018/5/28/Selection_218-5ea13057-fde9-49f9-a8c1-abeb3d86d920.png" loading="lazy" alt=""/></p>

<p>To view, the profile page of other users visit trending snippets page or tag list page and click on the usernames listed in the User column.</p>

<p><img src="../../media/uploads/2018/5/28/Selection_219-fe4f6db0-af54-4dfd-8eee-4d02aeb4c440.png" loading="lazy" alt=""/></p>

<p>Note that the profile link in trending snippets and tag list page will only appear when the user profile is not private. If the profile is private then you will see a dash (<code>-</code>) in place of the username.</p>

<p><img src="../../media/uploads/2018/5/28/Selection_220-40181027-98c4-45bb-b537-95541c601ed2.png" loading="lazy" alt=""/></p>
<span id="creating-decorators-for-views" class="anchor-target"></span><h2 class="heading">Creating Decorators for Views <a class="header-link" href="#creating-decorators-for-views">#</a></h2>

<p>Everything appears to be working great, but in reality, our application suffers from a major privacy concern regarding the private snippets. </p>

<p>We want private snippets to be accessible only to the users who created them (after they are logged in). However, as things stand, if you know the URL of the private snippet then you can access them no matter whether you have created it or not. In other words, private snippets are treated just like unlisted snippets (remember that unlisted snippets are the snippets that do not appear on any pages our the site. Only the users that have a link to the snippet can access it).</p>

<p>You can verify this by logging in to Djangobin and creating a private snippet. Copy the snippet URL, open a new browser window in &#34;private&#34; or &#34;incognito&#34; mode and paste the URL and you should be able to view the snippet.</p>

<p>The issue is not just limited to viewing snippets. The users can also view raw snippets and download them.</p>

<p>At first you might think, doing something like this would resolve issue:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">snippet_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">snippet_slug</span><span class="p">):</span>
    <span class="n">snippet</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Snippet</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">snippet_slug</span><span class="p">)</span>

    <span class="c1"># if the snippet is private and snippet&#39;s creator is not the same as logged in user, </span>
    <span class="c1"># show HTTP 404 error</span>
    <span class="k">if</span> <span class="n">snippet</span><span class="o">.</span><span class="n">exposure</span> <span class="o">==</span> <span class="s1">&#39;private&#39;</span> <span class="ow">and</span> <span class="n">snippet</span><span class="o">.</span><span class="n">user</span> <span class="o">!=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span>

    <span class="n">snippet</span><span class="o">.</span><span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">snippet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangobin/snippet_detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;snippet&#39;</span><span class="p">:</span> <span class="n">snippet</span><span class="p">,})</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Certainly, this is one of the possible ways to fix the problem. But if you go by this route you would have to copy and paste same code over and over again in all the other views. We can do much better - decorators to the rescue.</p>

<p>Decorators are special functions that takes other another function as an argument and extends the original function without explicitly modifying it. You can think of decorators as a guard for your function, before calling the original function the decorator is run, which makes them suitable for performing tasks (or tests) that needs to be done before the original function gets called. </p>

<p>We have been using <code>login_required</code> decorator for a while without paying much attention to it.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1">#...</span>
    <span class="k">pass</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Here is what happens when you visit the URL tied to the <code>my_view</code> function.</p>

<p>The <code>login_required()</code> decorator is called to check whether the user is logged in or not. If the user is not logged then it will redirect the user to <code>/account/login/</code> (or the URL specified by <code>LOGIN_URL</code> setting); otherwise, the <code>my_view()</code> function would be called as usual.</p>

<p>With the basic concept of decorators under out belt. We will now create our own custom decorator.</p>

<p>Create a new file named <code>decorators.py</code> next to <code>models.py</code> and add the following code to it:</p>

<p><strong>djangobin/django_project/djangobin/decorators.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">Http404</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Language</span><span class="p">,</span> <span class="n">Snippet</span>


<span class="k">def</span> <span class="nf">private_snippet</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="n">snippet</span> <span class="o">=</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;snippet_slug&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">snippet</span><span class="o">.</span><span class="n">exposure</span> <span class="o">==</span> <span class="s1">&#39;private&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="o">!=</span> <span class="n">snippet</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Http404</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Here we are defining a decorator named <code>private_snippet</code>. It checks whether the snippet exposure is private and logged in user is same as the snippet creator. If it is, it calls the view function; otherwise, it shows an HTTP 404 error.</p>

<p>Now modify, <code>views.py</code> to use <code>private_snippet</code> decorator as follows:</p>

<p><strong>djangobin/django_project/djangobin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">SnippetForm</span><span class="p">,</span> <span class="n">ContactForm</span><span class="p">,</span> <span class="n">LoginForm</span><span class="p">,</span> <span class="n">CreateUserForm</span><span class="p">,</span> <span class="n">SettingForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Language</span><span class="p">,</span> <span class="n">Snippet</span><span class="p">,</span> <span class="n">Tag</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">paginate_results</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.decorators</span> <span class="kn">import</span> <span class="n">private_snippet</span>
</span>
<span class="c1">#...</span>

<span class="hll"><span class="nd">@private_snippet</span>
</span><span class="k">def</span> <span class="nf">snippet_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">snippet_slug</span><span class="p">):</span>
    <span class="n">snippet</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Snippet</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">snippet_slug</span><span class="p">)</span>
    <span class="n">snippet</span><span class="o">.</span><span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">snippet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangobin/snippet_detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;snippet&#39;</span><span class="p">:</span> <span class="n">snippet</span><span class="p">,})</span>


<span class="hll"><span class="nd">@private_snippet</span>
</span><span class="k">def</span> <span class="nf">download_snippet</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">snippet_slug</span><span class="p">):</span>
    <span class="n">snippet</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Snippet</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">snippet_slug</span><span class="p">)</span>
    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">snippet</span><span class="o">.</span><span class="n">language</span><span class="o">.</span><span class="n">file_extension</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">snippet</span><span class="o">.</span><span class="n">slug</span> <span class="o">+</span> <span class="n">file_extension</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">snippet</span><span class="o">.</span><span class="n">original_code</span><span class="p">)</span>
    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&#34;;&#34;</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="hll"><span class="nd">@private_snippet</span>
</span><span class="k">def</span> <span class="nf">raw_snippet</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">snippet_slug</span><span class="p">):</span>
    <span class="n">snippet</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Snippet</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">snippet_slug</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">snippet</span><span class="o">.</span><span class="n">original_code</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">snippet</span><span class="o">.</span><span class="n">language</span><span class="o">.</span><span class="n">mime</span><span class="p">)</span>

<span class="c1">#...</span>
</pre></div>
</td></tr></tbody></table></div>
<p>If you now try to view or download the private snippet of another user you will get an HTTP 404 error.</p>
<span id="initializing-snippetform-with-preferences" class="anchor-target"></span><h2 class="heading">Initializing SnippetForm with Preferences <a class="header-link" href="#initializing-snippetform-with-preferences">#</a></h2>

<p>With the settings view in place, users can now set their preferences. But as things stand, everytime you create a new snippet you have to select values from <code>language</code>, <code>expiration</code> and <code>exposure</code> fields. If most of the time you create public snippets which never expires, then it makes sense to automatically initialize <code>expiration</code> and <code>exposure</code> fields to <code>Never</code> and <code>Public</code> respectively.</p>

<p>Another point I would like to draw your attention to are the options of the <code>Exposure</code> field. Currently, the <code>Exposure</code> dropdown shows three options: <code>Public</code>, <code>Unlisted</code> and <code>Private</code>. These options are always displayed no matter whether the user is logged in or not. A user can&#39;t create private snippets unless he is logged in, hence displaying <code>Private</code> option to a guest user is completely pointless. Further, creating private snippets as a guest doesn&#39;t make sense because you won&#39;t be able to access them. A better way would be to display <code>Private</code> option only when the user is logged in. That way we would be able to associate the private snippet to the logged in user.</p>

<p>To make these changes we have to change the way the form is initialized. Open <code>form.py</code> file and override the <code>__init__()</code> method of the <code>SnippetForm</code> as follows:</p>

<p><strong>djangobin/django_project/djangobin/forms.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">Preference</span> <span class="k">as</span> <span class="n">Pref</span><span class="p">,</span> <span class="n">get_current_user</span>
</span><span class="c1">#...</span>


<span class="k">class</span> <span class="nc">SnippetForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="c1">#...</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c1">#...</span>

    <span class="c1"># override default __init__ so we can set the user preferences</span>
<span class="hll">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">(</span><span class="n">SnippetForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
</span><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">Pref</span><span class="o">.</span><span class="n">exposure_choices</span>
</span><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get_preferences</span><span class="p">()</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> \
</span><span class="hll">                <span class="p">[</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Pref</span><span class="o">.</span><span class="n">exposure_choices</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;private&#39;</span> <span class="p">]</span>
</span><span class="hll">
</span><span class="hll">            <span class="n">l</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Plain Text&#39;</span><span class="p">)</span>
</span><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;exposure&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;expiration&#39;</span><span class="p">:</span> <span class="s1">&#39;never&#39;</span><span class="p">}</span>
</span></pre></div>
</td></tr></tbody></table></div>
<p>In addition to <code>request</code> argument, we specify that the <code>__init__()</code> accepts <code>*args</code> and <br/>
<code>**kwargs</code>. This is just a Pythonic way of saying that <code>__init__()</code> can take an arbitrary number of positional and keyword arguments.</p>

<p>In line 14, we are calling the parent class&#39;s <code>__init__()</code> method, this is necessary to preserve the functionalities provided by the base <code>__init__()</code> method.</p>

<p>In line 16, we check whether the user is logged in or not using the <code>is_authenticated</code> attribute of the <code>User</code> object. If the user is logged in, we assign all exposure choices to the <code>exposure</code> field.</p>

<p>In the next line, we use <code>get_preferences</code> method of the <code>Author</code> model to provide initial values to <code>language</code>, <code>expiration</code> and <code>exposure</code> fields. The <code>get_preferences()</code> method is defined in <code>Author</code> model as follows:</p>

<p><strong>djangobin/django_project/djangobin/models.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1">#...</span>

    <span class="k">def</span> <span class="nf">get_snippet_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">snippet_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_preferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_language</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;exposure&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_exposure</span><span class="p">,</span>
                <span class="s1">&#39;expiration&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_expiration</span><span class="p">}</span>
</pre></div>
</td></tr></tbody></table></div>
<p>On the other hand, if the user is not logged in. Then we only provide two options to the <code>exposure</code> field: <code>Public</code> and <code>Unlisted</code>. At last, in line 24, we set the initial values for the guest user.</p>

<p>Now, modify the <code>index()</code> view to use updated <code>SnippetForm</code> as follows:</p>

<p><strong>djangobin/django_project/djangobin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
<span class="hll">        <span class="n">f</span> <span class="o">=</span> <span class="n">SnippetForm</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">snippet</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;djangobin:snippet_detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">snippet</span><span class="o">.</span><span class="n">slug</span><span class="p">]))</span>

    <span class="k">else</span><span class="p">:</span>
<span class="hll">        <span class="n">f</span> <span class="o">=</span> <span class="n">SnippetForm</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span>    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangobin/index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">}</span> <span class="p">)</span>

<span class="c1">#...</span>
</pre></div>
</td></tr></tbody></table></div>
<p>To view the fruits of our labor, open your browser and navigate to <code>http://localhost:8000/</code>. You will see that the Language, Expiration and Exposure fields are pre-populated with data as follows:</p>

<p><img src="../../media/uploads/2018/5/28/Selection_221-b5e5c492-89cf-4324-8734-ea5de2abb5bf.png" loading="lazy" alt=""/></p>

<p>If you are logged in then the fields will get populated based on your preferences.</p>
<span id="deleting-snippets" class="anchor-target"></span><h3 class="heading">Deleting Snippets <a class="header-link" href="#deleting-snippets">#</a></h3>

<p>In this section, we are going to add a view function to delete snippets.</p>

<p>Open <code>views.py</code> and add a view named <code>delete_snippet()</code> just below the <code>profile()</code> view as follows:</p>

<p><strong>djangobin/django_project/djangobin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>

<span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
    <span class="c1">#....</span>

<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">delete_snippet</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">snippet_slug</span><span class="p">):</span>
    <span class="n">snippet</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Snippet</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">snippet_slug</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">snippet</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span>
    <span class="n">snippet</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;djangobin:profile&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The view function work as follows:</p>

<ol>
<li>The <code>delete_snippet()</code> accepts two parameters <code>request</code> and <code>snippet_slug</code>.</li>
<li>In line 8, we try to retrieve the <code>Snippet</code> object using <code>get_object_or_404()</code> function. If no matching snippet found, <code>get_object_or_404()</code> will return HTTP 404 error.</li>
<li>In line 9, we test whether the logged in user is the snippet author or not. If not, we show an HTTP 404 error, otherwise, we delete the snippet using the <code>delete()</code> method (line 11).</li>
<li>Finally, in line 12, we redirect the logged in user to the profile page.</li>
</ol>

<p>Next, add a new URL pattern to delete snippets in <code>urls.py</code> as follows:</p>

<p><strong>djangobin/django_project/djangobin/urls.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">#...</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^password-change-done/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">password_change_done</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;djangobin/password_change_done.html&#39;</span><span class="p">},</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change_done&#39;</span>
        <span class="p">),</span>

    <span class="n">url</span><span class="p">(</span><span class="s1">&#39;^settings/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;settings&#39;</span><span class="p">),</span>
<span class="hll">    <span class="n">url</span><span class="p">(</span><span class="s1">&#39;^delete/(?P&lt;snippet_slug&gt;[\d]+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">delete_snippet</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;delete_snippet&#39;</span><span class="p">),</span>
</span><span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Now, let&#39;s add a link to delete snippets in the snippet detail page:</p>

<p><strong>djangobin/django_project/djangobin/templates/djangobin/snippet_detail.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# ... #}</span><span class="x"></span>
<span class="x">    &lt;div class=&#34;toolbar clearfix&#34;&gt;</span>
<span class="x">            &lt;span class=&#34;at-left&#34;&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:trending_snippets&#39;</span> <span class="nv">snippet.language.slug</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">snippet.language</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/span&gt;</span>
<span class="x">            &lt;span class=&#34;at-right&#34;&gt;</span>
<span class="hll"><span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">snippet.user</span> <span class="o">==</span> <span class="nv">request.user</span> <span class="cp">%}</span><span class="x"></span>
</span><span class="hll"><span class="x">                    &lt;a onclick=&#34;return confirm(&#39;Sure you want to delete this paste? &#39;)&#34;</span>
</span><span class="hll"><span class="x">                   href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:delete_snippet&#39;</span> <span class="nv">snippet.slug</span> <span class="cp">%}</span><span class="x">&#34;&gt;delete&lt;/a&gt;</span>
</span><span class="hll"><span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</span><span class="x">                &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:raw_snippet&#39;</span> <span class="nv">snippet.slug</span> <span class="cp">%}</span><span class="x">&#34;&gt;raw&lt;/a&gt;</span>
<span class="x">                &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;djangobin:download_snippet&#39;</span> <span class="nv">snippet.slug</span> <span class="cp">%}</span><span class="x">&#34;&gt;download&lt;/a&gt;</span>
<span class="x">            &lt;/span&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="c">{# ... #}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>We want to show delete link only to the user who created the snippet. In line 5, we use <code>{% if %}</code> tag to check we check whether the logged in user is the snippet author. If so, we display the link to delete the snippet.</p>
<span id="revisiting-contact-form" class="anchor-target"></span><h2 class="heading">Revisiting Contact Form <a class="header-link" href="#revisiting-contact-form">#</a></h2>

<p>Our Contact form consists of four fields (name, email, purpose and message) and all of them are required. </p>

<p>However, asking a logged in user for name and email is undesirable. We better hide these fields if the user is logged in and populate them automatically while sending the email.</p>

<p>Note that just hiding the fields from the form will not make them optional. We will have to set the <code>required</code> attribute of the field to <code>False</code> dynamically, to make it optional.</p>

<p>To accomplish this we will override the <code>__init__()</code> method of the <code>Form</code> class.</p>

<p>Open <code>forms.py</code> file and modify <code>ContactForm</code> class as follows:</p>

<p><strong>djangobin/django_project/djangobin/forms.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ContactForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="c1">#...</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>
    <span class="n">purpose</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">purpose_choices</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cols&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}))</span>

<span class="hll">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">(</span><span class="n">ContactForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
</span><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="bp">False</span>
</span></pre></div>
</td></tr></tbody></table></div>
<p>In line 10, we test whether the user is authenticated. If so, we make the name and email field optional by setting their <code>required</code> attribute to <code>False</code>.</p>

<p>Next, modify the <code>contact.html</code> as follows:</p>

<p><strong>djangobin/django_project/djangobin/templates/djangobin/contact.html</strong></p>
<div class="codeblock language-jinja"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# ... #}</span><span class="x"></span>
<span class="x">    &lt;form method=&#34;post&#34;&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>

<span class="hll"><span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span><span class="x"></span>
</span><span class="hll">
</span><span class="hll"><span class="x">            &lt;div class=&#34;form-group row&#34;&gt;</span>
</span><span class="hll"><span class="x">                &lt;div class=&#34;col-lg-5&#34;&gt;</span>
</span><span class="hll"><span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.name.errors</span> <span class="cp">}}</span><span class="x"></span>
</span><span class="hll"><span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.name.label_tag</span> <span class="cp">}}</span><span class="x"></span>
</span><span class="hll"><span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.name</span> <span class="cp">}}</span><span class="x"></span>
</span><span class="hll"><span class="x">                &lt;/div&gt;</span>
</span><span class="hll"><span class="x">            &lt;/div&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="x">            &lt;div class=&#34;form-group row&#34;&gt;</span>
</span><span class="hll"><span class="x">                &lt;div class=&#34;col-lg-5&#34;&gt;</span>
</span><span class="hll"><span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.email.errors</span> <span class="cp">}}</span><span class="x"></span>
</span><span class="hll"><span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.email.label_tag</span> <span class="cp">}}</span><span class="x"></span>
</span><span class="hll"><span class="x">                    </span><span class="cp">{{</span> <span class="nv">form.email</span> <span class="cp">}}</span><span class="x"></span>
</span><span class="hll"><span class="x">                &lt;/div&gt;</span>
</span><span class="hll"><span class="x">            &lt;/div&gt;</span>
</span><span class="hll">
</span><span class="hll"><span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</span>
<span class="x">        &lt;div class=&#34;form-group row&#34;&gt;</span>
<span class="x">            &lt;div class=&#34;col-lg-5&#34;&gt;</span>
<span class="x">                </span><span class="cp">{{</span> <span class="nv">form.purpose.errors</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">                </span><span class="cp">{{</span> <span class="nv">form.purpose.label_tag</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">                </span><span class="cp">{{</span> <span class="nv">form.purpose</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="c">{# ... #}</span><span class="x"></span>
</pre></div>
</td></tr></tbody></table></div>
<p>In lines 6-24, we use <code>{% if %}</code> tag to display name and email field only when the user is not logged in.</p>

<p>Finally, modify the <code>contact()</code> view as follows:</p>

<p><strong>djangobin/django_project/djangobin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="k">def</span> <span class="nf">contact</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
<span class="hll">        <span class="n">f</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
</span>        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>

<span class="hll">            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
</span><span class="hll">                <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span>
</span><span class="hll">                <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
</span><span class="hll">            <span class="k">else</span><span class="p">:</span>
</span><span class="hll">                <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span class="hll">                <span class="n">email</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</span><span class="hll">
</span><span class="hll">            <span class="n">subject</span> <span class="o">=</span> <span class="s2">&#34;You have a new Feedback from {}:&lt;{}&gt;&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;Purpose: {}</span><span class="se">\n\n</span><span class="s2">Date: {}</span><span class="se">\n\n</span><span class="s2">Message:</span><span class="se">\n\n</span><span class="s2"> {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">purpose_choices</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]),</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">send_feedback_mail</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

            <span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;Thanks for submitting your feedback.&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;djangobin:contact&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
<span class="hll">        <span class="n">f</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangobin/contact.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span>
<span class="c1">#...</span>
</pre></div>
</td></tr></tbody></table></div>
<p>In line 10, we test whether the user is authenticated. If so, we set name and email using <code>request.name</code> object. Otherwise, we set name and email using <code>cleaned_data</code> attribute of the form object.</p>

<p>If you now visit Contact form after logging in. You should see a form like this:</p>

<p><img src="../../media/uploads/2018/6/17/Selection_220-a0567ab8-1490-4b89-8678-92aae605d0cb.png" loading="lazy" alt=""/></p>

<p>Select purpose, enter your message and hit submit. As usual in the shell running the server you should get output like this:</p>
<div class="codeblock language-bash"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span><span class="m">17</span>/Jun/2018 <span class="m">06</span>:18:07<span class="o">]</span> <span class="s2">&#34;GET /contact/ HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">9406</span>
<span class="o">[</span><span class="m">17</span>/Jun/2018 <span class="m">06</span>:18:16<span class="o">]</span> <span class="s2">&#34;GET /contact/ HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">9939</span>
Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span>
MIME-Version: <span class="m">1</span>.0
Content-Transfer-Encoding: 7bit
Subject: <span class="o">[</span>Django<span class="o">]</span> You have a new Feedback from noisyboy:&lt;noisyboy@mail.com&gt;
From: infooveriq@gmail.com
To: admin@overiq.com
Date: Sun, <span class="m">17</span> Jun <span class="m">2018</span> <span class="m">06</span>:20:30 -0000
Message-ID: &lt;<span class="m">20180617062030</span>.13043.69352@pc&gt;

Purpose: Feedback

Date: <span class="m">2018</span>-06-17 <span class="m">06</span>:20:30.243083

Message:

Great tool!
-------------------------------------------------------------------------------
</pre></div>
</td></tr></tbody></table></div>


    



        <nav aria-label="pagination">
            <ul class="pager">
                
                    <li class="previous">
                        <a href="../user-registration-in-django/index.html" title="User Registration in Django">
                            <span class="fa fa-arrow-left" aria-hidden="true"></span>
                            User Registration in Django
                        </a>
                    </li>
                

                
                    <li class="next">
                        <a href="../searching-snippets/index.html" title="Searching Snippets">
                            Searching Snippets
                            <span class="fa fa-arrow-right" aria-hidden="true"></span>
                        </a>
                    </li>
                
            </ul>
        </nav>







    <hr/>
    <div id="disqus_thread">
    <p style="margin-bottom: 10px" class="text-center">
        <a href="#" class=" btn btn-primary comments-holder" onclick="loadDisqus();return false;">
            <i class="fa fa-comments" aria-hidden="true"></i> Load Comments
        </a>
    </p>
    </div>
    <hr/>
    <script>
        var is_disqus_loaded = false;
        function loadDisqus() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '../../../overiqcom.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        };
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>







            </div>
        </div>


        <div class="sidebar">
        
            <div class="col-lg-4 col-md-4 col-sm-12">
                

    
        
    <div class="well">
        <h4>Django 1.11 Tutorial</h4>
        <ul>
            
                <li><a href="../intro-to-django/index.html">Intro to Django</a></li>
            
                <li><a href="../installing-django/index.html">Installing Django</a></li>
            
                <li><a href="../creating-django-project/index.html">Creating Django Project</a></li>
            
                <li><a href="../mvc-pattern-and-django/index.html">MVC Pattern and Django</a></li>
            
                <li><a href="../views-and-urlconfs-in-django/index.html">Views and URLconfs in Django</a></li>
            
                <li><a href="../creating-urls-and-custom-response/index.html">Creating URLs and Custom Response</a></li>
            
                <li><a href="../basics-of-django-templates/index.html">Basics of Django Templates</a></li>
            
                <li><a href="../template-tags-in-django/index.html">Template tags in Django</a></li>
            
                <li><a href="../template-filters-in-django/index.html">Template filters in Django</a></li>
            
                <li><a href="../loading-templates-in-django/index.html">Loading Templates in Django</a></li>
            
                <li><a href="../template-inheritance-in-django/index.html">Template Inheritance in Django</a></li>
            
                <li><a href="../basics-of-models-in-django/index.html">Basics of Models in Django</a></li>
            
                <li><a href="../migrations-in-django/index.html">Migrations in Django</a></li>
            
                <li><a href="../django-orm-basics-part-1/index.html">Django ORM Basics Part 1</a></li>
            
                <li><a href="../django-orm-basics-part-2/index.html">Django ORM Basics Part 2</a></li>
            
                <li><a href="../django-admin-app/index.html">Django Admin App</a></li>
            
                <li><a href="../django-authentication-framework-basics/index.html">Django Authentication Framework Basics</a></li>
            
                <li><a href="../data-migrations-in-django/index.html">Data migrations in Django</a></li>
            
                <li><a href="../django-form-basics/index.html">Django Form Basics</a></li>
            
                <li><a href="../displaying-forms-in-django/index.html">Displaying Forms in Django</a></li>
            
                <li><a href="../django-rendering-form-fields-manually/index.html">Django Rendering Form Fields Manually</a></li>
            
                <li><a href="../handling-static-content-in-django/index.html">Handling Static Content in Django</a></li>
            
                <li><a href="../handling-media-files-in-django/index.html">Handling Media Files in Django</a></li>
            
                <li><a href="../building-djangobin-the-first-steps/index.html">Building Djangobin - The First Steps</a></li>
            
                <li><a href="../creating-trending-snippet-page/index.html">Creating Trending Snippet Page</a></li>
            
                <li><a href="../building-contact-us-form/index.html">Building Contact Us Form</a></li>
            
                <li><a href="../django-logging-users-in-and-out/index.html">Django Logging Users In and Out</a></li>
            
                <li><a href="../user-registration-in-django/index.html">User Registration in Django</a></li>
            
                <li><a href="index.html">Building profile pages for Djangobin</a></li>
            
                <li><a href="../searching-snippets/index.html">Searching Snippets</a></li>
            
                <li><a href="../asynchronous-tasks-with-celery/index.html">Asynchronous Tasks with Celery</a></li>
            
                <li><a href="../flatpages-in-django/index.html">Flatpages in Django</a></li>
            
                <li><a href="../creating-sitemaps-in-django/index.html">Creating Sitemaps in Django</a></li>
            
                <li><a href="../settings-for-multiple-environments-in-django/index.html">Settings for Multiple Environments in Django</a></li>
            
                <li><a href="../deploying-django-project-to-digitalocean/index.html">Deploying Django Project to DigitalOcean</a></li>
            
        </ul>
    </div>

    

    
        

<div class="well">
    <h4>Recent Posts</h4>
    <ul>
        
            <li><a href="../../machine-learning-experts-you-should-be-following-online/index.html">Machine Learning Experts You Should Be Following Online</a></li>
        
            <li><a href="../../4-ways-to-prepare-for-the-ap-computer-science-a-exam/index.html">4 Ways to Prepare for the AP Computer Science A Exam</a></li>
        
            <li><a href="../../finance-assignment-online-help-for-the-busy-and-tired-students-get-help-from-experts/index.html">Finance Assignment Online Help for the Busy and Tired Students: Get Help from Experts</a></li>
        
            <li><a href="../../top-9-machine-learning-algorithms-for-data-scientists/index.html">Top 9 Machine Learning Algorithms for Data Scientists</a></li>
        
            <li><a href="../../data-science-learning-path-or-steps-to-become-a-data-scientist-final/index.html">Data Science Learning Path or Steps to become a data scientist Final</a></li>
        
            <li><a href="../../enable-edit-button-in-shutter-in-linux-mint-19-and-ubuntu-18-04/index.html">Enable Edit Button in Shutter In Linux Mint 19 and Ubuntu 18.04</a></li>
        
            <li><a href="../../python-3-time-module/index.html">Python 3 time module</a></li>
        
            <li><a href="../../pygments-tutorial/index.html">Pygments Tutorial</a></li>
        
            <li><a href="../../how-to-use-virtualenv/index.html">How to use Virtualenv?</a></li>
        
            <li><a href="../../installing-mysql-windows-linux-and-mac/index.html">Installing MySQL (Windows, Linux and Mac)</a></li>
        
            <li><a href="../../what-is-if-__name__-__main__-in-python/index.html">What is if __name__ == &#39;__main__&#39;  in Python ?</a></li>
        
            <li><a href="../../installing-goaccess-a-real-time-web-log-analyzer/index.html">Installing GoAccess (A Real-time web log analyzer)</a></li>
        
            <li><a href="../../installing-isso/index.html">Installing Isso</a></li>
        
    </ul>
</div>

<!-- Blog Search Well -->





















    



            </div>
        </div>
    </div>



    

</div>

<!-- Footer -->
<footer class="overiq-footer">
    <div class="container">
        <div class="row">

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../terms-of-use/index.html">Terms</a></li>
                    <li><a href="../../privacy-policy/index.html">Privacy Policy</a></li>
                    <li><a href="../../sitemap.xml/index.html">Sitemap</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../contact/index.html">Contact</a></li>
                    <li><a href="../../blog/index.html">Blog</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="https://www.facebook.com/OverIQ/">Facebook</a></li>
                    <li><a href="https://twitter.com/infoOverIQ">Twitter</a></li>
                    <li><a href="https://github.com/overiq">Github</a></li>
                </ul>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../c-programming-101/index.html">C Tutorial</a></li>
                    <li><a href="../../python-101/index.html">Python Tutorial</a></li>
                    <li><a href="../index.html">Django Tutorial</a></li>
                    <li><a href="../../flask-101/index.html">Flask Tutorial</a></li>
                    <li><a href="../../mysql-connector-python-101/index.html">MySQL Connector/Python Tutorial</a></li>
                    <li><a href="../../sqlalchemy-101/index.html">SQLAlchemy Tutorial</a></li>
                    <li><a href="../../c-examples/index.html">C Programming Examples</a></li>
                </ul>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row text-center">
            <p>© 2025 OverIQ.com</p>
            <small><a href="#">Back to top</a></small>
        </div>

        <!-- /.row -->
    </div>
</footer>



<script type="text/javascript" src="../../static/CACHE/js/output.2e0ff002c1a4.js"></script>




<script async="" src="../../../cdn.jsdelivr.net/npm/cookieconsent%403/build/cookieconsent.min.js" data-cfasync="false"></script>

<script>

    
    window.addEventListener('load', function () {
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#5ca9e0",
                    "text": "#ffffff"
                },
                "button": {
                    "background": "#fff",
                    "text": "#237afc"
                }
            },
            "theme": "classic",
            "position": "top",
            "static": true,
            "content": {
                "href": "https://overiq.com/privacy-policy/"
            }
        });
    });


</script>

<script src="../../../polyfill.io/v3/polyfill.min1162.js?features=es6"></script>
<script id="MathJax-script" defer="" src="../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml.js"></script>

<script async="" type="text/javascript" src="../../../cdn.carbonads.com/carbonfbdb.js?serve=CE7DC53E&amp;placement=overiqcom" id="_carbonads_js"></script>





<script data-cfasync="false">function _emitEzConsentEvent(){var customEvent=new CustomEvent("ezConsentEvent",{detail:{ezTcfConsent:window.ezTcfConsent},bubbles:true,cancelable:true,});document.dispatchEvent(customEvent);}
(function(window,document){function _setAllEzConsentTrue(){window.ezTcfConsent.loaded=true;window.ezTcfConsent.store_info=true;window.ezTcfConsent.develop_and_improve_services=true;window.ezTcfConsent.measure_ad_performance=true;window.ezTcfConsent.measure_content_performance=true;window.ezTcfConsent.select_basic_ads=true;window.ezTcfConsent.create_ad_profile=true;window.ezTcfConsent.select_personalized_ads=true;window.ezTcfConsent.create_content_profile=true;window.ezTcfConsent.select_personalized_content=true;window.ezTcfConsent.understand_audiences=true;window.ezTcfConsent.use_limited_data_to_select_content=true;window.ezTcfConsent.select_personalized_content=true;}
function _clearEzConsentCookie(){document.cookie="ezCMPCookieConsent=tcf2;Domain=.overiq.com;Path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT";}
_clearEzConsentCookie();if(typeof window.__tcfapi!=="undefined"){window.ezgconsent=false;var amazonHasRun=false;function _ezAllowed(tcdata,purpose){return(tcdata.purpose.consents[purpose]||tcdata.purpose.legitimateInterests[purpose]);}
function _handleConsentDecision(tcdata){window.ezTcfConsent.loaded=true;if(!tcdata.vendor.consents["347"]&&!tcdata.vendor.legitimateInterests["347"]){window._emitEzConsentEvent();return;}
window.ezTcfConsent.store_info=_ezAllowed(tcdata,"1");window.ezTcfConsent.develop_and_improve_services=_ezAllowed(tcdata,"10");window.ezTcfConsent.measure_content_performance=_ezAllowed(tcdata,"8");window.ezTcfConsent.select_basic_ads=_ezAllowed(tcdata,"2");window.ezTcfConsent.create_ad_profile=_ezAllowed(tcdata,"3");window.ezTcfConsent.select_personalized_ads=_ezAllowed(tcdata,"4");window.ezTcfConsent.create_content_profile=_ezAllowed(tcdata,"5");window.ezTcfConsent.measure_ad_performance=_ezAllowed(tcdata,"7");window.ezTcfConsent.use_limited_data_to_select_content=_ezAllowed(tcdata,"11");window.ezTcfConsent.select_personalized_content=_ezAllowed(tcdata,"6");window.ezTcfConsent.understand_audiences=_ezAllowed(tcdata,"9");window._emitEzConsentEvent();}
function _handleGoogleConsentV2(tcdata){if(!tcdata||!tcdata.purpose||!tcdata.purpose.consents){return;}
var googConsentV2={};if(tcdata.purpose.consents[1]){googConsentV2.ad_storage='granted';googConsentV2.analytics_storage='granted';}
if(tcdata.purpose.consents[3]&&tcdata.purpose.consents[4]){googConsentV2.ad_personalization='granted';}
if(tcdata.purpose.consents[1]&&tcdata.purpose.consents[7]){googConsentV2.ad_user_data='granted';}
if(googConsentV2.analytics_storage=='denied'){gtag('set','url_passthrough',true);}
gtag('consent','update',googConsentV2);}
__tcfapi("addEventListener",2,function(tcdata,success){if(!success||!tcdata){window._emitEzConsentEvent();return;}
if(!tcdata.gdprApplies){_setAllEzConsentTrue();window._emitEzConsentEvent();return;}
if(tcdata.eventStatus==="useractioncomplete"||tcdata.eventStatus==="tcloaded"){if(typeof gtag!='undefined'){_handleGoogleConsentV2(tcdata);}
_handleConsentDecision(tcdata);if(tcdata.purpose.consents["1"]===true&&tcdata.vendor.consents["755"]!==false){window.ezgconsent=true;(adsbygoogle=window.adsbygoogle||[]).pauseAdRequests=0;}
if(window.__ezconsent){__ezconsent.setEzoicConsentSettings(ezConsentCategories);}
__tcfapi("removeEventListener",2,function(success){return null;},tcdata.listenerId);if(!(tcdata.purpose.consents["1"]===true&&_ezAllowed(tcdata,"2")&&_ezAllowed(tcdata,"3")&&_ezAllowed(tcdata,"4"))){if(typeof __ez=="object"&&typeof __ez.bit=="object"&&typeof window["_ezaq"]=="object"&&typeof window["_ezaq"]["page_view_id"]=="string"){__ez.bit.Add(window["_ezaq"]["page_view_id"],[new __ezDotData("non_personalized_ads",true),]);}}}});}else{_setAllEzConsentTrue();window._emitEzConsentEvent();}})(window,document);</script></body>
<!-- Mirrored from overiq.com/django-1-11/building-profile-pages-for-djangobin/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:15:07 GMT -->
</html>