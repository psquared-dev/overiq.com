<!DOCTYPE html><html lang="en">
<!-- Mirrored from overiq.com/django-1-11/asynchronous-tasks-with-celery/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:15:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"/>
<script>var __ezHttpConsent={setByCat:function(src,tagType,attributes,category,force){var setScript=function(){if(force||window.ezTcfConsent[category]){var scriptElement=document.createElement(tagType);scriptElement.src=src;attributes.forEach(function(attr){for(var key in attr){if(attr.hasOwnProperty(key)){scriptElement.setAttribute(key,attr[key]);}}});var firstScript=document.getElementsByTagName(tagType)[0];firstScript.parentNode.insertBefore(scriptElement,firstScript);}};if(force||(window.ezTcfConsent&&window.ezTcfConsent.loaded)){setScript();}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){setScript();}else{console.error("cannot get ez consent data");force=true;setScript();}});}else{force=true;setScript();console.error("getEzConsentData is not a function");}},};</script>
<script>var ezTcfConsent=window.ezTcfConsent?window.ezTcfConsent:{loaded:false,store_info:false,develop_and_improve_services:false,measure_ad_performance:false,measure_content_performance:false,select_basic_ads:false,create_ad_profile:false,select_personalized_ads:false,create_content_profile:false,select_personalized_content:false,understand_audiences:false,use_limited_data_to_select_content:false,};function getEzConsentData(){return new Promise(function(resolve){document.addEventListener("ezConsentEvent",function(event){var ezTcfConsent=event.detail.ezTcfConsent;resolve(ezTcfConsent);});});}</script>
<script>if(typeof _setEzCookies!=='function'){function _setEzCookies(ezConsentData){var cookies=window.ezCookieQueue;for(var i=0;i<cookies.length;i++){var cookie=cookies[i];if(ezConsentData&&ezConsentData.loaded&&ezConsentData[cookie.tcfCategory]){document.cookie=cookie.name+"="+cookie.value;}}}}
window.ezCookieQueue=window.ezCookieQueue||[];if(typeof addEzCookies!=='function'){function addEzCookies(arr){window.ezCookieQueue=[...window.ezCookieQueue,...arr];}}
addEzCookies([]);if(window.ezTcfConsent&&window.ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else{console.error("cannot get ez consent data");_setEzCookies(window.ezTcfConsent);}});}else{console.error("getEzConsentData is not a function");_setEzCookies(window.ezTcfConsent);}</script>
<script data-ezscrex='false' data-cfasync='false' data-pagespeed-no-defer>var __ez=__ez||{};__ez.stms=Date.now();__ez.evt={};__ez.script={};__ez.ck=__ez.ck||{};__ez.template={};__ez.template.isOrig=true;window.__ezScriptHost="//www.ezojs.com";__ez.queue=__ez.queue||function(){var e=0,i=0,t=[],n=!1,o=[],r=[],s=!0,a=function(e,i,n,o,r,s,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,d=this;this.name=e,this.funcName=i,this.parameters=null===n?null:w(n)?n:[n],this.isBlock=o,this.blockedBy=r,this.deleteWhenComplete=s,this.isError=!1,this.isComplete=!1,this.isInitialized=!1,this.proceedIfError=a,this.fWindow=l,this.isTimeDelay=!1,this.process=function(){f("... func = "+e),d.isInitialized=!0,d.isComplete=!0,f("... func.apply: "+e);var i=d.funcName.split("."),n=null,o=this.fWindow||window;i.length>3||(n=3===i.length?o[i[0]][i[1]][i[2]]:2===i.length?o[i[0]][i[1]]:o[d.funcName]),null!=n&&n.apply(null,this.parameters),!0===d.deleteWhenComplete&&delete t[e],!0===d.isBlock&&(f("----- F'D: "+d.name),m())}},l=function(e,i,t,n,o,r,s){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,l=this;this.name=e,this.path=i,this.async=o,this.defer=r,this.isBlock=t,this.blockedBy=n,this.isInitialized=!1,this.isError=!1,this.isComplete=!1,this.proceedIfError=s,this.fWindow=a,this.isTimeDelay=!1,this.isPath=function(e){return"/"===e[0]&&"/"!==e[1]},this.getSrc=function(e){return void 0!==window.__ezScriptHost&&this.isPath(e)&&"banger.js"!==this.name?window.__ezScriptHost+e:e},this.process=function(){l.isInitialized=!0,f("... file = "+e);var i=this.fWindow?this.fWindow.document:document,t=i.createElement("script");t.src=this.getSrc(this.path),!0===o?t.async=!0:!0===r&&(t.defer=!0),t.onerror=function(){var e={url:window.location.href,name:l.name,path:l.path,user_agent:window.navigator.userAgent};"undefined"!=typeof _ezaq&&(e.pageview_id=_ezaq.page_view_id);var i=encodeURIComponent(JSON.stringify(e)),t=new XMLHttpRequest;t.open("GET/index.html","//g.ezoic.net/ezqlog?d="+i,!0),t.send(),f("----- ERR'D: "+l.name),l.isError=!0,!0===l.isBlock&&m()},t.onreadystatechange=t.onload=function(){var e=t.readyState;f("----- F'D: "+l.name),e&&!/loaded|complete/.test(e)||(l.isComplete=!0,!0===l.isBlock&&m())},i.getElementsByTagName("head")[0].appendChild(t)}},d=function(e,i){this.name=e,this.path="",this.async=!1,this.defer=!1,this.isBlock=!1,this.blockedBy=[],this.isInitialized=!0,this.isError=!1,this.isComplete=i,this.proceedIfError=!1,this.isTimeDelay=!1,this.process=function(){}};function c(e,i,n,s,a,d,c,u,f){var m=new l(e,i,n,s,a,d,c,f);!0===u?o[e]=m:r[e]=m,t[e]=m,h(m)}function h(e){!0!==u(e)&&0!=s&&e.process()}function u(e){if(!0===e.isTimeDelay&&!1===n)return f(e.name+" blocked = TIME DELAY!"),!0;if(w(e.blockedBy))for(var i=0;i<e.blockedBy.length;i++){var o=e.blockedBy[i];if(!1===t.hasOwnProperty(o))return f(e.name+" blocked = "+o),!0;if(!0===e.proceedIfError&&!0===t[o].isError)return!1;if(!1===t[o].isComplete)return f(e.name+" blocked = "+o),!0}return!1}function f(e){var i=window.location.href,t=new RegExp("[?&]ezq=([^&#]*)","i").exec(i);"1"===(t?t[1]:null)&&console.debug(e)}function m(){++e>200||(f("let's go"),p(o),p(r))}function p(e){for(var i in e)if(!1!==e.hasOwnProperty(i)){var t=e[i];!0===t.isComplete||u(t)||!0===t.isInitialized||!0===t.isError?!0===t.isError?f(t.name+": error"):!0===t.isComplete?f(t.name+": complete already"):!0===t.isInitialized&&f(t.name+": initialized already"):t.process()}}function w(e){return"[object Array]"==Object.prototype.toString.call(e)}return window.addEventListener("load",(function(){setTimeout((function(){n=!0,f("TDELAY -----"),m()}),5e3)}),!1),{addFile:c,addFileOnce:function(e,i,n,o,r,s,a,l,d){t[e]||c(e,i,n,o,r,s,a,l,d)},addDelayFile:function(e,i){var n=new l(e,i,!1,[],!1,!1,!0);n.isTimeDelay=!0,f(e+" ...  FILE! TDELAY"),r[e]=n,t[e]=n,h(n)},addFunc:function(e,n,s,l,d,c,u,f,m,p){!0===c&&(e=e+"_"+i++);var w=new a(e,n,s,l,d,u,f,p);!0===m?o[e]=w:r[e]=w,t[e]=w,h(w)},addDelayFunc:function(e,i,n){var o=new a(e,i,n,!1,[],!0,!0);o.isTimeDelay=!0,f(e+" ...  FUNCTION! TDELAY"),r[e]=o,t[e]=o,h(o)},items:t,processAll:m,setallowLoad:function(e){s=e},markLoaded:function(e){if(e&&0!==e.length){if(e in t){var i=t[e];!0===i.isComplete?f(i.name+" "+e+": error loaded duplicate"):(i.isComplete=!0,i.isInitialized=!0)}else t[e]=new d(e,!0);f("markLoaded dummyfile: "+t[e].name)}},logWhatsBlocked:function(){for(var e in t)!1!==t.hasOwnProperty(e)&&u(t[e])}}}();__ez.evt.add=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n()},__ez.evt.remove=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):delete e["on"+t]};__ez.script.add=function(e){var t=document.createElement("script");t.src=e,t.async=!0,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t)};__ez.dot={};__ez.queue.addFile('../../detroitchicago/boise.js', '../../detroitchicago/boisebb26.js?gcb=195-3&amp;cb=5', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/abilene.js', '../../parsonsmaize/abilenec0f9.js?gcb=195-3&amp;cb=7f81d60744', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/mulvane.js', '../../parsonsmaize/mulvane2d63.js?gcb=195-3&amp;cb=e75e48eec0', true, ['/parsonsmaize/abilene.js'], true, false, true, false);__ez.queue.addFile('../../detroitchicago/birmingham.js', '../../detroitchicago/birminghame7ec.js?gcb=195-3&amp;cb=539c47377c', true, ['/parsonsmaize/abilene.js'], true, false, true, false);</script>
<script data-ezscrex="false" type="text/javascript" data-cfasync="false">window._ezaq = Object.assign({"ad_cache_level":1,"adpicker_placement_cnt":0,"ai_placeholder_cache_level":1,"ai_placeholder_placement_cnt":-1,"domain_id":92771,"ezcache_level":1,"ezcache_skip_code":0,"has_bad_image":0,"has_bad_words":0,"is_sitespeed":0,"lt_cache_level":0,"response_size":65090,"response_size_orig":59322,"response_time_orig":607,"template_id":5,"url":"https://overiq.com/django-1-11/asynchronous-tasks-with-celery/","word_count":0,"worst_bad_word_level":0}, typeof window._ezaq !== "undefined" ? window._ezaq : {});__ez.queue.markLoaded('ezaqBaseReady');</script>
<script type='text/javascript' data-ezscrex='false' data-cfasync='false'>
window.ezAnalyticsStatic = true;

function analyticsAddScript(script) {
	var ezDynamic = document.createElement('script');
	ezDynamic.type = 'text/javascript';
	ezDynamic.innerHTML = script;
	document.head.appendChild(ezDynamic);
}
function getCookiesWithPrefix() {
    var allCookies = document.cookie.split(';');
    var cookiesWithPrefix = {};

    for (var i = 0; i < allCookies.length; i++) {
        var cookie = allCookies[i].trim();

        for (var j = 0; j < arguments.length; j++) {
            var prefix = arguments[j];
            if (cookie.indexOf(prefix) === 0) {
                var cookieParts = cookie.split('=');
                var cookieName = cookieParts[0];
                var cookieValue = cookieParts.slice(1).join('=');
                cookiesWithPrefix[cookieName] = decodeURIComponent(cookieValue);
                break; // Once matched, no need to check other prefixes
            }
        }
    }

    return cookiesWithPrefix;
}
function productAnalytics() {
	var d = {"pr":[6],"omd5":"fb886336711f2ba1e61b269c6678d0eb"};
	d.u = _ezaq.url;
	d.p = _ezaq.page_view_id;
	d.v = _ezaq.visit_uuid;
	d.ab = _ezaq.ab_test_id;
	d.e = JSON.stringify(_ezaq);
	d.ref = document.referrer;
	d.c = getCookiesWithPrefix('active_template', 'ez', 'lp_');
	if(typeof ez_utmParams !== 'undefined') {
		d.utm = ez_utmParams;
	}

	var dataText = JSON.stringify(d);
	var xhr = new XMLHttpRequest();
	xhr.open('POST/index.html','/ezais/analytics?cb=1', true);
	xhr.onload = function () {
		if (xhr.status!=200) {
            return;
		}

        if(document.readyState !== 'loading') {
            analyticsAddScript(xhr.response);
            return;
        }

        var eventFunc = function() {
            if(document.readyState === 'loading') {
                return;
            }
            document.removeEventListener('readystatechange', eventFunc, false);
            analyticsAddScript(xhr.response);
        };

        document.addEventListener('readystatechange', eventFunc, false);
	};
	xhr.setRequestHeader('Content-Type','text/plain');
	xhr.send(dataText);
}
__ez.queue.addFunc("productAnalytics", "productAnalytics", null, true, ['ezaqBaseReady'], false, false, false, true);
</script><base />
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Asynchronous Tasks with Celery - Django 1.11 Tutorial - OverIQ.com</title>

    
    



    <meta name="description" content="What is Celery #

Django is designed for short-lived requests. Consequently, if you ever need to perform a long-running operation, you should always …"/>



    <link rel="canonical" href="index.html"/>


<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Asynchronous Tasks with Celery"/>

    <meta property="og:description" content="What is Celery #

Django is designed for short-lived requests. Consequently, if you ever need to perform a long-running operation, you should always …"/>


<meta property="og:url" content="https://overiq.com/django-1-11/asynchronous-tasks-with-celery/"/>
<meta property="og:site_name" content="OverIQ.com"/>


<meta property="article:publisher" content="https://www.facebook.com/OverIQ/"/>



<meta name="twitter:card" content="summary_large_image"/>

    <meta name="twitter:description" content="What is Celery #

Django is designed for short-lived requests. Consequently, if you ever need to perform a long-running operation, you should always …"/>


<meta name="twitter:title" content="Asynchronous Tasks with Celery"/>
<meta name="twitter:site" content="@infoOverIQ"/>

<meta name="twitter:creator" content="@infoOverIQ"/>




    
    
    


    
    
    


    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../feed.xml/index.html"/>
    
    
    <link href="../../../fonts.googleapis.com/cssd2d5.css?family=Open+Sans" rel="stylesheet"/>
    <link rel="stylesheet" href="../../../maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="icon" href="../../static/wiki/favicon.png" sizes="32x32"/>

    <link rel="stylesheet" href="../../static/CACHE/css/output.db46da465a8b.css" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-125424793-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125424793-1');
    </script>


<script type='text/javascript'>
var ezoTemplate = 'orig_site';
var ezouid = '1';
var ezoFormfactor = '1';
</script><script data-ezscrex="false" type='text/javascript'>
var soc_app_id = '0';
var did = 92771;
var ezdomain = 'overiq.com';
var ezoicSearchable = 1;
</script></head>
<body>

<div class="overiq-header text-center">
    <div class="site-branding">
        <p class="main-title">
            <a href="../../index.html" rel="home">
                OverIQ.com
            </a>
        </p>
    </div>
</div>

<!-- Navigation -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html">Home</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                

                <li>
                    <a href="../../blog/index.html">Blog</a>
                </li>
                <li>
                    <a href="../../contact/index.html">Contact</a>
                </li>
                <li>
                    <a href="../../about/index.html">About</a>
                </li>
            </ul>

            <ul class="nav navbar-nav navbar-right visible-lg visible-md">
                <li>
                    <a href="../../feed.xml/index.html" title="RSS" target="_blank">
                        <i class="fa fa-rss fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/overiq/" target="_blank" title="Github">
                        <i class="fa fa-github fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://www.facebook.com/OverIQ/" target="_blank" title="Facebook">
                        <i class="fa fa-facebook fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://twitter.com/infoOverIQ" target="_blank" title="Twitter">
                        <i class="fa fa-twitter fa-lg" aria-hidden="true"></i>
                    </a>
                </li>

                

            </ul>

            <form action="https://overiq.com/search/" class="navbar-form navbar-left" role="search">

                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search" name="query" value=""/>
                </div>

                <button type="submit" class="btn btn-default">Submit</button>
            </form>

        </div>



        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<div class="container">

    


    <div class="se-pre-con"></div>

    

    <div class="row">

        
        <div class="main">
            <div class="col-lg-8 col-md-8 col-sm-12">
                

    


    
        <ol class="breadcrumb">

    <li><a href="../../index.html">Home</a></li>

    
        
        <li><a href="../index.html">Django 1.11 Tutorial</a></li>
        

        

        
    
        

        

        
            <li class="active">Asynchronous Tasks with Celery</li>
        
    

</ol>
    


<h1>Asynchronous Tasks with Celery</h1>




    <p><i class="fa fa-calendar" aria-hidden="true"></i>
        Last updated on July 27, 2020
    </p>


<hr/>



<span id="what-is-celery" class="anchor-target"></span><h2 class="heading">What is Celery <a class="header-link" href="#what-is-celery">#</a></h2>

<p>Django is designed for short-lived requests. Consequently, if you ever need to perform a long-running operation, you should always perform it outside of the request-response cycle.</p>

<p>The following are some examples of long-running operations:</p>

<ul>
<li>sending emails or mass email</li>
<li>transcoding media files</li>
<li>image processing</li>
<li>generating reports</li>
</ul>

<p>and so on.</p>

<p>Trying to perform these operations within the request-response cycle will significantly increase the waiting time and size of HTTP response. This could eventually, drive the users away from the site. Furthermore, these operations are also subject to failures. For this reason, we might want to have a retry policy.</p>

<p>The solution is to maintain a queue of long-running operations and launch them asynchronously.</p>

<p>Fortunately, we have a great package called Celery which does all the heavy-lighting for us.</p>

<p>Quoting from the Celery documentation:</p>

<blockquote>
<p>Celery is an asynchronous task queue based on distributed message passing. It is focused on real-time operation but supports scheduling as well.</p>
</blockquote>

<p>In addition to running asynchronous tasks, Celery also gives you option to execute task periodically.</p>

<p>To install Celery execute the following command:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ pip install celery
</pre></div>
</div>
<p>Next, you need a message broker. A broker is where your tasks get stored as a queue. The broker sends these messages to Celery workers, which then executes the task and provides a response. By default, Celery uses RabbitMQ as a message broker. To install RabbitMQ execute the following command:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ sudo apt-get install rabbitmq-server
</pre></div>
</div>
<p>After the installation rabbitmq-server will start automatically. You can check the status of the rabbitmq-server using the following command:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ sudo service rabbitmq-server status
</pre></div>
</div>
<p>If for some reason rabbitmq-server doesn&#39;t start automatically, type the following command in the shell:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ sudo service rabbitmq-server start
</pre></div>
</div>
<p>To stop the rabbitmq-server use the following command:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ sudo service rabbitmq-server stop
</pre></div>
</div><span id="integrating-celery-with-django" class="anchor-target"></span><h2 class="heading">Integrating Celery with Django <a class="header-link" href="#integrating-celery-with-django">#</a></h2>

<p>To add Celery to the Django project, we have to first create an instance of <code>Celery</code> app along with some configurations. </p>

<p>Create a new file named <code>celery.py</code> next to <code>settings.py</code> in the Django configuration directory and add the following code to it:</p>

<p><strong>djangobin/django_project/django_project/celery.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>

<span class="c1"># set the default Django settings module for the &#39;celery&#39; program.</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;django_project.settings&#39;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s1">&#39;djangobin&#39;</span><span class="p">)</span>

<span class="c1"># Using a string here means the worker doesn&#39;t have to serialize</span>
<span class="c1"># the configuration object to child processes.</span>
<span class="c1"># - namespace=&#39;CELERY&#39; means all celery-related configuration keys</span>
<span class="c1">#   should have a `CELERY_` prefix.</span>
<span class="n">app</span><span class="o">.</span><span class="n">config_from_object</span><span class="p">(</span><span class="s1">&#39;django.conf:settings&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;CELERY&#39;</span><span class="p">)</span>

<span class="c1"># Load task modules from all registered Django app configs.</span>
<span class="n">app</span><span class="o">.</span><span class="n">autodiscover_tasks</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>In line 1-3, we are importing necessary functions and modules.</p>

<p>In line 6, we set <code>DJANGO_SETTINGS_MODULE</code> environment variable for the <code>celery</code> command line application.</p>

<p>In line 8, we create an instance of <code>Celery</code> by passing it the name of the Django application.</p>

<p>In line 14, we load any custom configurations from project&#39;s <code>settings.py</code> file.</p>

<p>Finally, in line 17, we tell Celery to auto discover tasks form the applications listed in <code>INSTALLED_APPS</code> setting. With this line in place, Celery will look for a module named <code>tasks.py</code> in every installed app to load tasks in it.</p>

<p>Next, we have to load the <code>Celery</code> instance every time the Django starts. To do so, add the following lines in <code>__init__.py</code> file in Django configuration directory.</p>

<p><strong>djangobin/django_project/django_project/__init__.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="c1"># This will make sure the app is always imported when</span>
<span class="c1"># Django starts so that shared_task will use this app.</span>
<span class="kn">from</span> <span class="nn">.celery</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">celery_app</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;celery_app&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Now, we are ready to define some tasks.</p>
<span id="creating-asynchronous-tasks" class="anchor-target"></span><h2 class="heading">Creating Asynchronous Tasks <a class="header-link" href="#creating-asynchronous-tasks">#</a></h2>

<p>In this section, we are going to create asynchronous tasks to send emails.</p>

<p>As things stand, there are three points in our application where we are sending emails.</p>

<ul>
<li>Contact Form</li>
<li>Password Reset</li>
<li>Account Activation </li>
</ul>

<p>The Contact form and Account Activation uses <code>mail_admins()</code> and <code>send_mail()</code> functions to send mail. Both of them are synchronous functions which means they will block the execution of the program until they are done working. </p>

<p>However, if you have used the application thoroughly, you will find that we are not experiencing any delay at all. This is because we are currently using the console backend, if we switch to SMTP backend the delay will be significant.</p>

<p>The Password Reset mechanism also uses <code>send_mail()</code> function to send the reset password link but to keep things simple and easy to follow we will not going change it.</p>

<p>Let&#39;s define some tasks now.</p>

<p>Create a new file named <code>tasks.py</code> in the <code>djangobin</code> app directory and add the following code to it:</p>

<p><strong>djangobin/django_project/djangobin/tasks.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.core.mail</span> <span class="kn">import</span> <span class="n">BadHeaderError</span><span class="p">,</span> <span class="n">send_mail</span><span class="p">,</span> <span class="n">mail_admins</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.tokens</span> <span class="kn">import</span> <span class="n">default_token_generator</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_bytes</span>
<span class="kn">from</span> <span class="nn">django.utils.http</span> <span class="kn">import</span> <span class="n">urlsafe_base64_encode</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">send_activation_mail</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>

    <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="n">urlsafe_base64_encode</span><span class="p">(</span><span class="n">force_bytes</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)),</span>
        <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">default_token_generator</span><span class="o">.</span><span class="n">make_token</span><span class="p">(</span><span class="n">user</span><span class="p">),</span>
    <span class="p">})</span>

    <span class="n">subject</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s1">&#39;djangobin/email/activation_subject.txt&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s1">&#39;djangobin/email/activation_email.txt&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="n">send_mail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_FROM_EMAIL</span><span class="p">,</span> <span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">])</span>
</pre></div>
</td></tr></tbody></table></div>
<p>A task is just an ordinary function defined using <code>@task</code> decorator. The <code>send_activation_mail()</code> function accepts <code>user_id</code> and <code>context</code> arguments and sends an email using the <code>send_mail()</code> function.</p>

<p>The arguments you pass to the task functions are serialized and stored in the broker. The newer versions (since 4.0) of Celery uses JSON as default serialization method. The JSON serializer can only serialize simple objects like int, string, list etc. It can&#39;t serialize complex objects like Model instances, <code>HttpRequest</code> instance, bytestring and so on.</p>

<p>This is the reason why we are sending <code>user_id</code> to the <code>send_activation_mail()</code> function instead of the <code>User</code> instance. For the same reason, we are creation half of the context data in the <code>send_activation_mail()</code> instead of passing it directly from <code>save()</code> method of <code>CreateUserForm</code> form.</p>

<p><strong>Note:</strong> We can pass a complex object to the task function by changing the default serializer to pickle. In fact, in an older version of Celery (before 4.0), pickle was the default serializer. However, because of some <a href="https://blog.nelhage.com/2011/03/exploiting-pickle/" rel="nofollow">security vulnerabilities</a>, pickle is not the recommended way to do things.</p>

<p>The next step is to call this task, which we do using the <code>delay()</code> method. Here is the updated version of the <code>save()</code> method.</p>

<p><strong>djangobin/django_project/djangobin/forms.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.tasks</span> <span class="kn">import</span> <span class="n">send_activation_mail</span>
</span><span class="c1">#...</span>


<span class="k">class</span> <span class="nc">CreateUserForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
    <span class="c1">#...</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

        <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CreateUserForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>       

<span class="hll">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>            
</span><span class="hll">            <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>            
</span><span class="hll">            <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">],</span>            
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">send_activation_mail</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="c1">## calling the task</span>
</span>
        <span class="k">return</span> <span class="n">user</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The <code>delay()</code> method only puts the task in the queue. It is the job of celery worker to execute it as soon as possible.</p>

<p>Everything is in place now, all we need is to start the Celery worker. </p>

<p>In the terminal, make sure your current working directory is set to project root directory, and then start the Celery worker by typing:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">celery</span> <span class="o">-</span><span class="n">A</span> <span class="n">django_project</span> <span class="n">worker</span> <span class="o">-</span><span class="n">l</span> <span class="n">info</span>
</pre></div>
</div>
<p>The output will be something like this:</p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ celery -A django_project worker -l info 
 -------------- celery@pc v4.1.0 (latentcall)
---- **** ----- 
--- * ***  * -- Linux-4.10.0-38-generic-x86_64-with-LinuxMint-18.3-sylvia 2018-04-24 07:05:26
-- * - **** --- 
- ** ---------- [config]
- ** ---------- .&gt; app:         djangobin:0x7f39e8f00860
- ** ---------- .&gt; transport:   amqp://guest:**@localhost:5672//
- ** ---------- .&gt; results:     disabled://
- *** --- * --- .&gt; concurrency: 4 (prefork)
-- ******* ---- .&gt; task events: OFF (enable -E to monitor tasks in this worker)
--- ***** ----- 
 -------------- [queues]
                .&gt; celery           exchange=celery(direct) key=celery
                

[tasks]
  . djangobin.tasks.send_activation_mail

[2018-04-24 07:05:27,010: INFO/MainProcess] Connected to amqp://guest:**@127.0.0.1:5672//
[2018-04-24 07:05:27,020: INFO/MainProcess] mingle: searching for neighbors
[2018-04-24 07:05:28,066: INFO/MainProcess] mingle: all alone
[2018-04-24 07:05:28,087: WARNING/MainProcess] /home/pp/djangobin/env/lib/python3.5/site-packages/celery/fixups/django.py:202: UserWarning: Using settings.DEBUG leads to a memory leak, never use this setting in production environments!
  warnings.warn(&#39;Using settings.DEBUG leads to a memory leak, never &#39;
[2018-04-24 07:05:28,088: INFO/MainProcess] celery@pc ready.
</pre></div>
</td></tr></tbody></table></div>
<p>Celery worker is now up and running. Start the Django development server if not already running and create a new user by visiting <code>http://localhost:8000/signup/</code>.</p>

<p><img src="../../media/uploads/2018/5/28/Selection_224-7004ea7d-35a1-4c8d-b30d-c0f11827a40c.png" loading="lazy" alt=""/></p>

<p>Enter data in all the fields and hit submit. In the shell, running the Celery worker you will get output like this:</p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[2018-05-12 04:21:11,012: INFO/MainProcess] Received task: djangobin.tasks.send_activation_mail[79849f4e-2a9b-44b1-bcb3-242ef180e2ef]  
[2018-05-12 04:21:11,096: WARNING/ForkPoolWorker-2] Content-Type: text/plain; charset=&#34;utf-8&#34;
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Subject: Action Required to Complete the Account Creation - djangobin
From: infooveriq@gmail.com
To: pypi@example.com
Date: Sat, 12 May 2018 04:21:11 -0000
Message-ID: &lt;20180512042111.9675.41529@pc&gt;

Hello pypi!

To confirm your registration, visit the following link:

http://localhost:8000/activate/MTU/4w4-8eac5c27a7e29b8190c9/

Welcome to Djanagobin!
[2018-05-12 04:21:11,097: WARNING/ForkPoolWorker-2] ---------------------------------------------------------
</pre></div>
</td></tr></tbody></table></div>
<p>Our asynchronous task has been executed. To activate the user copy and paste the URL into the browser address bar.</p>

<p>Let&#39;s create another task to send feedback email to the site admins. Open <code>tasks.py</code> and add <code>send_feedback_mail()</code> task just below the <code>send_activation_mail()</code> task as follows:</p>

<p><strong>djangobin/django_project/djangobin/tasks.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">send_feedback_mail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">mail_admins</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Next, modify <code>contact()</code> view to use <code>send_feedback_mail()</code> function as follows:</p>

<p><strong>djangobin/django_project/djangobin/views.py</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.tasks</span> <span class="kn">import</span> <span class="n">send_feedback_mail</span>
</span><span class="c1">#...</span>


<span class="k">def</span> <span class="nf">contact</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="s2">&#34;You have a new Feedback from {}:&lt;{}&gt;&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>

            <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;Purpose: {}</span><span class="se">\n\n</span><span class="s2">Date: {}</span><span class="se">\n\n</span><span class="s2">Message:</span><span class="se">\n\n</span><span class="s2"> {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">purpose_choices</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]),</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
            <span class="p">)</span>

<span class="hll">            <span class="n">send_feedback_mail</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;Thanks for submitting your feedback.&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;djangobin:contact&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangobin/contact.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Restart the Celery worker for the changes to take effect and visit <code>http://localhost:8000/contact/</code>.</p>

<p><img src="../../media/uploads/2018/5/28/Selection_225-5638312a-b783-4b52-b9be-c99c3af51ab9.png" loading="lazy" alt=""/></p>

<p>Fill the form and hit submit. This time, in the shell, running the Celery worker you will get an output like this:</p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[2018-05-12 04:30:26,682: WARNING/ForkPoolWorker-2] send_feedback_mail
[2018-05-12 04:30:26,691: WARNING/ForkPoolWorker-2] Content-Type: text/plain; charset=&#34;utf-8&#34;
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Subject: [Django] You have a new Feedback from spike:&lt;spike@example.com&gt;
From: infooveriq@gmail.com
To: admin@overiq.com
Date: Sat, 12 May 2018 04:30:26 -0000
Message-ID: &lt;20180512043026.10707.30774@pc&gt;

Purpose: Feedback

Date: 2018-05-12 04:30:26.644238

Message:

Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut eius ex fuga laborum magni minima nulla quidem suscipit? Atque corporis esse explicabo facilis maxime odit quidem sit tempora velit vitae?
[2018-05-12 04:30:26,692: WARNING/ForkPoolWorker-2] 
-----------------------------------------------------------------------------------------
</pre></div>
</td></tr></tbody></table></div><span id="removing-snippets-via-periodic-tasks" class="anchor-target"></span><h2 class="heading">Removing Snippets via Periodic Tasks <a class="header-link" href="#removing-snippets-via-periodic-tasks">#</a></h2>

<p>In this section, we will add a periodic task to delete the expired snippets from the database.</p>

<p>Open <code>tasks.py</code> and add <code>remove_snippets()</code> function towards the end of the file as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#...</span>
<span class="kn">from</span> <span class="nn">django.utils.http</span> <span class="kn">import</span> <span class="n">urlsafe_base64_encode</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="hll"><span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">pytz</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Snippet</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">Preference</span> <span class="k">as</span> <span class="n">Pref</span>
</span><span class="c1">#...</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">remove_snippets</span><span class="p">():</span>

    <span class="c1"># loop through all the snippets whose expiration is other than never.</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">expiration</span><span class="o">=</span><span class="s1">&#39;never&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">):</span>

        <span class="c1"># get the creation time</span>
        <span class="n">creation_time</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">created_on</span>

        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">expiration</span> <span class="o">==</span> <span class="n">Pref</span><span class="o">.</span><span class="n">SNIPPET_EXPIRE_1WEEK</span><span class="p">:</span>
            <span class="n">tmdelta</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">expiration</span> <span class="o">==</span> <span class="n">Pref</span><span class="o">.</span><span class="n">SNIPPET_EXPIRE_1MONTH</span><span class="p">:</span>
            <span class="n">tmdelta</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">expiration</span> <span class="o">==</span> <span class="n">Pref</span><span class="o">.</span><span class="n">SNIPPET_EXPIRE_6MONTH</span><span class="p">:</span>
            <span class="n">tmdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">expiration</span> <span class="o">==</span> <span class="n">Pref</span><span class="o">.</span><span class="n">SNIPPET_EXPIRE_1YEAR</span><span class="p">:</span>
            <span class="n">tmdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># deletion_time is datetime.datetime    </span>
        <span class="n">deletion_time</span> <span class="o">=</span> <span class="n">creation_time</span> <span class="o">+</span> <span class="n">tmdelta</span>

        <span class="c1"># now is datetime.datetime    </span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="c1"># diff is datetime.timedelta</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">deletion_time</span> <span class="o">-</span> <span class="n">now</span>

        <span class="k">if</span> <span class="n">diff</span><span class="o">.</span><span class="n">days</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">diff</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># it&#39;s time to delete the snippet</span>
            <span class="n">s</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<ol>
<li><p>The function starts with a for loop which iterates over snippets whose <code>expiration</code> attribute contains a value other than <code>never</code>.</p></li>
<li><p>In lines 19-26, we use <code>if-elif</code> statement to create a <code>datetime.timedelta</code> object. The <code>datetime.timedelta</code> object is used to perform basic arithmetic on <code>datetime.datetime</code> and <code>datetime.date</code> objects. If we add a <code>datetime.timedelta</code> object to a <code>datetime.datetime</code> object, the result will be a new <code>datetime.datetime</code> object. On the other hand, if we subtract two <code>datetime.datetime</code> objects, the result will be a <code>datetime.timedelta</code>.</p></li>
<li><p>In line 29, we calculate snippet expiration time by adding snippet creation time and timedelta.</p></li>
<li><p>In line 32, we use <code>now()</code> method of <code>datetime.datetime</code> class to get the current date and time. </p></li>
<li><p>In line 35, we calculate the difference between <code>deletion_time</code> and <code>now</code>. The difference yields a new <code>datetime.timedelta</code> object. If the <code>days</code> attribute of the <code>datetime.timedelta</code> is <code>0</code> or negative then it&#39;s time to delete the snippet, this exactly what we are doing in the if statement in line 37.</p></li>
</ol>

<p>We have defined a periodic task. To execute it we use something called Celery beat. The Celery beat is a scheduler which kicks off at regular intervals to execute tasks.</p>

<p>Celery beat reads periodic tasks from <code>beat_schedule</code> setting. Open <code>celery.py</code> and define <code>beat_schedule</code> setting as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>
<span class="hll"><span class="kn">from</span> <span class="nn">celery.schedules</span> <span class="kn">import</span> <span class="n">crontab</span>
</span>
<span class="c1">#...</span>

<span class="c1"># Load task modules from all registered Django app configs.</span>
<span class="n">app</span><span class="o">.</span><span class="n">autodiscover_tasks</span><span class="p">()</span>

<span class="hll"><span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">beat_schedule</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">    <span class="s1">&#39;remove-snippets-daily-at-midnight&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;djangobin.tasks.remove_snippets&#39;</span><span class="p">,</span>        
</span><span class="hll">        <span class="s1">&#39;schedule&#39;</span><span class="p">:</span> <span class="n">crontab</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span><span class="hll">    <span class="p">},</span>
</span><span class="hll"><span class="p">}</span>
</span></pre></div>
</td></tr></tbody></table></div>
<p>The <code>task</code> field refers to the name of the task to execute and the <code>schedule</code> field refers to the frequency of execution. The <code>crontab(minute=0, hour=0)</code> indicates that the <br/>
<code>remove_snippets</code> task will be run daily at midnight. We can pass many other arguments to <code>crontab</code> instance, <a href="http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html#crontab-schedules" rel="nofollow">this</a> page shows some examples.</p>

<p>To start the celery beat scheduler type the following command:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ celery -A django_project beat -l info
</pre></div>
</div>
<p>The output will be something like this:</p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>celery beat v4.1.0 (latentcall) is starting.
__    -    ... __   -        _
LocalTime -&gt; 2018-04-24 12:01:51
Configuration -&gt;
    . broker -&gt; amqp://guest:**@localhost:5672//
    . loader -&gt; celery.loaders.app.AppLoader
    . scheduler -&gt; celery.beat.PersistentScheduler
    . db -&gt; celerybeat-schedule
    . logfile -&gt; [stderr]@%INFO
    . maxinterval -&gt; 5.00 minutes (300s)
[2018-04-24 12:01:51,184: INFO/MainProcess] beat: Starting...
</pre></div>
</td></tr></tbody></table></div>
<p>It is important to note that this command only starts the scheduler. To execute the tasks you&#39;d have to start the Celery worker on a separate terminal:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$  celery -A django_project worker -l info
</pre></div>
</div>
<p>You can also start Celery worker along with beat using <code>-B</code> option:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ celery -A django_project worker -l info -B
</pre></div>
</div>
<p>Now the expired snippets will be deleted automatically at midnight daily.</p>
<span id="monitoring-tasks-using-flower" class="anchor-target"></span><h2 class="heading">Monitoring Tasks using Flower <a class="header-link" href="#monitoring-tasks-using-flower">#</a></h2>

<p>Flower is a web-based tool for monitoring and administering celery. To install Flower type the following command:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ pip install flower
</pre></div>
</div>
<p>To launch the web-based tool type the following:</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ celery -A django_project flower
</pre></div>
</div>
<p>By default, this command starts a web server at post 5555. To change the port use <code>--port</code> option.</p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>$ celery -A django_project flower --port=5555
</pre></div>
</div>
<p>Open your browser and navigate to <code>http://localhost:5555/</code>. You should see a dashboard like this:</p>

<p><img src="../../media/uploads/2018/5/28/Selection_227-d1df30ae-11a3-422d-972a-97b4349f45a4.png" loading="lazy" alt=""/></p>



    



        <nav aria-label="pagination">
            <ul class="pager">
                
                    <li class="previous">
                        <a href="../searching-snippets/index.html" title="Searching Snippets">
                            <span class="fa fa-arrow-left" aria-hidden="true"></span>
                            Searching Snippets
                        </a>
                    </li>
                

                
                    <li class="next">
                        <a href="../flatpages-in-django/index.html" title="Flatpages in Django">
                            Flatpages in Django
                            <span class="fa fa-arrow-right" aria-hidden="true"></span>
                        </a>
                    </li>
                
            </ul>
        </nav>







    <hr/>
    <div id="disqus_thread">
    <p style="margin-bottom: 10px" class="text-center">
        <a href="#" class=" btn btn-primary comments-holder" onclick="loadDisqus();return false;">
            <i class="fa fa-comments" aria-hidden="true"></i> Load Comments
        </a>
    </p>
    </div>
    <hr/>
    <script>
        var is_disqus_loaded = false;
        function loadDisqus() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '../../../overiqcom.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        };
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>







            </div>
        </div>


        <div class="sidebar">
        
            <div class="col-lg-4 col-md-4 col-sm-12">
                

    
        
    <div class="well">
        <h4>Django 1.11 Tutorial</h4>
        <ul>
            
                <li><a href="../intro-to-django/index.html">Intro to Django</a></li>
            
                <li><a href="../installing-django/index.html">Installing Django</a></li>
            
                <li><a href="../creating-django-project/index.html">Creating Django Project</a></li>
            
                <li><a href="../mvc-pattern-and-django/index.html">MVC Pattern and Django</a></li>
            
                <li><a href="../views-and-urlconfs-in-django/index.html">Views and URLconfs in Django</a></li>
            
                <li><a href="../creating-urls-and-custom-response/index.html">Creating URLs and Custom Response</a></li>
            
                <li><a href="../basics-of-django-templates/index.html">Basics of Django Templates</a></li>
            
                <li><a href="../template-tags-in-django/index.html">Template tags in Django</a></li>
            
                <li><a href="../template-filters-in-django/index.html">Template filters in Django</a></li>
            
                <li><a href="../loading-templates-in-django/index.html">Loading Templates in Django</a></li>
            
                <li><a href="../template-inheritance-in-django/index.html">Template Inheritance in Django</a></li>
            
                <li><a href="../basics-of-models-in-django/index.html">Basics of Models in Django</a></li>
            
                <li><a href="../migrations-in-django/index.html">Migrations in Django</a></li>
            
                <li><a href="../django-orm-basics-part-1/index.html">Django ORM Basics Part 1</a></li>
            
                <li><a href="../django-orm-basics-part-2/index.html">Django ORM Basics Part 2</a></li>
            
                <li><a href="../django-admin-app/index.html">Django Admin App</a></li>
            
                <li><a href="../django-authentication-framework-basics/index.html">Django Authentication Framework Basics</a></li>
            
                <li><a href="../data-migrations-in-django/index.html">Data migrations in Django</a></li>
            
                <li><a href="../django-form-basics/index.html">Django Form Basics</a></li>
            
                <li><a href="../displaying-forms-in-django/index.html">Displaying Forms in Django</a></li>
            
                <li><a href="../django-rendering-form-fields-manually/index.html">Django Rendering Form Fields Manually</a></li>
            
                <li><a href="../handling-static-content-in-django/index.html">Handling Static Content in Django</a></li>
            
                <li><a href="../handling-media-files-in-django/index.html">Handling Media Files in Django</a></li>
            
                <li><a href="../building-djangobin-the-first-steps/index.html">Building Djangobin - The First Steps</a></li>
            
                <li><a href="../creating-trending-snippet-page/index.html">Creating Trending Snippet Page</a></li>
            
                <li><a href="../building-contact-us-form/index.html">Building Contact Us Form</a></li>
            
                <li><a href="../django-logging-users-in-and-out/index.html">Django Logging Users In and Out</a></li>
            
                <li><a href="../user-registration-in-django/index.html">User Registration in Django</a></li>
            
                <li><a href="../building-profile-pages-for-djangobin/index.html">Building profile pages for Djangobin</a></li>
            
                <li><a href="../searching-snippets/index.html">Searching Snippets</a></li>
            
                <li><a href="index.html">Asynchronous Tasks with Celery</a></li>
            
                <li><a href="../flatpages-in-django/index.html">Flatpages in Django</a></li>
            
                <li><a href="../creating-sitemaps-in-django/index.html">Creating Sitemaps in Django</a></li>
            
                <li><a href="../settings-for-multiple-environments-in-django/index.html">Settings for Multiple Environments in Django</a></li>
            
                <li><a href="../deploying-django-project-to-digitalocean/index.html">Deploying Django Project to DigitalOcean</a></li>
            
        </ul>
    </div>

    

    
        

<div class="well">
    <h4>Recent Posts</h4>
    <ul>
        
            <li><a href="../../machine-learning-experts-you-should-be-following-online/index.html">Machine Learning Experts You Should Be Following Online</a></li>
        
            <li><a href="../../4-ways-to-prepare-for-the-ap-computer-science-a-exam/index.html">4 Ways to Prepare for the AP Computer Science A Exam</a></li>
        
            <li><a href="../../finance-assignment-online-help-for-the-busy-and-tired-students-get-help-from-experts/index.html">Finance Assignment Online Help for the Busy and Tired Students: Get Help from Experts</a></li>
        
            <li><a href="../../top-9-machine-learning-algorithms-for-data-scientists/index.html">Top 9 Machine Learning Algorithms for Data Scientists</a></li>
        
            <li><a href="../../data-science-learning-path-or-steps-to-become-a-data-scientist-final/index.html">Data Science Learning Path or Steps to become a data scientist Final</a></li>
        
            <li><a href="../../enable-edit-button-in-shutter-in-linux-mint-19-and-ubuntu-18-04/index.html">Enable Edit Button in Shutter In Linux Mint 19 and Ubuntu 18.04</a></li>
        
            <li><a href="../../python-3-time-module/index.html">Python 3 time module</a></li>
        
            <li><a href="../../pygments-tutorial/index.html">Pygments Tutorial</a></li>
        
            <li><a href="../../how-to-use-virtualenv/index.html">How to use Virtualenv?</a></li>
        
            <li><a href="../../installing-mysql-windows-linux-and-mac/index.html">Installing MySQL (Windows, Linux and Mac)</a></li>
        
            <li><a href="../../what-is-if-__name__-__main__-in-python/index.html">What is if __name__ == &#39;__main__&#39;  in Python ?</a></li>
        
            <li><a href="../../installing-goaccess-a-real-time-web-log-analyzer/index.html">Installing GoAccess (A Real-time web log analyzer)</a></li>
        
            <li><a href="../../installing-isso/index.html">Installing Isso</a></li>
        
    </ul>
</div>

<!-- Blog Search Well -->





















    



            </div>
        </div>
    </div>



    

</div>

<!-- Footer -->
<footer class="overiq-footer">
    <div class="container">
        <div class="row">

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../terms-of-use/index.html">Terms</a></li>
                    <li><a href="../../privacy-policy/index.html">Privacy Policy</a></li>
                    <li><a href="../../sitemap.xml/index.html">Sitemap</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../contact/index.html">Contact</a></li>
                    <li><a href="../../blog/index.html">Blog</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="https://www.facebook.com/OverIQ/">Facebook</a></li>
                    <li><a href="https://twitter.com/infoOverIQ">Twitter</a></li>
                    <li><a href="https://github.com/overiq">Github</a></li>
                </ul>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../c-programming-101/index.html">C Tutorial</a></li>
                    <li><a href="../../python-101/index.html">Python Tutorial</a></li>
                    <li><a href="../index.html">Django Tutorial</a></li>
                    <li><a href="../../flask-101/index.html">Flask Tutorial</a></li>
                    <li><a href="../../mysql-connector-python-101/index.html">MySQL Connector/Python Tutorial</a></li>
                    <li><a href="../../sqlalchemy-101/index.html">SQLAlchemy Tutorial</a></li>
                    <li><a href="../../c-examples/index.html">C Programming Examples</a></li>
                </ul>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row text-center">
            <p>© 2025 OverIQ.com</p>
            <small><a href="#">Back to top</a></small>
        </div>

        <!-- /.row -->
    </div>
</footer>



<script type="text/javascript" src="../../static/CACHE/js/output.2e0ff002c1a4.js"></script>




<script async="" src="../../../cdn.jsdelivr.net/npm/cookieconsent%403/build/cookieconsent.min.js" data-cfasync="false"></script>

<script>

    
    window.addEventListener('load', function () {
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#5ca9e0",
                    "text": "#ffffff"
                },
                "button": {
                    "background": "#fff",
                    "text": "#237afc"
                }
            },
            "theme": "classic",
            "position": "top",
            "static": true,
            "content": {
                "href": "https://overiq.com/privacy-policy/"
            }
        });
    });


</script>

<script src="../../../polyfill.io/v3/polyfill.min1162.js?features=es6"></script>
<script id="MathJax-script" defer="" src="../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml.js"></script>

<script async="" type="text/javascript" src="../../../cdn.carbonads.com/carbonfbdb.js?serve=CE7DC53E&amp;placement=overiqcom" id="_carbonads_js"></script>





<script data-cfasync="false">function _emitEzConsentEvent(){var customEvent=new CustomEvent("ezConsentEvent",{detail:{ezTcfConsent:window.ezTcfConsent},bubbles:true,cancelable:true,});document.dispatchEvent(customEvent);}
(function(window,document){function _setAllEzConsentTrue(){window.ezTcfConsent.loaded=true;window.ezTcfConsent.store_info=true;window.ezTcfConsent.develop_and_improve_services=true;window.ezTcfConsent.measure_ad_performance=true;window.ezTcfConsent.measure_content_performance=true;window.ezTcfConsent.select_basic_ads=true;window.ezTcfConsent.create_ad_profile=true;window.ezTcfConsent.select_personalized_ads=true;window.ezTcfConsent.create_content_profile=true;window.ezTcfConsent.select_personalized_content=true;window.ezTcfConsent.understand_audiences=true;window.ezTcfConsent.use_limited_data_to_select_content=true;window.ezTcfConsent.select_personalized_content=true;}
function _clearEzConsentCookie(){document.cookie="ezCMPCookieConsent=tcf2;Domain=.overiq.com;Path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT";}
_clearEzConsentCookie();if(typeof window.__tcfapi!=="undefined"){window.ezgconsent=false;var amazonHasRun=false;function _ezAllowed(tcdata,purpose){return(tcdata.purpose.consents[purpose]||tcdata.purpose.legitimateInterests[purpose]);}
function _handleConsentDecision(tcdata){window.ezTcfConsent.loaded=true;if(!tcdata.vendor.consents["347"]&&!tcdata.vendor.legitimateInterests["347"]){window._emitEzConsentEvent();return;}
window.ezTcfConsent.store_info=_ezAllowed(tcdata,"1");window.ezTcfConsent.develop_and_improve_services=_ezAllowed(tcdata,"10");window.ezTcfConsent.measure_content_performance=_ezAllowed(tcdata,"8");window.ezTcfConsent.select_basic_ads=_ezAllowed(tcdata,"2");window.ezTcfConsent.create_ad_profile=_ezAllowed(tcdata,"3");window.ezTcfConsent.select_personalized_ads=_ezAllowed(tcdata,"4");window.ezTcfConsent.create_content_profile=_ezAllowed(tcdata,"5");window.ezTcfConsent.measure_ad_performance=_ezAllowed(tcdata,"7");window.ezTcfConsent.use_limited_data_to_select_content=_ezAllowed(tcdata,"11");window.ezTcfConsent.select_personalized_content=_ezAllowed(tcdata,"6");window.ezTcfConsent.understand_audiences=_ezAllowed(tcdata,"9");window._emitEzConsentEvent();}
function _handleGoogleConsentV2(tcdata){if(!tcdata||!tcdata.purpose||!tcdata.purpose.consents){return;}
var googConsentV2={};if(tcdata.purpose.consents[1]){googConsentV2.ad_storage='granted';googConsentV2.analytics_storage='granted';}
if(tcdata.purpose.consents[3]&&tcdata.purpose.consents[4]){googConsentV2.ad_personalization='granted';}
if(tcdata.purpose.consents[1]&&tcdata.purpose.consents[7]){googConsentV2.ad_user_data='granted';}
if(googConsentV2.analytics_storage=='denied'){gtag('set','url_passthrough',true);}
gtag('consent','update',googConsentV2);}
__tcfapi("addEventListener",2,function(tcdata,success){if(!success||!tcdata){window._emitEzConsentEvent();return;}
if(!tcdata.gdprApplies){_setAllEzConsentTrue();window._emitEzConsentEvent();return;}
if(tcdata.eventStatus==="useractioncomplete"||tcdata.eventStatus==="tcloaded"){if(typeof gtag!='undefined'){_handleGoogleConsentV2(tcdata);}
_handleConsentDecision(tcdata);if(tcdata.purpose.consents["1"]===true&&tcdata.vendor.consents["755"]!==false){window.ezgconsent=true;(adsbygoogle=window.adsbygoogle||[]).pauseAdRequests=0;}
if(window.__ezconsent){__ezconsent.setEzoicConsentSettings(ezConsentCategories);}
__tcfapi("removeEventListener",2,function(success){return null;},tcdata.listenerId);if(!(tcdata.purpose.consents["1"]===true&&_ezAllowed(tcdata,"2")&&_ezAllowed(tcdata,"3")&&_ezAllowed(tcdata,"4"))){if(typeof __ez=="object"&&typeof __ez.bit=="object"&&typeof window["_ezaq"]=="object"&&typeof window["_ezaq"]["page_view_id"]=="string"){__ez.bit.Add(window["_ezaq"]["page_view_id"],[new __ezDotData("non_personalized_ads",true),]);}}}});}else{_setAllEzConsentTrue();window._emitEzConsentEvent();}})(window,document);</script></body>
<!-- Mirrored from overiq.com/django-1-11/asynchronous-tasks-with-celery/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:15:16 GMT -->
</html>