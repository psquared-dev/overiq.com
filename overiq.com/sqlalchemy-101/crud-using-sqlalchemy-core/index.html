<!DOCTYPE html><html lang="en">
<!-- Mirrored from overiq.com/sqlalchemy-101/crud-using-sqlalchemy-core/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:16:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"/>
<script>var __ezHttpConsent={setByCat:function(src,tagType,attributes,category,force){var setScript=function(){if(force||window.ezTcfConsent[category]){var scriptElement=document.createElement(tagType);scriptElement.src=src;attributes.forEach(function(attr){for(var key in attr){if(attr.hasOwnProperty(key)){scriptElement.setAttribute(key,attr[key]);}}});var firstScript=document.getElementsByTagName(tagType)[0];firstScript.parentNode.insertBefore(scriptElement,firstScript);}};if(force||(window.ezTcfConsent&&window.ezTcfConsent.loaded)){setScript();}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){setScript();}else{console.error("cannot get ez consent data");force=true;setScript();}});}else{force=true;setScript();console.error("getEzConsentData is not a function");}},};</script>
<script>var ezTcfConsent=window.ezTcfConsent?window.ezTcfConsent:{loaded:false,store_info:false,develop_and_improve_services:false,measure_ad_performance:false,measure_content_performance:false,select_basic_ads:false,create_ad_profile:false,select_personalized_ads:false,create_content_profile:false,select_personalized_content:false,understand_audiences:false,use_limited_data_to_select_content:false,};function getEzConsentData(){return new Promise(function(resolve){document.addEventListener("ezConsentEvent",function(event){var ezTcfConsent=event.detail.ezTcfConsent;resolve(ezTcfConsent);});});}</script>
<script>if(typeof _setEzCookies!=='function'){function _setEzCookies(ezConsentData){var cookies=window.ezCookieQueue;for(var i=0;i<cookies.length;i++){var cookie=cookies[i];if(ezConsentData&&ezConsentData.loaded&&ezConsentData[cookie.tcfCategory]){document.cookie=cookie.name+"="+cookie.value;}}}}
window.ezCookieQueue=window.ezCookieQueue||[];if(typeof addEzCookies!=='function'){function addEzCookies(arr){window.ezCookieQueue=[...window.ezCookieQueue,...arr];}}
addEzCookies([]);if(window.ezTcfConsent&&window.ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else{console.error("cannot get ez consent data");_setEzCookies(window.ezTcfConsent);}});}else{console.error("getEzConsentData is not a function");_setEzCookies(window.ezTcfConsent);}</script>
<script data-ezscrex='false' data-cfasync='false' data-pagespeed-no-defer>var __ez=__ez||{};__ez.stms=Date.now();__ez.evt={};__ez.script={};__ez.ck=__ez.ck||{};__ez.template={};__ez.template.isOrig=true;window.__ezScriptHost="//www.ezojs.com";__ez.queue=__ez.queue||function(){var e=0,i=0,t=[],n=!1,o=[],r=[],s=!0,a=function(e,i,n,o,r,s,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,d=this;this.name=e,this.funcName=i,this.parameters=null===n?null:w(n)?n:[n],this.isBlock=o,this.blockedBy=r,this.deleteWhenComplete=s,this.isError=!1,this.isComplete=!1,this.isInitialized=!1,this.proceedIfError=a,this.fWindow=l,this.isTimeDelay=!1,this.process=function(){f("... func = "+e),d.isInitialized=!0,d.isComplete=!0,f("... func.apply: "+e);var i=d.funcName.split("."),n=null,o=this.fWindow||window;i.length>3||(n=3===i.length?o[i[0]][i[1]][i[2]]:2===i.length?o[i[0]][i[1]]:o[d.funcName]),null!=n&&n.apply(null,this.parameters),!0===d.deleteWhenComplete&&delete t[e],!0===d.isBlock&&(f("----- F'D: "+d.name),m())}},l=function(e,i,t,n,o,r,s){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,l=this;this.name=e,this.path=i,this.async=o,this.defer=r,this.isBlock=t,this.blockedBy=n,this.isInitialized=!1,this.isError=!1,this.isComplete=!1,this.proceedIfError=s,this.fWindow=a,this.isTimeDelay=!1,this.isPath=function(e){return"/"===e[0]&&"/"!==e[1]},this.getSrc=function(e){return void 0!==window.__ezScriptHost&&this.isPath(e)&&"banger.js"!==this.name?window.__ezScriptHost+e:e},this.process=function(){l.isInitialized=!0,f("... file = "+e);var i=this.fWindow?this.fWindow.document:document,t=i.createElement("script");t.src=this.getSrc(this.path),!0===o?t.async=!0:!0===r&&(t.defer=!0),t.onerror=function(){var e={url:window.location.href,name:l.name,path:l.path,user_agent:window.navigator.userAgent};"undefined"!=typeof _ezaq&&(e.pageview_id=_ezaq.page_view_id);var i=encodeURIComponent(JSON.stringify(e)),t=new XMLHttpRequest;t.open("GET/index.html","//g.ezoic.net/ezqlog?d="+i,!0),t.send(),f("----- ERR'D: "+l.name),l.isError=!0,!0===l.isBlock&&m()},t.onreadystatechange=t.onload=function(){var e=t.readyState;f("----- F'D: "+l.name),e&&!/loaded|complete/.test(e)||(l.isComplete=!0,!0===l.isBlock&&m())},i.getElementsByTagName("head")[0].appendChild(t)}},d=function(e,i){this.name=e,this.path="",this.async=!1,this.defer=!1,this.isBlock=!1,this.blockedBy=[],this.isInitialized=!0,this.isError=!1,this.isComplete=i,this.proceedIfError=!1,this.isTimeDelay=!1,this.process=function(){}};function c(e,i,n,s,a,d,c,u,f){var m=new l(e,i,n,s,a,d,c,f);!0===u?o[e]=m:r[e]=m,t[e]=m,h(m)}function h(e){!0!==u(e)&&0!=s&&e.process()}function u(e){if(!0===e.isTimeDelay&&!1===n)return f(e.name+" blocked = TIME DELAY!"),!0;if(w(e.blockedBy))for(var i=0;i<e.blockedBy.length;i++){var o=e.blockedBy[i];if(!1===t.hasOwnProperty(o))return f(e.name+" blocked = "+o),!0;if(!0===e.proceedIfError&&!0===t[o].isError)return!1;if(!1===t[o].isComplete)return f(e.name+" blocked = "+o),!0}return!1}function f(e){var i=window.location.href,t=new RegExp("[?&]ezq=([^&#]*)","i").exec(i);"1"===(t?t[1]:null)&&console.debug(e)}function m(){++e>200||(f("let's go"),p(o),p(r))}function p(e){for(var i in e)if(!1!==e.hasOwnProperty(i)){var t=e[i];!0===t.isComplete||u(t)||!0===t.isInitialized||!0===t.isError?!0===t.isError?f(t.name+": error"):!0===t.isComplete?f(t.name+": complete already"):!0===t.isInitialized&&f(t.name+": initialized already"):t.process()}}function w(e){return"[object Array]"==Object.prototype.toString.call(e)}return window.addEventListener("load",(function(){setTimeout((function(){n=!0,f("TDELAY -----"),m()}),5e3)}),!1),{addFile:c,addFileOnce:function(e,i,n,o,r,s,a,l,d){t[e]||c(e,i,n,o,r,s,a,l,d)},addDelayFile:function(e,i){var n=new l(e,i,!1,[],!1,!1,!0);n.isTimeDelay=!0,f(e+" ...  FILE! TDELAY"),r[e]=n,t[e]=n,h(n)},addFunc:function(e,n,s,l,d,c,u,f,m,p){!0===c&&(e=e+"_"+i++);var w=new a(e,n,s,l,d,u,f,p);!0===m?o[e]=w:r[e]=w,t[e]=w,h(w)},addDelayFunc:function(e,i,n){var o=new a(e,i,n,!1,[],!0,!0);o.isTimeDelay=!0,f(e+" ...  FUNCTION! TDELAY"),r[e]=o,t[e]=o,h(o)},items:t,processAll:m,setallowLoad:function(e){s=e},markLoaded:function(e){if(e&&0!==e.length){if(e in t){var i=t[e];!0===i.isComplete?f(i.name+" "+e+": error loaded duplicate"):(i.isComplete=!0,i.isInitialized=!0)}else t[e]=new d(e,!0);f("markLoaded dummyfile: "+t[e].name)}},logWhatsBlocked:function(){for(var e in t)!1!==t.hasOwnProperty(e)&&u(t[e])}}}();__ez.evt.add=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n()},__ez.evt.remove=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):delete e["on"+t]};__ez.script.add=function(e){var t=document.createElement("script");t.src=e,t.async=!0,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t)};__ez.dot={};__ez.queue.addFile('../../detroitchicago/boise.js', '../../detroitchicago/boisebb26.js?gcb=195-3&amp;cb=5', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/abilene.js', '../../parsonsmaize/abilenec0f9.js?gcb=195-3&amp;cb=7f81d60744', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/mulvane.js', '../../parsonsmaize/mulvane2d63.js?gcb=195-3&amp;cb=e75e48eec0', true, ['/parsonsmaize/abilene.js'], true, false, true, false);__ez.queue.addFile('../../detroitchicago/birmingham.js', '../../detroitchicago/birminghame7ec.js?gcb=195-3&amp;cb=539c47377c', true, ['/parsonsmaize/abilene.js'], true, false, true, false);</script>
<script data-ezscrex="false" type="text/javascript" data-cfasync="false">window._ezaq = Object.assign({"ad_cache_level":1,"adpicker_placement_cnt":0,"ai_placeholder_cache_level":1,"ai_placeholder_placement_cnt":-1,"domain_id":92771,"ezcache_level":1,"ezcache_skip_code":0,"has_bad_image":0,"has_bad_words":0,"is_sitespeed":0,"lt_cache_level":0,"response_size":208463,"response_size_orig":202695,"response_time_orig":542,"template_id":5,"url":"https://overiq.com/sqlalchemy-101/crud-using-sqlalchemy-core/","word_count":0,"worst_bad_word_level":0}, typeof window._ezaq !== "undefined" ? window._ezaq : {});__ez.queue.markLoaded('ezaqBaseReady');</script>
<script type='text/javascript' data-ezscrex='false' data-cfasync='false'>
window.ezAnalyticsStatic = true;

function analyticsAddScript(script) {
	var ezDynamic = document.createElement('script');
	ezDynamic.type = 'text/javascript';
	ezDynamic.innerHTML = script;
	document.head.appendChild(ezDynamic);
}
function getCookiesWithPrefix() {
    var allCookies = document.cookie.split(';');
    var cookiesWithPrefix = {};

    for (var i = 0; i < allCookies.length; i++) {
        var cookie = allCookies[i].trim();

        for (var j = 0; j < arguments.length; j++) {
            var prefix = arguments[j];
            if (cookie.indexOf(prefix) === 0) {
                var cookieParts = cookie.split('=');
                var cookieName = cookieParts[0];
                var cookieValue = cookieParts.slice(1).join('=');
                cookiesWithPrefix[cookieName] = decodeURIComponent(cookieValue);
                break; // Once matched, no need to check other prefixes
            }
        }
    }

    return cookiesWithPrefix;
}
function productAnalytics() {
	var d = {"pr":[6],"omd5":"21540cf8af21174dfccf10f7a1375a54"};
	d.u = _ezaq.url;
	d.p = _ezaq.page_view_id;
	d.v = _ezaq.visit_uuid;
	d.ab = _ezaq.ab_test_id;
	d.e = JSON.stringify(_ezaq);
	d.ref = document.referrer;
	d.c = getCookiesWithPrefix('active_template', 'ez', 'lp_');
	if(typeof ez_utmParams !== 'undefined') {
		d.utm = ez_utmParams;
	}

	var dataText = JSON.stringify(d);
	var xhr = new XMLHttpRequest();
	xhr.open('POST/index.html','/ezais/analytics?cb=1', true);
	xhr.onload = function () {
		if (xhr.status!=200) {
            return;
		}

        if(document.readyState !== 'loading') {
            analyticsAddScript(xhr.response);
            return;
        }

        var eventFunc = function() {
            if(document.readyState === 'loading') {
                return;
            }
            document.removeEventListener('readystatechange', eventFunc, false);
            analyticsAddScript(xhr.response);
        };

        document.addEventListener('readystatechange', eventFunc, false);
	};
	xhr.setRequestHeader('Content-Type','text/plain');
	xhr.send(dataText);
}
__ez.queue.addFunc("productAnalytics", "productAnalytics", null, true, ['ezaqBaseReady'], false, false, false, true);
</script><base />
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>CRUD using SQLAlchemy Core - SQLAlchemy Tutorial - OverIQ.com</title>

    
    



    <meta name="description" content="SQL Expression Language #

SQL Expression Language is a backend neutral way to writing SQL statement using Python.
Inserting Records #

There are sev…"/>



    <link rel="canonical" href="index.html"/>


<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="CRUD using SQLAlchemy Core"/>

    <meta property="og:description" content="SQL Expression Language #

SQL Expression Language is a backend neutral way to writing SQL statement using Python.
Inserting Records #

There are sev…"/>


<meta property="og:url" content="https://overiq.com/sqlalchemy-101/crud-using-sqlalchemy-core/"/>
<meta property="og:site_name" content="OverIQ.com"/>


<meta property="article:publisher" content="https://www.facebook.com/OverIQ/"/>



<meta name="twitter:card" content="summary_large_image"/>

    <meta name="twitter:description" content="SQL Expression Language #

SQL Expression Language is a backend neutral way to writing SQL statement using Python.
Inserting Records #

There are sev…"/>


<meta name="twitter:title" content="CRUD using SQLAlchemy Core"/>
<meta name="twitter:site" content="@infoOverIQ"/>

<meta name="twitter:creator" content="@infoOverIQ"/>




    
    
    


    
    
    


    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../feed.xml/index.html"/>
    
    
    <link href="../../../fonts.googleapis.com/cssd2d5.css?family=Open+Sans" rel="stylesheet"/>
    <link rel="stylesheet" href="../../../maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="icon" href="../../static/wiki/favicon.png" sizes="32x32"/>

    <link rel="stylesheet" href="../../static/CACHE/css/output.db46da465a8b.css" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-125424793-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125424793-1');
    </script>


<script type='text/javascript'>
var ezoTemplate = 'orig_site';
var ezouid = '1';
var ezoFormfactor = '1';
</script><script data-ezscrex="false" type='text/javascript'>
var soc_app_id = '0';
var did = 92771;
var ezdomain = 'overiq.com';
var ezoicSearchable = 1;
</script></head>
<body>

<div class="overiq-header text-center">
    <div class="site-branding">
        <p class="main-title">
            <a href="../../index.html" rel="home">
                OverIQ.com
            </a>
        </p>
    </div>
</div>

<!-- Navigation -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html">Home</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                

                <li>
                    <a href="../../blog/index.html">Blog</a>
                </li>
                <li>
                    <a href="../../contact/index.html">Contact</a>
                </li>
                <li>
                    <a href="../../about/index.html">About</a>
                </li>
            </ul>

            <ul class="nav navbar-nav navbar-right visible-lg visible-md">
                <li>
                    <a href="../../feed.xml/index.html" title="RSS" target="_blank">
                        <i class="fa fa-rss fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/overiq/" target="_blank" title="Github">
                        <i class="fa fa-github fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://www.facebook.com/OverIQ/" target="_blank" title="Facebook">
                        <i class="fa fa-facebook fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://twitter.com/infoOverIQ" target="_blank" title="Twitter">
                        <i class="fa fa-twitter fa-lg" aria-hidden="true"></i>
                    </a>
                </li>

                

            </ul>

            <form action="https://overiq.com/search/" class="navbar-form navbar-left" role="search">

                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search" name="query" value=""/>
                </div>

                <button type="submit" class="btn btn-default">Submit</button>
            </form>

        </div>



        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<div class="container">

    


    <div class="se-pre-con"></div>

    

    <div class="row">

        
        <div class="main">
            <div class="col-lg-8 col-md-8 col-sm-12">
                

    


    
        <ol class="breadcrumb">

    <li><a href="../../index.html">Home</a></li>

    
        
        <li><a href="../index.html">SQLAlchemy Tutorial</a></li>
        

        

        
    
        

        

        
            <li class="active">CRUD using SQLAlchemy Core</li>
        
    

</ol>
    


<h1>CRUD using SQLAlchemy Core</h1>




    <p><i class="fa fa-calendar" aria-hidden="true"></i>
        Last updated on July 27, 2020
    </p>


<hr/>



<span id="sql-expression-language" class="anchor-target"></span><h2 class="heading">SQL Expression Language <a class="header-link" href="#sql-expression-language">#</a></h2>

<p>SQL Expression Language is a backend neutral way to writing SQL statement using Python.</p>
<span id="inserting-records" class="anchor-target"></span><h2 class="heading">Inserting Records <a class="header-link" href="#inserting-records">#</a></h2>

<p>There are several ways to insert records into the database. The most basic way is to use the <code>insert()</code> method of the <code>Table</code> instance and pass values of the columns as keyword arguments to the <code>values()</code> method.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">ins</span> <span class="o">=</span> <span class="n">customers</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Green&#39;</span><span class="p">,</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;johngreen&#39;</span><span class="p">,</span>
    <span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;johngreen@mail.com&#39;</span><span class="p">,</span>
    <span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;164 Hidden Valley Road&#39;</span><span class="p">,</span>
    <span class="n">town</span> <span class="o">=</span> <span class="s1">&#39;Norfolk&#39;</span>
<span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>To view the SQL this code would generate type the following:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="nb">str</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&#39;INSERT INTO customers (first_name, last_name, username, email, created_on, updated_on) 
VALUES (:first_name, :last_name, :username, :email, :created_on, :updated_on)&#39;
</pre></div>
</td></tr></tbody></table></div>
<p>Notice that the <code>VALUES</code> clause contains the bind parameters (i.e a parameter of the form <code>:name</code>) instead of the values passed to the <code>values()</code> method.</p>

<p>When the query is run against the database the dialect will replace the bind parameters with the actual values. The dialect will also escape the values to mitigate the risk of SQL injection.</p>

<p>We can view the values that will replace the bind parameters by compiling the insert statement.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">ins</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{&#39;address&#39;: &#39;164 Hidden Valley Road&#39;,
 &#39;created_on&#39;: None,
 &#39;email&#39;: &#39;johngreen@mail.com&#39;,
 &#39;first_name&#39;: &#39;John&#39;,
 &#39;last_name&#39;: &#39;Green&#39;,
 &#39;town&#39;: &#39;Norfolk&#39;,
 &#39;updated_on&#39;: None,
 &#39;username&#39;: &#39;johngreen&#39;}
</pre></div>
</td></tr></tbody></table></div>
<p>We have created the insert statement but we haven&#39;t sent it to the database. To do that, call the <code>execute()</code> method of the <code>Connection</code> object.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">conn</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
<span class="n">r</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Connection</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fa82a7d53c8</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">ResultProxy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fa828096da0</span><span class="o">&gt;</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The above code inserts the following record in the <code>customers</code> table.</p>

<p><img src="../../media/uploads/2018/7/9/Selection_236-a3e845f7-6671-4384-83ca-7a726e745b63.png" loading="lazy" alt=""/></p>

<p>The <code>execute()</code> method returns an object of type <code>ResultProxy</code>. The <code>ResultProxy</code> provides several attributes, one of them is called <code>inserted_primary_key</code> which returns the primary key of the records just inserted.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">inserted_primary_key</span>
<span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inserted_primary_key</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[1]
list
</pre></div>
</td></tr></tbody></table></div>
<p>Another way to create insert statement is to use the standalone <code>insert()</code> function from the <code>sqlalchemy</code> package.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">insert</span>

<span class="n">ins</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Katherine&#39;</span><span class="p">,</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Wilson&#39;</span><span class="p">,</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;katwilson&#39;</span><span class="p">,</span>
    <span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;katwilson@gmail.com&#39;</span><span class="p">,</span>
    <span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;4685 West Side Avenue&#39;</span><span class="p">,</span>
    <span class="n">town</span> <span class="o">=</span> <span class="s1">&#39;Peterbrugh&#39;</span>
<span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">inserted_primary_key</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div><span id="multiple-inserts" class="anchor-target"></span><h2 class="heading">Multiple Inserts <a class="header-link" href="#multiple-inserts">#</a></h2>

<p>Instead of passing values to the <code>values()</code> method as keyword arguments, we can also pass them to the <code>execute()</code> method.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">ins</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> 
    <span class="n">first_name</span> <span class="o">=</span> <span class="s2">&#34;Tim&#34;</span><span class="p">,</span> 
    <span class="n">last_name</span> <span class="o">=</span> <span class="s2">&#34;Snyder&#34;</span><span class="p">,</span> 
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&#34;timsnyder&#34;</span><span class="p">,</span> 
    <span class="n">email</span> <span class="o">=</span> <span class="s2">&#34;timsnyder@mail.com&#34;</span><span class="p">,</span>
    <span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;1611 Sundown Lane&#39;</span><span class="p">,</span>
    <span class="n">town</span> <span class="o">=</span> <span class="s1">&#39;Langdale&#39;</span>
<span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">inserted_primary_key</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code>execute()</code> method is quite flexible because it allows us to insert multiple rows by passing a list of dictionaries each representing a row to be inserted.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&#34;first_name&#34;</span><span class="p">:</span> <span class="s2">&#34;John&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Lara&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;johnlara&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;email&#34;</span><span class="p">:</span><span class="s2">&#34;johnlara@mail.com&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;3073 Derek Drive&#34;</span><span class="p">,</span>
            <span class="s2">&#34;town&#34;</span><span class="p">:</span> <span class="s2">&#34;Norfolk&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&#34;first_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Sarah&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Tomlin&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;sarahtomlin&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;email&#34;</span><span class="p">:</span><span class="s2">&#34;sarahtomlin@mail.com&#34;</span><span class="p">,</span>
            <span class="s2">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;3572 Poplar Avenue&#34;</span><span class="p">,</span>
            <span class="s2">&#34;town&#34;</span><span class="p">:</span> <span class="s2">&#34;Norfolk&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&#34;first_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Pablo&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Gibson&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;pablogibson&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;email&#34;</span><span class="p">:</span><span class="s2">&#34;pablogibson@mail.com&#34;</span><span class="p">,</span>
            <span class="s2">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;3494 Murry Street&#34;</span><span class="p">,</span>
            <span class="s2">&#34;town&#34;</span><span class="p">:</span> <span class="s2">&#34;Peterbrugh&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&#34;first_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Pablo&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Lewis&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;pablolewis&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;email&#34;</span><span class="p">:</span><span class="s2">&#34;pablolewis@mail.com&#34;</span><span class="p">,</span>
            <span class="s2">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;3282 Jerry Toth Drive&#34;</span><span class="p">,</span>
            <span class="s2">&#34;town&#34;</span><span class="p">:</span> <span class="s2">&#34;Peterbrugh&#34;</span>
        <span class="p">},</span>
    <span class="p">])</span>

<span class="n">r</span><span class="o">.</span><span class="n">rowcount</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong> </p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="mi">4</span>
</pre></div>
</div>
<p>Before moving on to the next section, let&#39;s add some records to the <code>items</code>, <code>orders</code> and <code>order_lines</code> table.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">items_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Chair&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">9.21</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">10.81</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Pen&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">3.45</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">4.51</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Headphone&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">15.52</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">16.81</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">50</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Travel Bag&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">20.1</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">24.21</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">50</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Keyboard&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">20.12</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">22.11</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">50</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Monitor&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">200.14</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">212.89</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">50</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Watch&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">100.58</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">104.41</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">50</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Water Bottle&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cost_price&#34;</span><span class="p">:</span> <span class="mf">20.89</span><span class="p">,</span>
        <span class="s2">&#34;selling_price&#34;</span><span class="p">:</span> <span class="mf">25.00</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">50</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">order_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&#34;customer_id&#34;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;customer_id&#34;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">order_line_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&#34;order_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&#34;item_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">},</span> 
    <span class="p">{</span>
        <span class="s2">&#34;order_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&#34;item_id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">},</span> 
    <span class="p">{</span>
        <span class="s2">&#34;order_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&#34;item_id&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;order_id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&#34;item_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&#34;order_id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&#34;item_id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="n">items_list</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">rowcount</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert</span><span class="p">(</span><span class="n">orders</span><span class="p">),</span> <span class="n">order_list</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">rowcount</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert</span><span class="p">(</span><span class="n">order_lines</span><span class="p">),</span> <span class="n">order_line_list</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">rowcount</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>8
2
5
</pre></div>
</td></tr></tbody></table></div><span id="selecting-records" class="anchor-target"></span><h2 class="heading">Selecting Records <a class="header-link" href="#selecting-records">#</a></h2>

<p>To select records we use <code>select()</code> method of the <code>Table</code> object.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">customers</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>&#39;SELECT customers.id, customers.first_name, customers.last_name, customers.username, customers.email, customers.address, customers.town, customers.created_on, customers.updated_on \nFROM customers&#39;
</pre></div>
</div>
<p>As you can see, this query is not qualified in any way, as a result, it will return all the rows from the <code>customers</code> table.</p>

<p>Another way to create <code>SELECT</code> query is to use the standalone <code>select()</code> function. It accepts a list of tables or columns from where to retrieve data.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">customers</span><span class="p">])</span>
<span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>&#39;SELECT customers.id, customers.first_name, customers.last_name, customers.username, customers.email, customers.address, customers.town, customers.created_on, customers.updated_on \nFROM customers&#39;
</pre></div>
</div>
<p>As usual, to send the query to the database we use the <code>execute()</code> method:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(1, &#39;John&#39;, &#39;Green&#39;, &#39;johngreen&#39;, &#39;johngreen@mail.com&#39;, &#39;164 Hidden Valley Road&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 19, 6, 13, 844404), datetime.datetime(2018, 7, 8, 19, 6, 13, 844444)),
 (2, &#39;Katherine&#39;, &#39;Wilson&#39;, &#39;katwilson&#39;, &#39;katwilson@gmail.com&#39;, &#39;4685 West Side Avenue&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 20, 37, 57, 407023), datetime.datetime(2018, 7, 8, 20, 37, 57, 407053)),
 (17, &#39;Tim&#39;, &#39;Snyder&#39;, &#39;timsnyder&#39;, &#39;timsnyder@mail.com&#39;, &#39;1611 Sundown Lane&#39;, &#39;Langdale&#39;, datetime.datetime(2018, 7, 8, 22, 19, 55, 721864), datetime.datetime(2018, 7, 8, 22, 19, 55, 721895)),
 (18, &#39;John&#39;, &#39;Lara&#39;, &#39;johnlara&#39;, &#39;johnlara@mail.com&#39;, &#39;3073 Derek Drive&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559344), datetime.datetime(2018, 7, 8, 22, 20, 11, 559380)),
 (19, &#39;Sarah&#39;, &#39;Tomlin&#39;, &#39;sarahtomlin&#39;, &#39;sarahtomlin@mail.com&#39;, &#39;3572 Poplar Avenue&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559397), datetime.datetime(2018, 7, 8, 22, 20, 11, 559411)),
 (20, &#39;Pablo&#39;, &#39;Gibson&#39;, &#39;pablogibson&#39;, &#39;pablogibson@mail.com&#39;, &#39;3494 Murry Street&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559424), datetime.datetime(2018, 7, 8, 22, 20, 11, 559437)),
 (21, &#39;Pablo&#39;, &#39;Lewis&#39;, &#39;pablolewis&#39;, &#39;pablolewis@mail.com&#39;, &#39;3282 Jerry Toth Drive&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559450), datetime.datetime(2018, 7, 8, 22, 20, 11, 559464))]
</pre></div>
</td></tr></tbody></table></div>
<p>The <code>fetchall()</code> method of the <code>ResultProxy</code> object returns all the records matched by the query. Once the result set is exhausted, subsequent calls to <code>fetchall()</code> will return an empty list.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-pycon"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="go">[]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The <code>fetchall()</code> method loads all the results into the memory at once. Thus, it is not very efficient on a large reset set. Alternatively, you can use for loop to iterate over the result set one at a time.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>(1, &#39;John&#39;, &#39;Green&#39;, &#39;johngreen&#39;, &#39;johngreen@mail.com&#39;, &#39;164 Hidden Valley Road&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 19, 6, 13, 844404), datetime.datetime(2018, 7, 8, 19, 6, 13, 844444))
(2, &#39;Katherine&#39;, &#39;Wilson&#39;, &#39;katwilson&#39;, &#39;katwilson@gmail.com&#39;, &#39;4685 West Side Avenue&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 20, 37, 57, 407023), datetime.datetime(2018, 7, 8, 20, 37, 57, 407053))
(17, &#39;Tim&#39;, &#39;Snyder&#39;, &#39;timsnyder&#39;, &#39;timsnyder@mail.com&#39;, &#39;1611 Sundown Lane&#39;, &#39;Langdale&#39;, datetime.datetime(2018, 7, 8, 22, 19, 55, 721864), datetime.datetime(2018, 7, 8, 22, 19, 55, 721895))
(18, &#39;John&#39;, &#39;Lara&#39;, &#39;johnlara&#39;, &#39;johnlara@mail.com&#39;, &#39;3073 Derek Drive&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559344), datetime.datetime(2018, 7, 8, 22, 20, 11, 559380))
(19, &#39;Sarah&#39;, &#39;Tomlin&#39;, &#39;sarahtomlin&#39;, &#39;sarahtomlin@mail.com&#39;, &#39;3572 Poplar Avenue&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559397), datetime.datetime(2018, 7, 8, 22, 20, 11, 559411))
(20, &#39;Pablo&#39;, &#39;Gibson&#39;, &#39;pablogibson&#39;, &#39;pablogibson@mail.com&#39;, &#39;3494 Murry Street&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559424), datetime.datetime(2018, 7, 8, 22, 20, 11, 559437))
(21, &#39;Pablo&#39;, &#39;Lewis&#39;, &#39;pablolewis&#39;, &#39;pablolewis@mail.com&#39;, &#39;3282 Jerry Toth Drive&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559450), datetime.datetime(2018, 7, 8, 22, 20, 11, 559464))
</pre></div>
</td></tr></tbody></table></div>
<p>Here is a list of some common methods and attributes of the <code>ResultProxy</code> object.</p>
<div style="overflow-x:auto"><table class="table table-bordered table-hover table-condensed"><thead>
<tr>
<th>Method/Attribute</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>fetchone()</code></td>
<td>fetch the next row from the result set. If the result set has been exhausted, subsequent calls to <code>fetchone()</code> returns <code>None</code>.</td>
</tr>
<tr>
<td><code>fetchmany(size=None)</code></td>
<td>fetch the specified number of rows from the result set. If the result set has been exhausted, subsequent calls to <code>fetchmany()</code> returns <code>None</code>.</td>
</tr>
<tr>
<td><code>fetchall()</code></td>
<td>fetch all the rows from the result set. If the result set has been exhausted, subsequent calls to <code>fetchall()</code> returns <code>None</code>.</td>
</tr>
<tr>
<td><code>first()</code></td>
<td>fetch the first row from the result set and close the connection. This means that after calling the <code>first()</code> method we can&#39;t access any other rows in the result set, until we send the query to the database again (using the <code>execute()</code> method).</td>
</tr>
<tr>
<td><code>rowcount</code></td>
<td>returns the number of rows in the result set.</td>
</tr>
<tr>
<td><code>keys()</code></td>
<td>returns a list of columns from where data is retrieved.</td>
</tr>
<tr>
<td><code>scalar()</code></td>
<td>fetch the first column from the first row and close the connection. If the result set is empty it returns <code>None</code>.</td>
</tr>
</tbody>
</table></div>
<p>The following shell sessions demonstrates methods and attributes we just discussed in action.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">customers</span><span class="p">])</span>
</pre></div>
</div><span id="fetchone" class="anchor-target"></span><h3 class="heading">fetchone() <a class="header-link" href="#fetchone">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>(1, &#39;John&#39;, &#39;Green&#39;, &#39;johngreen&#39;, &#39;johngreen@mail.com&#39;, &#39;164 Hidden Valley Road&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 19, 6, 13, 844404), datetime.datetime(2018, 7, 8, 19, 6, 13, 844444))

(2, &#39;Katherine&#39;, &#39;Wilson&#39;, &#39;katwilson&#39;, &#39;katwilson@gmail.com&#39;, &#39;4685 West Side Avenue&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 20, 37, 57, 407023), datetime.datetime(2018, 7, 8, 20, 37, 57, 407053))
</pre></div>
</td></tr></tbody></table></div><span id="fetchmany" class="anchor-target"></span><h3 class="heading">fetchmany() <a class="header-link" href="#fetchmany">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(1, &#39;John&#39;, &#39;Green&#39;, &#39;johngreen&#39;, &#39;johngreen@mail.com&#39;, &#39;164 Hidden Valley Road&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 19, 6, 13, 844404), datetime.datetime(2018, 7, 8, 19, 6, 13, 844444)),
 (2, &#39;Katherine&#39;, &#39;Wilson&#39;, &#39;katwilson&#39;, &#39;katwilson@gmail.com&#39;, &#39;4685 West Side Avenue&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 20, 37, 57, 407023), datetime.datetime(2018, 7, 8, 20, 37, 57, 407053)),
 (17, &#39;Tim&#39;, &#39;Snyder&#39;, &#39;timsnyder&#39;, &#39;timsnyder@mail.com&#39;, &#39;1611 Sundown Lane&#39;, &#39;Langdale&#39;, datetime.datetime(2018, 7, 8, 22, 19, 55, 721864), datetime.datetime(2018, 7, 8, 22, 19, 55, 721895))]

[(18, &#39;John&#39;, &#39;Lara&#39;, &#39;johnlara&#39;, &#39;johnlara@mail.com&#39;, &#39;3073 Derek Drive&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559344), datetime.datetime(2018, 7, 8, 22, 20, 11, 559380)),
 (19, &#39;Sarah&#39;, &#39;Tomlin&#39;, &#39;sarahtomlin&#39;, &#39;sarahtomlin@mail.com&#39;, &#39;3572 Poplar Avenue&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559397), datetime.datetime(2018, 7, 8, 22, 20, 11, 559411)),
 (20, &#39;Pablo&#39;, &#39;Gibson&#39;, &#39;pablogibson&#39;, &#39;pablogibson@mail.com&#39;, &#39;3494 Murry Street&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559424), datetime.datetime(2018, 7, 8, 22, 20, 11, 559437)),
 (21, &#39;Pablo&#39;, &#39;Lewis&#39;, &#39;pablolewis&#39;, &#39;pablolewis@mail.com&#39;, &#39;3282 Jerry Toth Drive&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559450), datetime.datetime(2018, 7, 8, 22, 20, 11, 559464))]
</pre></div>
</td></tr></tbody></table></div><span id="first" class="anchor-target"></span><h3 class="heading">first() <a class="header-link" href="#first">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="c1"># this will result in an error</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>(4, &#39;Jon&#39;, &#39;Green&#39;, &#39;jongreen&#39;, &#39;jongreen@gmail.com&#39;, datetime.datetime(2018, 6, 22, 10, 3), datetime.datetime(2018, 6, 22, 10, 3))
...
ResourceClosedError: This result object is closed.
</pre></div>
</td></tr></tbody></table></div><span id="rowcount" class="anchor-target"></span><h3 class="heading">rowcount <a class="header-link" href="#rowcount">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">rowcount</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>7
</pre></div>
</div><span id="keys" class="anchor-target"></span><h3 class="heading">keys() <a class="header-link" href="#keys">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-pycon"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="go">[&#39;id&#39;,</span>
<span class="go"> &#39;first_name&#39;,</span>
<span class="go"> &#39;last_name&#39;,</span>
<span class="go"> &#39;username&#39;,</span>
<span class="go"> &#39;email&#39;,</span>
<span class="go"> &#39;address&#39;,</span>
<span class="go"> &#39;town&#39;,</span>
<span class="go"> &#39;created_on&#39;,</span>
<span class="go"> &#39;updated_on&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</td></tr></tbody></table></div><span id="scalar" class="anchor-target"></span><h3 class="heading">scalar() <a class="header-link" href="#scalar">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
<p>It is important to note that rows returns by methods <code>fetchxxx()</code> and <code>first()</code> are not tuples or dictionaries, instead, it is an object of type <code>RowProxy</code>, which allows us to access data in the row using column name, index position or <code>Column</code> instance. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="n">row</span>
<span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span>    <span class="c1"># access column data via column name</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    <span class="c1"># access column data via column index position</span>
<span class="n">row</span><span class="p">[</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span><span class="p">]</span>    <span class="c1"># access column data via Column object</span>
<span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">first_name</span>    <span class="c1"># access column data via attribute</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>(1, &#39;John&#39;, &#39;Green&#39;, &#39;johngreen&#39;, &#39;johngreen@mail.com&#39;, &#39;164 Hidden Valley Road&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 19, 6, 13, 844404), datetime.datetime(2018, 7, 8, 19, 6, 13, 844444))

sqlalchemy.engine.result.RowProxy

(1, &#39;John&#39;)

(1, &#39;John&#39;)

(1, &#39;John&#39;)

(1, &#39;John&#39;)
</pre></div>
</td></tr></tbody></table></div>
<p>To access data from multiple tables simply pass comma separated list of <code>Table</code> instances to the <code>select()</code> function.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">([</span><span class="n">tableOne</span><span class="p">,</span> <span class="n">tableTwo</span><span class="p">])</span>
</pre></div>
</div>
<p>This code would return the Cartesian product of rows present in both the tables. We will learn how to create an SQL JOIN later in this chapter.</p>
<span id="filtering-records" class="anchor-target"></span><h2 class="heading">Filtering Records <a class="header-link" href="#filtering-records">#</a></h2>

<p>To filter records we use <code>where()</code> method. It accept a condition and adds a <code>WHERE</code> clause to the <code>SELECT</code> statement.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">&gt;</span> <span class="mi">20</span>
<span class="p">)</span>

<span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>This query will return all the items whose cost price is greater than 20.</p>

<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s1">&#39;SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity </span><span class="se">\n</span><span class="s1">FROM items </span><span class="se">\n</span><span class="s1">WHERE items.cost_price &gt; :cost_price_1&#39;</span>

<span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Travel Bag&#39;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;20.10&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;24.21&#39;</span><span class="p">),</span> <span class="mi">50</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Keyboard&#39;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;20.12&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;22.11&#39;</span><span class="p">),</span> <span class="mi">50</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Monitor&#39;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;200.14&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;212.89&#39;</span><span class="p">),</span> <span class="mi">50</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;Watch&#39;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;100.58&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;104.41&#39;</span><span class="p">),</span> <span class="mi">50</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Water Bottle&#39;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;20.89&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;25.00&#39;</span><span class="p">),</span> <span class="mi">50</span><span class="p">)]</span>
</pre></div>
</td></tr></tbody></table></div>
<p>We can specify additional conditions by simple chaining the <code>where()</code> method.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">+</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">selling_price</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.cost_price + items.selling_price &gt; :param_1 AND items.quantity &gt; :quantity_1
</pre></div>
</td></tr></tbody></table></div>
<p>As you can see, when we chain the <code>where()</code> method the conditions are ANDed together. </p>

<p>So how do we specify <code>OR</code> or <code>NOT</code> conditions to our <code>SELECT</code> statement? </p>

<p>It turns out that instead of chaining <code>where()</code> method there are two other ways to combine conditions:</p>

<ol>
<li>Bitwise Operators.</li>
<li>Conjunctions.</li>
</ol>

<p>Let&#39;s start with the first one.</p>
<span id="bitwise-operators" class="anchor-target"></span><h3 class="heading">Bitwise Operators <a class="header-link" href="#bitwise-operators">#</a></h3>

<p>Bitwise Operators <code>&amp;</code>, <code>|</code> and <code>~</code> allow us to connect conditions with SQL <code>AND</code>, <code>OR</code> and <code>NOT</code> operators respectively. </p>

<p>The preceding query can be coded using bitwise operators as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">+</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">selling_price</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> 
    <span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Notice that the conditions are wrapped using parentheses, this is because the precedence of bitwise operators is greater than that of <code>+</code> and <code>&gt;</code> operators.</p>

<p>Here are some more examples:</p>

<p><strong>Example: 1</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">&gt;</span> <span class="mi">200</span> <span class="p">)</span> <span class="o">|</span> 
    <span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.cost_price &gt; :cost_price_1 OR items.quantity &lt; :quantity_1

[(2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3),
 (6, &#39;Monitor&#39;, Decimal(&#39;200.14&#39;), Decimal(&#39;212.89&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Example: 2</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span>    
    <span class="o">~</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">==</span> <span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.quantity != :quantity_1

[(1, &#39;Chair&#39;, Decimal(&#39;9.21&#39;), Decimal(&#39;10.81&#39;), 5),
 (2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3)]
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Example: 3</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span>
    <span class="o">~</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">==</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.quantity != :quantity_1 AND items.cost_price &lt; :cost_price_1

[(1, &#39;Chair&#39;, Decimal(&#39;9.21&#39;), Decimal(&#39;10.81&#39;), 5),
 (2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3)]
</pre></div>
</td></tr></tbody></table></div><span id="conjunctions" class="anchor-target"></span><h3 class="heading">Conjunctions <a class="header-link" href="#conjunctions">#</a></h3>

<p>Another way to connect conditions is to use conjunction functions i.e <code>and_()</code>, <code>or_()</code> and <code>not_()</code>. This is the preferred way of defining conditions in SQLAlchemy. </p>

<p>Here are some examples:</p>

<p><strong>Example 1:</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span>    
    <span class="n">and_</span><span class="p">(</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.quantity &gt;= :quantity_1 AND items.cost_price &lt; :cost_price_1

[(3, &#39;Headphone&#39;, Decimal(&#39;15.52&#39;), Decimal(&#39;16.81&#39;), 50),
 (4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Example 2:</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span>    
    <span class="n">or_</span><span class="p">(</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.quantity &gt;= :quantity_1 OR items.cost_price &lt; :cost_price_1

[(1, &#39;Chair&#39;, Decimal(&#39;9.21&#39;), Decimal(&#39;10.81&#39;), 5),
 (2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3),
 (3, &#39;Headphone&#39;, Decimal(&#39;15.52&#39;), Decimal(&#39;16.81&#39;), 50),
 (4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (6, &#39;Monitor&#39;, Decimal(&#39;200.14&#39;), Decimal(&#39;212.89&#39;), 50),
 (7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Example 3:</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span>\
<span class="n">where</span><span class="p">(</span>    
    <span class="n">and_</span><span class="p">(</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">not_</span><span class="p">(</span>
            <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Headphone&#39;</span>            
        <span class="p">),</span>        
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.quantity &gt;= :quantity_1 AND items.cost_price &lt; :cost_price_1 AND items.name != :name_1

[(4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div><span id="other-common-comparison-operators" class="anchor-target"></span><h2 class="heading">Other Common Comparison Operators <a class="header-link" href="#other-common-comparison-operators">#</a></h2>

<p>The following listing demonstrates how to use some other comparison operators while defining conditions in SQLAlchemy.</p>
<span id="is-null" class="anchor-target"></span><h3 class="heading">IS NULL <a class="header-link" href="#is-null">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">orders</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">date_shipped</span> <span class="o">==</span> <span class="bp">None</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT orders.id, orders.customer_id, orders.date_placed, orders.date_shipped 
FROM orders 
WHERE orders.date_shipped IS NULL

[(1, 1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), None),
 (2, 1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175549), None)]
</pre></div>
</td></tr></tbody></table></div><span id="is-not-null" class="anchor-target"></span><h3 class="heading">IS NOT NULL <a class="header-link" href="#is-not-null">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">orders</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">date_shipped</span> <span class="o">!=</span> <span class="bp">None</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT orders.id, orders.customer_id, orders.date_placed, orders.date_shipped 
FROM orders 
WHERE orders.date_shipped IS NOT NULL

[]
</pre></div>
</td></tr></tbody></table></div><span id="in" class="anchor-target"></span><h3 class="heading">IN <a class="header-link" href="#in">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">customers</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s2">&#34;Sarah&#34;</span><span class="p">,</span> <span class="s2">&#34;John&#34;</span><span class="p">])</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT customers.id, customers.first_name, customers.last_name, customers.username, customers.email, customers.address, customers.town, customers.created_on, customers.updated_on 
FROM customers 
WHERE customers.first_name IN (:first_name_1, :first_name_2)

[(1, &#39;John&#39;, &#39;Green&#39;, &#39;johngreen&#39;, &#39;johngreen@mail.com&#39;, &#39;164 Hidden Valley Road&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 19, 6, 13, 844404), datetime.datetime(2018, 7, 8, 19, 6, 13, 844444)),
 (18, &#39;John&#39;, &#39;Lara&#39;, &#39;johnlara&#39;, &#39;johnlara@mail.com&#39;, &#39;3073 Derek Drive&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559344), datetime.datetime(2018, 7, 8, 22, 20, 11, 559380)),
 (19, &#39;Sarah&#39;, &#39;Tomlin&#39;, &#39;sarahtomlin&#39;, &#39;sarahtomlin@mail.com&#39;, &#39;3572 Poplar Avenue&#39;, &#39;Norfolk&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559397), datetime.datetime(2018, 7, 8, 22, 20, 11, 559411))
</pre></div>
</td></tr></tbody></table></div><span id="not-in" class="anchor-target"></span><h3 class="heading">NOT IN <a class="header-link" href="#not-in">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">customers</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span><span class="o">.</span><span class="n">notin_</span><span class="p">([</span><span class="s2">&#34;Sarah&#34;</span><span class="p">,</span> <span class="s2">&#34;John&#34;</span><span class="p">])</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT customers.id, customers.first_name, customers.last_name, customers.username, customers.email, customers.address, customers.town, customers.created_on, customers.updated_on 
FROM customers 
WHERE customers.first_name NOT IN (:first_name_1, :first_name_2)

[(2, &#39;Katherine&#39;, &#39;Wilson&#39;, &#39;katwilson&#39;, &#39;katwilson@gmail.com&#39;, &#39;4685 West Side Avenue&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 20, 37, 57, 407023), datetime.datetime(2018, 7, 8, 20, 37, 57, 407053)),
 (17, &#39;Tim&#39;, &#39;Snyder&#39;, &#39;timsnyder&#39;, &#39;timsnyder@mail.com&#39;, &#39;1611 Sundown Lane&#39;, &#39;Langdale&#39;, datetime.datetime(2018, 7, 8, 22, 19, 55, 721864), datetime.datetime(2018, 7, 8, 22, 19, 55, 721895)),
 (20, &#39;Pablo&#39;, &#39;Gibson&#39;, &#39;pablogibson&#39;, &#39;pablogibson@mail.com&#39;, &#39;3494 Murry Street&#39;, &#39;Peterbrugh&#39;, datetime.datetime(2018, 7, 8, 22, 20, 11, 559424), datetime.datetime(2018, 7, 8, 22, 20, 11, 559437)),
</pre></div>
</td></tr></tbody></table></div><span id="between" class="anchor-target"></span><h3 class="heading">BETWEEN <a class="header-link" href="#between">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.cost_price BETWEEN :cost_price_1 AND :cost_price_2

[(3, &#39;Headphone&#39;, Decimal(&#39;15.52&#39;), Decimal(&#39;16.81&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div><span id="not-between" class="anchor-target"></span><h3 class="heading">NOT BETWEEN <a class="header-link" href="#not-between">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">not_</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.cost_price NOT BETWEEN :cost_price_1 AND :cost_price_2

[(1, &#39;Chair&#39;, Decimal(&#39;9.21&#39;), Decimal(&#39;10.81&#39;), 5),
 (2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3),
 (4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (6, &#39;Monitor&#39;, Decimal(&#39;200.14&#39;), Decimal(&#39;212.89&#39;), 50),
 (7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div><span id="like" class="anchor-target"></span><h3 class="heading">LIKE <a class="header-link" href="#like">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;Wa%&#34;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.name LIKE :name_1

[(7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div>
<p>The <code>like()</code> method performs a case-sensitive match. For case-insensitive match use <code>ilike()</code>.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;wa%&#34;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE lower(items.name) LIKE lower(:name_1)

[(7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div><span id="not-like" class="anchor-target"></span><h3 class="heading">NOT LIKE <a class="header-link" href="#not-like">#</a></h3>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">not_</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;wa%&#34;</span><span class="p">))</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.name NOT LIKE :name_1

[(1, &#39;Chair&#39;, Decimal(&#39;9.21&#39;), Decimal(&#39;10.81&#39;), 5),
 (2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3),
 (3, &#39;Headphone&#39;, Decimal(&#39;15.52&#39;), Decimal(&#39;16.81&#39;), 50),
 (4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (6, &#39;Monitor&#39;, Decimal(&#39;200.14&#39;), Decimal(&#39;212.89&#39;), 50),
 (7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div><span id="ordering-result" class="anchor-target"></span><h2 class="heading">Ordering Result <a class="header-link" href="#ordering-result">#</a></h2>

<p>The <code>order_by()</code> method adds <code>ORDER BY</code> clause to the <code>SELECT</code> statement. It accepts one or more columns to sort by. For each column listed in the <code>order_by()</code> clause, you can specify whether the rows are sorted in ascending order (using <code>asc()</code>) or descending order (using <code>desc()</code>). If neither specified rows are sorted in ascending order. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">10</span>
<span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.quantity &gt; :quantity_1 ORDER BY items.cost_price

[(3, &#39;Headphone&#39;, Decimal(&#39;15.52&#39;), Decimal(&#39;16.81&#39;), 50),
 (4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50),
 (7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (6, &#39;Monitor&#39;, Decimal(&#39;200.14&#39;), Decimal(&#39;212.89&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div>
<p>This query returns the rows sorted by <code>cost_price</code> in ascending order. It is equivalent to:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">asc</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">10</span>
<span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">asc</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>To sort the result in descending order use <code>desc()</code> function. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">desc</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">10</span>
<span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.quantity &gt; :quantity_1 ORDER BY items.cost_price DESC

[(6, &#39;Monitor&#39;, Decimal(&#39;200.14&#39;), Decimal(&#39;212.89&#39;), 50),
 (7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (3, &#39;Headphone&#39;, Decimal(&#39;15.52&#39;), Decimal(&#39;16.81&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div>
<p>Here is another example which sorts the rows according to two columns, first by <code>quantity</code> (in ascending order) and then by <code>cost_price</code> (in descending order).</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span> 
    <span class="n">desc</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost_price</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items ORDER BY items.quantity, items.cost_price DESC

[(2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3),
 (1, &#39;Chair&#39;, Decimal(&#39;9.21&#39;), Decimal(&#39;10.81&#39;), 5),
 (6, &#39;Monitor&#39;, Decimal(&#39;200.14&#39;), Decimal(&#39;212.89&#39;), 50),
 (7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50),
 (8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;25.00&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50),
 (4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (3, &#39;Headphone&#39;, Decimal(&#39;15.52&#39;), Decimal(&#39;16.81&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div><span id="limiting-results" class="anchor-target"></span><h2 class="heading">Limiting Results <a class="header-link" href="#limiting-results">#</a></h2>

<p>The <code>limit()</code> method adds the <code>LIMIT</code> clause to the <code>SELECT</code> statement. It accepts an integer which indicates the number of rows to return. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span>
<span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items ORDER BY items.quantity
 LIMIT :param_1

[(2, &#39;Pen&#39;, Decimal(&#39;3.45&#39;), Decimal(&#39;4.51&#39;), 3),
 (1, &#39;Chair&#39;, Decimal(&#39;9.21&#39;), Decimal(&#39;10.81&#39;), 5)]
</pre></div>
</td></tr></tbody></table></div>
<p>To specify an offset (i.e. the starting position) to the <code>LIMIT</code> clause use the <code>offset()</code> method.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span>
<span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items ORDER BY items.quantity
 LIMIT :param_1 OFFSET :param_2

[(4, &#39;Travel Bag&#39;, Decimal(&#39;20.10&#39;), Decimal(&#39;24.21&#39;), 50),
 (5, &#39;Keyboard&#39;, Decimal(&#39;20.12&#39;), Decimal(&#39;22.11&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div><span id="limiting-columns" class="anchor-target"></span><h2 class="heading">Limiting Columns <a class="header-link" href="#limiting-columns">#</a></h2>

<p>The <code>SELECT</code> statements we have created so far has returned data from all the columns of the table. We can limit the number of fields returned by the query by passing the name of the fields as a list to the <code>select()</code> function. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">==</span>  <span class="mi">50</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="nb">str</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.name, items.quantity 
FROM items 
WHERE items.quantity = :quantity_1

[&#39;name&#39;, &#39;quantity&#39;]

[(&#39;Headphone&#39;, 50),
 (&#39;Travel Bag&#39;, 50),
 (&#39;Keyboard&#39;, 50),
 (&#39;Monitor&#39;, 50),
 (&#39;Watch&#39;, 50),
 (&#39;Water Bottle&#39;, 50)]
</pre></div>
</td></tr></tbody></table></div>
<p>This query returns the data only from the <code>name</code> and <code>quantity</code> columns from the <code>items</code> table.</p>

<p>Just as in SQL, we can perform simple calculations on the rows retrieved before sending them to the output. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span> 
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">selling_price</span> <span class="o">*</span> <span class="mi">5</span> 
    <span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">==</span>  <span class="mi">50</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.name, items.quantity, items.selling_price * :selling_price_1 AS anon_1 
FROM items 
WHERE items.quantity = :quantity_1

[&#39;name&#39;, &#39;quantity&#39;, &#39;anon_1&#39;]

[(&#39;Headphone&#39;, 50, Decimal(&#39;84.05&#39;)),
 (&#39;Travel Bag&#39;, 50, Decimal(&#39;121.05&#39;)),
 (&#39;Keyboard&#39;, 50, Decimal(&#39;110.55&#39;)),
 (&#39;Monitor&#39;, 50, Decimal(&#39;1064.45&#39;)),
 (&#39;Watch&#39;, 50, Decimal(&#39;522.05&#39;)),
 (&#39;Water Bottle&#39;, 50, Decimal(&#39;125.00&#39;))]
</pre></div>
</td></tr></tbody></table></div>
<p>Notice that the <code>items.c.selling_price * 5</code> is not an actual column, therefore, an anonymous name called <code>anon_1</code> is generated to display the query result (line 5).</p>

<p>We can assign a label to a column or expression using the <code>label()</code> method, which works by adding an <code>AS</code> subclause to the <code>SELECT</code> statement.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
        <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span> 
        <span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">selling_price</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> 
    <span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">==</span>  <span class="mi">50</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.name, items.quantity, items.selling_price * :selling_price_1 AS price 
FROM items 
WHERE items.quantity = :quantity_1

[&#39;name&#39;, &#39;quantity&#39;, &#39;price&#39;]

[(&#39;Headphone&#39;, 50, Decimal(&#39;84.05&#39;)),
 (&#39;Travel Bag&#39;, 50, Decimal(&#39;121.05&#39;)),
 (&#39;Keyboard&#39;, 50, Decimal(&#39;110.55&#39;)),
 (&#39;Monitor&#39;, 50, Decimal(&#39;1064.45&#39;)),
 (&#39;Watch&#39;, 50, Decimal(&#39;522.05&#39;)),
 (&#39;Water Bottle&#39;, 50, Decimal(&#39;125.00&#39;))]
</pre></div>
</td></tr></tbody></table></div><span id="accessing-built-in-functions" class="anchor-target"></span><h2 class="heading">Accessing Built-in Functions <a class="header-link" href="#accessing-built-in-functions">#</a></h2>

<p>To access the built-in functions provided by the database we use <code>func</code> object. The following listing shows how to use date/time, mathematical and string functions found in PostgreSQL database.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">c</span> <span class="o">=</span> <span class="p">[</span>
    
    <span class="c1">##  date/time functions  ##</span>
    
    <span class="n">func</span><span class="o">.</span><span class="n">timeofday</span><span class="p">(),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">localtime</span><span class="p">(),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">(),</span>    
    <span class="n">func</span><span class="o">.</span><span class="n">date_part</span><span class="p">(</span><span class="s2">&#34;month&#34;</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span>        
    <span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    
    <span class="c1">##  mathematical functions  ##</span>
    
    <span class="n">func</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">441</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">pi</span><span class="p">(),</span>        
    <span class="n">func</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">pi</span><span class="p">()),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">pi</span><span class="p">()),</span>
    
    <span class="c1">##  string functions  ##</span>
    
    <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="s2">&#34;ABC&#34;</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="s2">&#34;abc&#34;</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="s2">&#34;abc&#34;</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="s2">&#34;  ab c  &#34;</span><span class="p">),</span>    
    <span class="n">func</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="mi">65</span><span class="p">),</span>        
<span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&#39;timeofday_1&#39;,
 &#39;localtime_1&#39;,
 &#39;current_timestamp_1&#39;,
 &#39;date_part_1&#39;,
 &#39;now_1&#39;,
 &#39;pow_1&#39;,
 &#39;sqrt_1&#39;,
 &#39;pi_1&#39;,
 &#39;floor_1&#39;,
 &#39;ceil_1&#39;,
 &#39;lower_1&#39;,
 &#39;upper_1&#39;,
 &#39;length_1&#39;,
 &#39;trim_1&#39;,
 &#39;chr_1&#39;]

[(&#39;Mon Jul 09 00:03:29.638802 2018 IST&#39;, datetime.time(23, 6, 54, 773833), datetime.datetime(2018, 7, 8, 23, 6, 54, 773833, tzinfo=psycopg2.tz.FixedOffsetTimezone(offset=330, name=None)), 7.0, datetime.datetime(2018, 7, 8, 23, 6, 54, 773833, tzinfo=psycopg2.tz.FixedOffsetTimezone(offset=330, name=None)), 16.0, 21.0, 3.14159265358979, 3.0, 4.0, &#39;abc&#39;, &#39;ABC&#39;, 3, &#39;ab c&#39;, &#39;A&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>You also have access to aggregate functions via the <code>func</code> object.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">c</span> <span class="o">=</span> <span class="p">[</span> 
    <span class="n">func</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">),</span>    
    <span class="n">func</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>    
<span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT sum(items.quantity) AS sum_1, avg(items.quantity) AS avg_1, max(items.quantity) AS max_1, min(items.quantity) AS min_1, count(customers.id) AS count_1 
FROM items, customers

[&#39;sum_1&#39;, &#39;avg_1&#39;, &#39;max_1&#39;, &#39;min_1&#39;, &#39;count_1&#39;]

[(1848, Decimal(&#39;38.5000000000000000&#39;), 50, 3, 48)]
</pre></div>
</td></tr></tbody></table></div><span id="grouping-results" class="anchor-target"></span><h2 class="heading">Grouping Results <a class="header-link" href="#grouping-results">#</a></h2>

<p>Grouping results is done via <code>GROUP BY</code> clause. It is commonly used in conjunction with the aggregate functions. We add <code>GROUP BY</code> clause to the <code>select</code> statement using <code>group_by()</code> method. It accepts one or more columns and groups the rows according to the values in the column. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">c</span> <span class="o">=</span> <span class="p">[</span> 
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">),</span>         
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span>      
<span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT count(:count_1) AS count, customers.town 
FROM customers GROUP BY customers.town

[(1, &#39;Langdale&#39;), (2, &#39;Peterbrugh&#39;), (3, &#39;Norfolk&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>This query returns the number of customers lives in each town.</p>

<p>To filter out the results based on the values returned by aggregate functions we use <code>having()</code> method which adds the <code>HAVING</code> clause to the <code>SELECT</code> statement. Just like the <code>where()</code> clause, it accepts a condition.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">c</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">),</span>
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span>      
<span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span><span class="p">)</span><span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT count(:count_1) AS count, customers.town 
FROM customers GROUP BY customers.town 
HAVING count(:count_2) &gt; :count_3

[&#39;count&#39;, &#39;town&#39;]

[(3, &#39;Norfolk&#39;)]
</pre></div>
</td></tr></tbody></table></div><span id="joins" class="anchor-target"></span><h2 class="heading">Joins <a class="header-link" href="#joins">#</a></h2>

<p>The <code>Table</code> instance provides the following two methods to create joins:</p>

<ol>
<li><code>join()</code> - creates inner join</li>
<li><code>outerjoin()</code> - creates outer join (<code>LEFT OUTER JOIN</code> to be specific)</li>
</ol>

<p>The inner join returns only the rows which matches the join condition, whereas the outer join returns the rows which matches the join condition as well as some additional rows.</p>

<p>Both methods accept a <code>Table</code> instance, figures out the join condition based on the foreign key relationship and returns a <code>JOIN</code> construct. </p>
<div class="codeblock language-pycon"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orders</span><span class="p">))</span>
<span class="go">customers JOIN orders ON customers.id = orders.customer_id</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</td></tr></tbody></table></div>
<p>If the methods can&#39;t figure out the join condition correctly or you want to specify an alternate condition, you can do so by passing the join condition manually as a second argument.</p>
<div class="codeblock language-pycon"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">,</span>
<span class="gp">... </span>                <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">customers JOIN items ON customers.address LIKE customers.first_name || :first_name_1</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</td></tr></tbody></table></div>
<p>When we specify tables or list of columns in the <code>select()</code> function, SQLAlchemy automatically places those tables in the <code>FROM</code> clause. However, when we use join, we know exactly the tables we want in the <code>FROM</code> clause, so we use the <code>select_from()</code> method. However, if we want we can use <code>select_from()</code> in queries not involving joins too. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>        
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span>
<span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
    <span class="n">customers</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT customers.id, customers.first_name 
FROM customers

[&#39;id&#39;, &#39;first_name&#39;]

[(1, &#39;John&#39;),
 (2, &#39;Katherine&#39;),
 (17, &#39;Tim&#39;),
 (18, &#39;John&#39;),
 (19, &#39;Sarah&#39;),
 (20, &#39;Pablo&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>Let&#39;s use this knowledge to find all the orders placed by customer name <code>John Green</code>.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
            <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">date_placed</span>
<span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">and_</span><span class="p">(</span>
        <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s2">&#34;John&#34;</span><span class="p">,</span>
        <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s2">&#34;Green&#34;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT orders.id, orders.date_placed 
FROM orders JOIN customers ON customers.id = orders.customer_id 
WHERE customers.first_name = :first_name_1 AND customers.last_name = :last_name_1

[&#39;id&#39;, &#39;date_placed&#39;]

[(1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526)),
 (2, datetime.datetime(2018, 7, 8, 22, 36, 20, 175549))]
</pre></div>
</td></tr></tbody></table></div>
<p>The preceding query only returns the order <code>id</code> and <code>date_placed</code>. Wouldn&#39;t it be better to know the items and quantity of items in each order?</p>

<p>To get the items and quantity of items in each order we have to create a total of 3 joins, spanning all the way to the <code>items</code> table.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>        
    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;order_id&#39;</span><span class="p">),</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">date_placed</span><span class="p">,</span>
    <span class="n">order_lines</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            
<span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">order_lines</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">and_</span><span class="p">(</span>
        <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s2">&#34;John&#34;</span><span class="p">,</span>
        <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s2">&#34;Green&#34;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    orders.id AS order_id,
    orders.date_placed,
    order_lines.quantity,
    items.name
FROM
    orders
JOIN customers ON customers.id = orders.customer_id
JOIN order_lines ON orders.id = order_lines.order_id
JOIN items ON items.id = order_lines.item_id
WHERE
    customers.first_name = : first_name_1
AND customers.last_name = : last_name_1

[&#39;order_id&#39;, &#39;date_placed&#39;, &#39;quantity&#39;, &#39;name&#39;]

[(1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), 5, &#39;Chair&#39;),
 (1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), 2, &#39;Pen&#39;),
 (1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), 1, &#39;Headphone&#39;),
 (2, datetime.datetime(2018, 7, 8, 22, 36, 20, 175549), 5, &#39;Chair&#39;),
 (2, datetime.datetime(2018, 7, 8, 22, 36, 20, 175549), 5, &#39;Pen&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>Finally, here is an example of how to define an outer join.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>        
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
    <span class="n">customers</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers.first_name,
    orders.id
FROM
    customers
LEFT OUTER JOIN orders ON customers.id = orders.customer_id

[&#39;first_name&#39;, &#39;id&#39;]

[(&#39;John&#39;, 1),
 (&#39;John&#39;, 2),
 (&#39;Pablo&#39;, None),
 (&#39;Tim&#39;, None),
 (&#39;John&#39;, None),
 (&#39;Katherine&#39;, None),
 (&#39;Sarah&#39;, None)]
</pre></div>
</td></tr></tbody></table></div>
<p>The <code>Table</code> instance we pass to the <code>outerjoin()</code> method is placed on the right side of the outer join. As a result, the above query will return all the rows from <code>customers</code> table (the left table), and only the rows that meets the join condition are returned from the <code>orders</code> table (the right table).</p>

<p>If you want all the rows from the <code>order</code> table but only the rows that meets the join condition from the <code>orders</code> table, call <code>outerjoin()</code> as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>        
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers.first_name,
    orders.id
FROM
    orders
LEFT OUTER JOIN customers ON customers.id = orders.customer_id

[&#39;first_name&#39;, &#39;id&#39;]

[(&#39;John&#39;, 1), (&#39;John&#39;, 2)]
</pre></div>
</td></tr></tbody></table></div>
<p>You can also create a <code>FULL OUTER JOIN</code> by passing <code>full=True</code> to <code>outerjoin()</code> method. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>        
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
    <span class="n">orders</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">customers</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers.first_name,
    orders.id
FROM
    orders
FULL OUTER JOIN customers ON customers.id = orders.customer_id

[&#39;first_name&#39;, &#39;id&#39;]

[(&#39;John&#39;, 1),
 (&#39;John&#39;, 2),
 (&#39;Pablo&#39;, None),
 (&#39;Tim&#39;, None),
 (&#39;John&#39;, None),
 (&#39;Katherine&#39;, None),
 (&#39;Sarah&#39;, None)]
</pre></div>
</td></tr></tbody></table></div><span id="updating-records" class="anchor-target"></span><h2 class="heading">Updating Records <a class="header-link" href="#updating-records">#</a></h2>

<p>Updating records is achieved using the <code>update()</code> function. For example, the following query updates the <code>selling_price</code> and <code>quantity</code> of <code>Water Bottle</code> to <code>30</code> and <code>60</code>, respectively.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">update</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Water Bottle&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
    <span class="n">selling_price</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">rowcount</span>  <span class="c1"># count of rows updated</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>UPDATE items
SET selling_price =: selling_price,
 quantity =: quantity
WHERE
    items. NAME = : name_1

1
</pre></div>
</td></tr></tbody></table></div><span id="deleting-records" class="anchor-target"></span><h2 class="heading">Deleting Records <a class="header-link" href="#deleting-records">#</a></h2>

<p>To delete records we use the <code>delete()</code> function.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">delete</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">&#39;pablo%&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">rowcount</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>DELETE
FROM
    customers
WHERE
    customers.username LIKE : username_1

1
</pre></div>
</td></tr></tbody></table></div>
<p>This query will delete all the customers whose username starts with <code>pablo</code>.</p>
<span id="dealing-with-duplicates" class="anchor-target"></span><h2 class="heading">Dealing with Duplicates <a class="header-link" href="#dealing-with-duplicates">#</a></h2>

<p>To deal with the duplicate rows in the result set we use the <code>DISTINCT</code> option. We can add <code>DISTINCT</code> option to the <code>SELECT</code> statement using the <code>distinct()</code> method. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># without DISTINCT</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span>  <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>


<span class="c1"># with DISTINCT</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span>  <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT customers.town 
FROM customers 
WHERE customers.id &lt; :id_1

[(&#39;Norfolk&#39;,), (&#39;Peterbrugh&#39;,), (&#39;Langdale&#39;,), (&#39;Norfolk&#39;,), (&#39;Norfolk&#39;,)]

SELECT DISTINCT customers.town 
FROM customers 
WHERE customers.id &lt; :id_1

[(&#39;Peterbrugh&#39;,), (&#39;Langdale&#39;,), (&#39;Norfolk&#39;,)]
</pre></div>
</td></tr></tbody></table></div>
<p>Here is another example which uses <code>distinct()</code> option with the <code>count()</code> aggregate function and counts the distinct number of towns in the <code>customers</code> table. </p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>        
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span><span class="p">)),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">town</span><span class="p">)</span>
<span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    COUNT (DISTINCT customers.town) AS count_1,
    COUNT (customers.town) AS count_2
FROM
    customers

[&#39;count_1&#39;, &#39;count_2&#39;]

[(3, 5)]
</pre></div>
</td></tr></tbody></table></div><span id="casting" class="anchor-target"></span><h2 class="heading">Casting <a class="header-link" href="#casting">#</a></h2>

<p>Casting (converting) data from one type to another is a common operation and is done via <code>cast()</code> function from the <code>sqlalchemy</code> package.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Date</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span>
    <span class="n">cast</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">pi</span><span class="p">(),</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">cast</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">pi</span><span class="p">(),</span> <span class="n">Numeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span>
    <span class="n">cast</span><span class="p">(</span><span class="s2">&#34;2010-12-01&#34;</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">),</span>
    <span class="n">cast</span><span class="p">(</span><span class="s2">&#34;2010-12-01&#34;</span><span class="p">,</span> <span class="n">Date</span><span class="p">),</span>
<span class="p">])</span>    

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    CAST (pi() AS INTEGER) AS anon_1,
    CAST (pi() AS NUMERIC(10, 2)) AS anon_2,
    CAST (:param_1 AS DATETIME) AS anon_3,
    CAST (:param_2 AS DATE) AS anon_4

[&#39;anon_1&#39;, &#39;anon_2&#39;, &#39;anon_3&#39;, &#39;anon_4&#39;]

[(3, Decimal(&#39;3.14&#39;), datetime.datetime(2010, 12, 1, 0, 0), datetime.date(2010, 12, 1))]
</pre></div>
</td></tr></tbody></table></div><span id="unions" class="anchor-target"></span><h2 class="heading">Unions <a class="header-link" href="#unions">#</a></h2>

<p>The SQL&#39;s <code>UNION</code> operator allows us to combine result set of multiple <code>SELECT</code> statements. To add <code>UNION</code> operator to our <code>SELECT</code> statement we use <code>union()</code> function.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">union</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;Wa%&#34;</span><span class="p">)),</span>
    <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%e</span><span class="s2">%&#34;</span><span class="p">)),</span>
<span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name 
FROM items 
WHERE items.name LIKE :name_1 UNION SELECT items.id, items.name 
FROM items 
WHERE items.name LIKE :name_2 ORDER BY id DESC

[&#39;id&#39;, &#39;name&#39;]

[(8, &#39;Water Bottle&#39;),
 (7, &#39;Watch&#39;),
 (5, &#39;Keyboard&#39;),
 (4, &#39;Travel Bag&#39;),
 (3, &#39;Headphone&#39;),
 (2, &#39;Pen&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>By default, <code>union()</code> removes all the duplicate rows from the result set. If you want to keep the duplicates use <code>union_all()</code>.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">union_all</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">union_all</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;Wa%&#34;</span><span class="p">)),</span>
    <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%e</span><span class="s2">%&#34;</span><span class="p">)),</span>
<span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">))</span>


<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name 
FROM items 
WHERE items.name LIKE :name_1 UNION ALL SELECT items.id, items.name 
FROM items 
WHERE items.name LIKE :name_2 ORDER BY id DESC

[&#39;id&#39;, &#39;name&#39;]

[(8, &#39;Water Bottle&#39;),
 (8, &#39;Water Bottle&#39;),
 (7, &#39;Watch&#39;),
 (5, &#39;Keyboard&#39;),
 (4, &#39;Travel Bag&#39;),
 (3, &#39;Headphone&#39;),
 (2, &#39;Pen&#39;)]
</pre></div>
</td></tr></tbody></table></div><span id="creating-subqueries" class="anchor-target"></span><h2 class="heading">Creating Subqueries <a class="header-link" href="#creating-subqueries">#</a></h2>

<p>We can also access data from multiple tables using subqueries.</p>

<p>The following query returns the id and name of the items ordered by <code>John Green</code> in his first order:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span> 
        <span class="n">select</span><span class="p">([</span><span class="n">order_lines</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">item_id</span><span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">order_lines</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>    
                <span class="n">and_</span><span class="p">(</span>
                    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
                    <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s1">&#39;Green&#39;</span><span class="p">,</span>
                    <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="p">)</span>    
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    items.ID,
    items. NAME
FROM
    items
WHERE
    items.ID IN (
        SELECT
            order_lines.item_id
        FROM
            customers
        JOIN orders ON customers.ID = orders.customer_id
        JOIN order_lines ON orders.ID = order_lines.order_id
        WHERE
            customers.first_name = : first_name_1
        AND customers.last_name = : last_name_1
        AND orders.ID = : id_1
    )

[&#39;id&#39;, &#39;name&#39;]

[(3, &#39;Headphone&#39;), (1, &#39;Chair&#39;), (2, &#39;Pen&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>This query can also be written using JOINs as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">order_lines</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>    
        <span class="n">and_</span><span class="p">(</span>
            <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
            <span class="n">customers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s1">&#39;Green&#39;</span><span class="p">,</span>
            <span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">)</span>    
<span class="p">)</span>

<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&#39;id&#39;, &#39;name&#39;]

[(1, &#39;Chair&#39;), (2, &#39;Pen&#39;), (3, &#39;Headphone&#39;)]
</pre></div>
</td></tr></tbody></table></div><span id="raw-queries" class="anchor-target"></span><h2 class="heading">Raw Queries <a class="header-link" href="#raw-queries">#</a></h2>

<p>SQLAlchemy also gives you the flexibility to execute raw SQL using the <code>text()</code> function. For example, the following <code>SELECT</code> statement returns all the orders, along with the items ordered by <code>John Green</code>.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">text</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span>
<span class="sd">&#34;&#34;&#34;</span>
<span class="sd">SELECT</span>
<span class="sd">    orders.id as &#34;Order ID&#34;, orders.date_placed, items.id, items.name</span>
<span class="sd">FROM</span>
<span class="sd">    customers</span>
<span class="sd">INNER JOIN orders ON customers.id = orders.customer_id</span>
<span class="sd">INNER JOIN order_lines ON order_lines.order_id = orders.id</span>
<span class="sd">INNER JOIN items ON items.id= order_lines.item_id</span>
<span class="sd">where customers.first_name = :first_name and customers.last_name = :last_name</span>
<span class="sd">&#34;&#34;&#34;</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">first_name</span><span class="o">=</span><span class="s2">&#34;John&#34;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Green&#39;</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    orders.id as &#34;Order ID&#34;, orders.date_placed, items.id, items.name
FROM
    customers
INNER JOIN orders ON customers.id = orders.customer_id
INNER JOIN order_lines ON order_lines.order_id = orders.id
INNER JOIN items ON items.id= order_lines.item_id
where customers.first_name = :first_name and customers.last_name = :last_name


[(1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), 1, &#39;Chair&#39;),
 (1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), 2, &#39;Pen&#39;),
 (1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), 3, &#39;Headphone&#39;),
 (2, datetime.datetime(2018, 7, 8, 22, 36, 20, 175549), 1, &#39;Chair&#39;),
 (2, datetime.datetime(2018, 7, 8, 22, 36, 20, 175549), 2, &#39;Pen&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>Notice that the <code>SELECT</code> statement contains two bind parameters: <code>first_name</code> and <code>last_name</code>. The values to these parameters is passed via the <code>execute()</code> method.</p>

<p>The <code>text()</code> function can also be embedded inside a <code>select()</code> construct. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">items</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">text</span><span class="p">(</span><span class="s2">&#34;items.name like &#39;Wa%&#39;&#34;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&#34;items.id desc&#34;</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT items.id, items.name, items.cost_price, items.selling_price, items.quantity 
FROM items 
WHERE items.name like &#39;Wa%&#39; ORDER BY items.id desc

[(8, &#39;Water Bottle&#39;, Decimal(&#39;20.89&#39;), Decimal(&#39;30.00&#39;), 60),
 (7, &#39;Watch&#39;, Decimal(&#39;100.58&#39;), Decimal(&#39;104.41&#39;), 50)]
</pre></div>
</td></tr></tbody></table></div>
<p>Another way to execute raw SQL is to pass it directly to the <code>execute()</code> method. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;select * from  orders;&#34;</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(1, 1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175526), None),
 (2, 1, datetime.datetime(2018, 7, 8, 22, 36, 20, 175549), None)]
</pre></div>
</td></tr></tbody></table></div><span id="transactions" class="anchor-target"></span><h2 class="heading">Transactions <a class="header-link" href="#transactions">#</a></h2>

<p>A transaction is a way to execute a set of SQL statements such that either all of the statements are executed successfully or nothing at all. If any of the statement involved in the transaction fails then the database is returned to the state it was in before the transaction was initiated.</p>

<p>We currently have two orders in the database. To fulfill an order we need to perform following two actions:</p>

<ol>
<li>Subtract the quantity of ordered items from the <code>items</code> table</li>
<li>Update the <code>date_shipped</code> column to contain the datetime value.</li>
</ol>

<p>Both of these action must be performed as a unit to ensure that the data in the tables are correct.</p>

<p>The <code>Connection</code> object provides a <code>begin()</code> method, which starts the transaction and returns an object of type <code>Transaction</code>. The <code>Transaction</code> object in turn provides <code>rollback()</code> and <code>commit()</code> method, to rollback and commit the transaction, respectively.</p>

<p>In the following listing we define <code>dispatch_order()</code> method which accepts <code>order_id</code>  as argument, and performs the above mentioned actions using transaction.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">IntegrityError</span>


<span class="k">def</span> <span class="nf">dispatch_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">):</span>

    <span class="c1"># check whether order_id is valid or not</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">)])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">order_id</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">scalar</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;Invalid order id: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">order_id</span><span class="p">))</span>

    <span class="c1"># fetch items in the order</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">order_lines</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">item_id</span><span class="p">,</span> <span class="n">order_lines</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">order_lines</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">order_id</span> <span class="o">==</span> <span class="n">order_id</span>
    <span class="p">)</span>

    <span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">ordered_items_list</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="c1"># start transaction</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ordered_items_list</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">item_id</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">quantity</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">quantity</span><span class="p">)</span>

            <span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">order_id</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">date_shipped</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Transaction completed.&#34;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Transaction failed.&#34;</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Our first order is for 5 chairs, 2 pens and 1 headphone. Calling <code>dispatch_order()</code> function with order id of <code>1</code>, will return the following output:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">dispatch_order</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>Transaction completed.
</pre></div>
</div>
<p>At this point, <code>items</code> and <code>order_lines</code> tables should look like this:</p>

<p><img src="../../media/uploads/2018/7/9/Selection_237-dc037f22-9800-42eb-843d-3daf93b37253.png" loading="lazy" alt=""/></p>

<p><img src="../../media/uploads/2018/7/9/Selection_239-8c014ba5-dfa3-4cf0-a401-a5147e9e8ef4.png" loading="lazy" alt=""/></p>

<p>Our next order is for 5 chairs and 4 pens, but we now only have 5 chairs and 1 pen in the stock!</p>

<p>Let&#39;s try running <code>dispatch_order()</code> for second order and see what happens.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">dispatch_order</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Expected Ouput:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>(psycopg2.IntegrityError) new row for relation &#34;items&#34; violates check constraint &#34;quantity_check&#34;
DETAIL:  Failing row contains (1, Chair, 9.21, 10.81, -4).
 [SQL: &#39;UPDATE items SET quantity=(items.quantity - %(quantity_1)s) WHERE items.id = %(id_1)s&#39;] [parameters: {&#39;quantity_1&#39;: 5, &#39;id_1&#39;: 1}] (Background on this error at: http://sqlalche.me/e/gkpj)
Transaction failed.
</pre></div>
</td></tr></tbody></table></div>
<p>As expected, our shipment failed because we don&#39;t have enough pens in the stock and because we are using transaction our database is returned to the state it was in before the transaction was started.</p>



    



        <nav aria-label="pagination">
            <ul class="pager">
                
                    <li class="previous">
                        <a href="../defining-schema-in-sqlalchemy-core/index.html" title="Defining Schema in SQLAlchemy Core">
                            <span class="fa fa-arrow-left" aria-hidden="true"></span>
                            Defining Schema in SQLAlchemy Core
                        </a>
                    </li>
                

                
                    <li class="next">
                        <a href="../defining-schema-in-sqlalchemy-orm/index.html" title="Defining Schema in SQLAlchemy ORM">
                            Defining Schema in SQLAlchemy ORM
                            <span class="fa fa-arrow-right" aria-hidden="true"></span>
                        </a>
                    </li>
                
            </ul>
        </nav>







    <hr/>
    <div id="disqus_thread">
    <p style="margin-bottom: 10px" class="text-center">
        <a href="#" class=" btn btn-primary comments-holder" onclick="loadDisqus();return false;">
            <i class="fa fa-comments" aria-hidden="true"></i> Load Comments
        </a>
    </p>
    </div>
    <hr/>
    <script>
        var is_disqus_loaded = false;
        function loadDisqus() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '../../../overiqcom.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        };
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>







            </div>
        </div>


        <div class="sidebar">
        
            <div class="col-lg-4 col-md-4 col-sm-12">
                

    
        
    <div class="well">
        <h4>SQLAlchemy Tutorial</h4>
        <ul>
            
                <li><a href="../intro-to-sqlalchemy/index.html">Intro to SqlAlchemy</a></li>
            
                <li><a href="../installing-sqlalchemy-and-connecting-to-database/index.html">Installing SQLAlchemy and connecting to database</a></li>
            
                <li><a href="../defining-schema-in-sqlalchemy-core/index.html">Defining Schema in SQLAlchemy Core</a></li>
            
                <li><a href="index.html">CRUD using SQLAlchemy Core</a></li>
            
                <li><a href="../defining-schema-in-sqlalchemy-orm/index.html">Defining Schema in SQLAlchemy ORM</a></li>
            
                <li><a href="../crud-using-sqlalchemy-orm/index.html">CRUD using SQLAlchemy ORM</a></li>
            
        </ul>
    </div>

    

    
        

<div class="well">
    <h4>Recent Posts</h4>
    <ul>
        
            <li><a href="../../machine-learning-experts-you-should-be-following-online/index.html">Machine Learning Experts You Should Be Following Online</a></li>
        
            <li><a href="../../4-ways-to-prepare-for-the-ap-computer-science-a-exam/index.html">4 Ways to Prepare for the AP Computer Science A Exam</a></li>
        
            <li><a href="../../finance-assignment-online-help-for-the-busy-and-tired-students-get-help-from-experts/index.html">Finance Assignment Online Help for the Busy and Tired Students: Get Help from Experts</a></li>
        
            <li><a href="../../top-9-machine-learning-algorithms-for-data-scientists/index.html">Top 9 Machine Learning Algorithms for Data Scientists</a></li>
        
            <li><a href="../../data-science-learning-path-or-steps-to-become-a-data-scientist-final/index.html">Data Science Learning Path or Steps to become a data scientist Final</a></li>
        
            <li><a href="../../enable-edit-button-in-shutter-in-linux-mint-19-and-ubuntu-18-04/index.html">Enable Edit Button in Shutter In Linux Mint 19 and Ubuntu 18.04</a></li>
        
            <li><a href="../../python-3-time-module/index.html">Python 3 time module</a></li>
        
            <li><a href="../../pygments-tutorial/index.html">Pygments Tutorial</a></li>
        
            <li><a href="../../how-to-use-virtualenv/index.html">How to use Virtualenv?</a></li>
        
            <li><a href="../../installing-mysql-windows-linux-and-mac/index.html">Installing MySQL (Windows, Linux and Mac)</a></li>
        
            <li><a href="../../what-is-if-__name__-__main__-in-python/index.html">What is if __name__ == &#39;__main__&#39;  in Python ?</a></li>
        
            <li><a href="../../installing-goaccess-a-real-time-web-log-analyzer/index.html">Installing GoAccess (A Real-time web log analyzer)</a></li>
        
            <li><a href="../../installing-isso/index.html">Installing Isso</a></li>
        
    </ul>
</div>

<!-- Blog Search Well -->





















    



            </div>
        </div>
    </div>



    

</div>

<!-- Footer -->
<footer class="overiq-footer">
    <div class="container">
        <div class="row">

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../terms-of-use/index.html">Terms</a></li>
                    <li><a href="../../privacy-policy/index.html">Privacy Policy</a></li>
                    <li><a href="../../sitemap.xml/index.html">Sitemap</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../contact/index.html">Contact</a></li>
                    <li><a href="../../blog/index.html">Blog</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="https://www.facebook.com/OverIQ/">Facebook</a></li>
                    <li><a href="https://twitter.com/infoOverIQ">Twitter</a></li>
                    <li><a href="https://github.com/overiq">Github</a></li>
                </ul>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../c-programming-101/index.html">C Tutorial</a></li>
                    <li><a href="../../python-101/index.html">Python Tutorial</a></li>
                    <li><a href="../../django-1-11/index.html">Django Tutorial</a></li>
                    <li><a href="../../flask-101/index.html">Flask Tutorial</a></li>
                    <li><a href="../../mysql-connector-python-101/index.html">MySQL Connector/Python Tutorial</a></li>
                    <li><a href="../index.html">SQLAlchemy Tutorial</a></li>
                    <li><a href="../../c-examples/index.html">C Programming Examples</a></li>
                </ul>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row text-center">
            <p>© 2025 OverIQ.com</p>
            <small><a href="#">Back to top</a></small>
        </div>

        <!-- /.row -->
    </div>
</footer>



<script type="text/javascript" src="../../static/CACHE/js/output.2e0ff002c1a4.js"></script>




<script async="" src="../../../cdn.jsdelivr.net/npm/cookieconsent%403/build/cookieconsent.min.js" data-cfasync="false"></script>

<script>

    
    window.addEventListener('load', function () {
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#5ca9e0",
                    "text": "#ffffff"
                },
                "button": {
                    "background": "#fff",
                    "text": "#237afc"
                }
            },
            "theme": "classic",
            "position": "top",
            "static": true,
            "content": {
                "href": "https://overiq.com/privacy-policy/"
            }
        });
    });


</script>

<script src="../../../polyfill.io/v3/polyfill.min1162.js?features=es6"></script>
<script id="MathJax-script" defer="" src="../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml.js"></script>

<script async="" type="text/javascript" src="../../../cdn.carbonads.com/carbonfbdb.js?serve=CE7DC53E&amp;placement=overiqcom" id="_carbonads_js"></script>





<script data-cfasync="false">function _emitEzConsentEvent(){var customEvent=new CustomEvent("ezConsentEvent",{detail:{ezTcfConsent:window.ezTcfConsent},bubbles:true,cancelable:true,});document.dispatchEvent(customEvent);}
(function(window,document){function _setAllEzConsentTrue(){window.ezTcfConsent.loaded=true;window.ezTcfConsent.store_info=true;window.ezTcfConsent.develop_and_improve_services=true;window.ezTcfConsent.measure_ad_performance=true;window.ezTcfConsent.measure_content_performance=true;window.ezTcfConsent.select_basic_ads=true;window.ezTcfConsent.create_ad_profile=true;window.ezTcfConsent.select_personalized_ads=true;window.ezTcfConsent.create_content_profile=true;window.ezTcfConsent.select_personalized_content=true;window.ezTcfConsent.understand_audiences=true;window.ezTcfConsent.use_limited_data_to_select_content=true;window.ezTcfConsent.select_personalized_content=true;}
function _clearEzConsentCookie(){document.cookie="ezCMPCookieConsent=tcf2;Domain=.overiq.com;Path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT";}
_clearEzConsentCookie();if(typeof window.__tcfapi!=="undefined"){window.ezgconsent=false;var amazonHasRun=false;function _ezAllowed(tcdata,purpose){return(tcdata.purpose.consents[purpose]||tcdata.purpose.legitimateInterests[purpose]);}
function _handleConsentDecision(tcdata){window.ezTcfConsent.loaded=true;if(!tcdata.vendor.consents["347"]&&!tcdata.vendor.legitimateInterests["347"]){window._emitEzConsentEvent();return;}
window.ezTcfConsent.store_info=_ezAllowed(tcdata,"1");window.ezTcfConsent.develop_and_improve_services=_ezAllowed(tcdata,"10");window.ezTcfConsent.measure_content_performance=_ezAllowed(tcdata,"8");window.ezTcfConsent.select_basic_ads=_ezAllowed(tcdata,"2");window.ezTcfConsent.create_ad_profile=_ezAllowed(tcdata,"3");window.ezTcfConsent.select_personalized_ads=_ezAllowed(tcdata,"4");window.ezTcfConsent.create_content_profile=_ezAllowed(tcdata,"5");window.ezTcfConsent.measure_ad_performance=_ezAllowed(tcdata,"7");window.ezTcfConsent.use_limited_data_to_select_content=_ezAllowed(tcdata,"11");window.ezTcfConsent.select_personalized_content=_ezAllowed(tcdata,"6");window.ezTcfConsent.understand_audiences=_ezAllowed(tcdata,"9");window._emitEzConsentEvent();}
function _handleGoogleConsentV2(tcdata){if(!tcdata||!tcdata.purpose||!tcdata.purpose.consents){return;}
var googConsentV2={};if(tcdata.purpose.consents[1]){googConsentV2.ad_storage='granted';googConsentV2.analytics_storage='granted';}
if(tcdata.purpose.consents[3]&&tcdata.purpose.consents[4]){googConsentV2.ad_personalization='granted';}
if(tcdata.purpose.consents[1]&&tcdata.purpose.consents[7]){googConsentV2.ad_user_data='granted';}
if(googConsentV2.analytics_storage=='denied'){gtag('set','url_passthrough',true);}
gtag('consent','update',googConsentV2);}
__tcfapi("addEventListener",2,function(tcdata,success){if(!success||!tcdata){window._emitEzConsentEvent();return;}
if(!tcdata.gdprApplies){_setAllEzConsentTrue();window._emitEzConsentEvent();return;}
if(tcdata.eventStatus==="useractioncomplete"||tcdata.eventStatus==="tcloaded"){if(typeof gtag!='undefined'){_handleGoogleConsentV2(tcdata);}
_handleConsentDecision(tcdata);if(tcdata.purpose.consents["1"]===true&&tcdata.vendor.consents["755"]!==false){window.ezgconsent=true;(adsbygoogle=window.adsbygoogle||[]).pauseAdRequests=0;}
if(window.__ezconsent){__ezconsent.setEzoicConsentSettings(ezConsentCategories);}
__tcfapi("removeEventListener",2,function(success){return null;},tcdata.listenerId);if(!(tcdata.purpose.consents["1"]===true&&_ezAllowed(tcdata,"2")&&_ezAllowed(tcdata,"3")&&_ezAllowed(tcdata,"4"))){if(typeof __ez=="object"&&typeof __ez.bit=="object"&&typeof window["_ezaq"]=="object"&&typeof window["_ezaq"]["page_view_id"]=="string"){__ez.bit.Add(window["_ezaq"]["page_view_id"],[new __ezDotData("non_personalized_ads",true),]);}}}});}else{_setAllEzConsentTrue();window._emitEzConsentEvent();}})(window,document);</script></body>
<!-- Mirrored from overiq.com/sqlalchemy-101/crud-using-sqlalchemy-core/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:16:11 GMT -->
</html>