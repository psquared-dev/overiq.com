<!DOCTYPE html><html lang="en">
<!-- Mirrored from overiq.com/sqlalchemy-101/crud-using-sqlalchemy-orm/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:16:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"/>
<script>var __ezHttpConsent={setByCat:function(src,tagType,attributes,category,force){var setScript=function(){if(force||window.ezTcfConsent[category]){var scriptElement=document.createElement(tagType);scriptElement.src=src;attributes.forEach(function(attr){for(var key in attr){if(attr.hasOwnProperty(key)){scriptElement.setAttribute(key,attr[key]);}}});var firstScript=document.getElementsByTagName(tagType)[0];firstScript.parentNode.insertBefore(scriptElement,firstScript);}};if(force||(window.ezTcfConsent&&window.ezTcfConsent.loaded)){setScript();}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){setScript();}else{console.error("cannot get ez consent data");force=true;setScript();}});}else{force=true;setScript();console.error("getEzConsentData is not a function");}},};</script>
<script>var ezTcfConsent=window.ezTcfConsent?window.ezTcfConsent:{loaded:false,store_info:false,develop_and_improve_services:false,measure_ad_performance:false,measure_content_performance:false,select_basic_ads:false,create_ad_profile:false,select_personalized_ads:false,create_content_profile:false,select_personalized_content:false,understand_audiences:false,use_limited_data_to_select_content:false,};function getEzConsentData(){return new Promise(function(resolve){document.addEventListener("ezConsentEvent",function(event){var ezTcfConsent=event.detail.ezTcfConsent;resolve(ezTcfConsent);});});}</script>
<script>if(typeof _setEzCookies!=='function'){function _setEzCookies(ezConsentData){var cookies=window.ezCookieQueue;for(var i=0;i<cookies.length;i++){var cookie=cookies[i];if(ezConsentData&&ezConsentData.loaded&&ezConsentData[cookie.tcfCategory]){document.cookie=cookie.name+"="+cookie.value;}}}}
window.ezCookieQueue=window.ezCookieQueue||[];if(typeof addEzCookies!=='function'){function addEzCookies(arr){window.ezCookieQueue=[...window.ezCookieQueue,...arr];}}
addEzCookies([]);if(window.ezTcfConsent&&window.ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else if(typeof getEzConsentData==="function"){getEzConsentData().then(function(ezTcfConsent){if(ezTcfConsent&&ezTcfConsent.loaded){_setEzCookies(window.ezTcfConsent);}else{console.error("cannot get ez consent data");_setEzCookies(window.ezTcfConsent);}});}else{console.error("getEzConsentData is not a function");_setEzCookies(window.ezTcfConsent);}</script>
<script data-ezscrex='false' data-cfasync='false' data-pagespeed-no-defer>var __ez=__ez||{};__ez.stms=Date.now();__ez.evt={};__ez.script={};__ez.ck=__ez.ck||{};__ez.template={};__ez.template.isOrig=true;window.__ezScriptHost="//www.ezojs.com";__ez.queue=__ez.queue||function(){var e=0,i=0,t=[],n=!1,o=[],r=[],s=!0,a=function(e,i,n,o,r,s,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,d=this;this.name=e,this.funcName=i,this.parameters=null===n?null:w(n)?n:[n],this.isBlock=o,this.blockedBy=r,this.deleteWhenComplete=s,this.isError=!1,this.isComplete=!1,this.isInitialized=!1,this.proceedIfError=a,this.fWindow=l,this.isTimeDelay=!1,this.process=function(){f("... func = "+e),d.isInitialized=!0,d.isComplete=!0,f("... func.apply: "+e);var i=d.funcName.split("."),n=null,o=this.fWindow||window;i.length>3||(n=3===i.length?o[i[0]][i[1]][i[2]]:2===i.length?o[i[0]][i[1]]:o[d.funcName]),null!=n&&n.apply(null,this.parameters),!0===d.deleteWhenComplete&&delete t[e],!0===d.isBlock&&(f("----- F'D: "+d.name),m())}},l=function(e,i,t,n,o,r,s){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:window,l=this;this.name=e,this.path=i,this.async=o,this.defer=r,this.isBlock=t,this.blockedBy=n,this.isInitialized=!1,this.isError=!1,this.isComplete=!1,this.proceedIfError=s,this.fWindow=a,this.isTimeDelay=!1,this.isPath=function(e){return"/"===e[0]&&"/"!==e[1]},this.getSrc=function(e){return void 0!==window.__ezScriptHost&&this.isPath(e)&&"banger.js"!==this.name?window.__ezScriptHost+e:e},this.process=function(){l.isInitialized=!0,f("... file = "+e);var i=this.fWindow?this.fWindow.document:document,t=i.createElement("script");t.src=this.getSrc(this.path),!0===o?t.async=!0:!0===r&&(t.defer=!0),t.onerror=function(){var e={url:window.location.href,name:l.name,path:l.path,user_agent:window.navigator.userAgent};"undefined"!=typeof _ezaq&&(e.pageview_id=_ezaq.page_view_id);var i=encodeURIComponent(JSON.stringify(e)),t=new XMLHttpRequest;t.open("GET/index.html","//g.ezoic.net/ezqlog?d="+i,!0),t.send(),f("----- ERR'D: "+l.name),l.isError=!0,!0===l.isBlock&&m()},t.onreadystatechange=t.onload=function(){var e=t.readyState;f("----- F'D: "+l.name),e&&!/loaded|complete/.test(e)||(l.isComplete=!0,!0===l.isBlock&&m())},i.getElementsByTagName("head")[0].appendChild(t)}},d=function(e,i){this.name=e,this.path="",this.async=!1,this.defer=!1,this.isBlock=!1,this.blockedBy=[],this.isInitialized=!0,this.isError=!1,this.isComplete=i,this.proceedIfError=!1,this.isTimeDelay=!1,this.process=function(){}};function c(e,i,n,s,a,d,c,u,f){var m=new l(e,i,n,s,a,d,c,f);!0===u?o[e]=m:r[e]=m,t[e]=m,h(m)}function h(e){!0!==u(e)&&0!=s&&e.process()}function u(e){if(!0===e.isTimeDelay&&!1===n)return f(e.name+" blocked = TIME DELAY!"),!0;if(w(e.blockedBy))for(var i=0;i<e.blockedBy.length;i++){var o=e.blockedBy[i];if(!1===t.hasOwnProperty(o))return f(e.name+" blocked = "+o),!0;if(!0===e.proceedIfError&&!0===t[o].isError)return!1;if(!1===t[o].isComplete)return f(e.name+" blocked = "+o),!0}return!1}function f(e){var i=window.location.href,t=new RegExp("[?&]ezq=([^&#]*)","i").exec(i);"1"===(t?t[1]:null)&&console.debug(e)}function m(){++e>200||(f("let's go"),p(o),p(r))}function p(e){for(var i in e)if(!1!==e.hasOwnProperty(i)){var t=e[i];!0===t.isComplete||u(t)||!0===t.isInitialized||!0===t.isError?!0===t.isError?f(t.name+": error"):!0===t.isComplete?f(t.name+": complete already"):!0===t.isInitialized&&f(t.name+": initialized already"):t.process()}}function w(e){return"[object Array]"==Object.prototype.toString.call(e)}return window.addEventListener("load",(function(){setTimeout((function(){n=!0,f("TDELAY -----"),m()}),5e3)}),!1),{addFile:c,addFileOnce:function(e,i,n,o,r,s,a,l,d){t[e]||c(e,i,n,o,r,s,a,l,d)},addDelayFile:function(e,i){var n=new l(e,i,!1,[],!1,!1,!0);n.isTimeDelay=!0,f(e+" ...  FILE! TDELAY"),r[e]=n,t[e]=n,h(n)},addFunc:function(e,n,s,l,d,c,u,f,m,p){!0===c&&(e=e+"_"+i++);var w=new a(e,n,s,l,d,u,f,p);!0===m?o[e]=w:r[e]=w,t[e]=w,h(w)},addDelayFunc:function(e,i,n){var o=new a(e,i,n,!1,[],!0,!0);o.isTimeDelay=!0,f(e+" ...  FUNCTION! TDELAY"),r[e]=o,t[e]=o,h(o)},items:t,processAll:m,setallowLoad:function(e){s=e},markLoaded:function(e){if(e&&0!==e.length){if(e in t){var i=t[e];!0===i.isComplete?f(i.name+" "+e+": error loaded duplicate"):(i.isComplete=!0,i.isInitialized=!0)}else t[e]=new d(e,!0);f("markLoaded dummyfile: "+t[e].name)}},logWhatsBlocked:function(){for(var e in t)!1!==t.hasOwnProperty(e)&&u(t[e])}}}();__ez.evt.add=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n()},__ez.evt.remove=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):delete e["on"+t]};__ez.script.add=function(e){var t=document.createElement("script");t.src=e,t.async=!0,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t)};__ez.dot={};__ez.queue.addFile('../../detroitchicago/boise.js', '../../detroitchicago/boisebb26.js?gcb=195-3&amp;cb=5', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/abilene.js', '../../parsonsmaize/abilenec0f9.js?gcb=195-3&amp;cb=7f81d60744', true, [], true, false, true, false);__ez.queue.addFile('../../parsonsmaize/mulvane.js', '../../parsonsmaize/mulvane2d63.js?gcb=195-3&amp;cb=e75e48eec0', true, ['/parsonsmaize/abilene.js'], true, false, true, false);__ez.queue.addFile('../../detroitchicago/birmingham.js', '../../detroitchicago/birminghame7ec.js?gcb=195-3&amp;cb=539c47377c', true, ['/parsonsmaize/abilene.js'], true, false, true, false);</script>
<script data-ezscrex="false" type="text/javascript" data-cfasync="false">window._ezaq = Object.assign({"ad_cache_level":1,"adpicker_placement_cnt":0,"ai_placeholder_cache_level":1,"ai_placeholder_placement_cnt":-1,"domain_id":92771,"ezcache_level":1,"ezcache_skip_code":0,"has_bad_image":0,"has_bad_words":0,"is_sitespeed":0,"lt_cache_level":0,"response_size":135042,"response_size_orig":129274,"response_time_orig":1199,"template_id":5,"url":"https://overiq.com/sqlalchemy-101/crud-using-sqlalchemy-orm/","word_count":0,"worst_bad_word_level":0}, typeof window._ezaq !== "undefined" ? window._ezaq : {});__ez.queue.markLoaded('ezaqBaseReady');</script>
<script type='text/javascript' data-ezscrex='false' data-cfasync='false'>
window.ezAnalyticsStatic = true;

function analyticsAddScript(script) {
	var ezDynamic = document.createElement('script');
	ezDynamic.type = 'text/javascript';
	ezDynamic.innerHTML = script;
	document.head.appendChild(ezDynamic);
}
function getCookiesWithPrefix() {
    var allCookies = document.cookie.split(';');
    var cookiesWithPrefix = {};

    for (var i = 0; i < allCookies.length; i++) {
        var cookie = allCookies[i].trim();

        for (var j = 0; j < arguments.length; j++) {
            var prefix = arguments[j];
            if (cookie.indexOf(prefix) === 0) {
                var cookieParts = cookie.split('=');
                var cookieName = cookieParts[0];
                var cookieValue = cookieParts.slice(1).join('=');
                cookiesWithPrefix[cookieName] = decodeURIComponent(cookieValue);
                break; // Once matched, no need to check other prefixes
            }
        }
    }

    return cookiesWithPrefix;
}
function productAnalytics() {
	var d = {"pr":[6],"omd5":"a6e32824ff137d8b4b42f27590db4831"};
	d.u = _ezaq.url;
	d.p = _ezaq.page_view_id;
	d.v = _ezaq.visit_uuid;
	d.ab = _ezaq.ab_test_id;
	d.e = JSON.stringify(_ezaq);
	d.ref = document.referrer;
	d.c = getCookiesWithPrefix('active_template', 'ez', 'lp_');
	if(typeof ez_utmParams !== 'undefined') {
		d.utm = ez_utmParams;
	}

	var dataText = JSON.stringify(d);
	var xhr = new XMLHttpRequest();
	xhr.open('POST/index.html','/ezais/analytics?cb=1', true);
	xhr.onload = function () {
		if (xhr.status!=200) {
            return;
		}

        if(document.readyState !== 'loading') {
            analyticsAddScript(xhr.response);
            return;
        }

        var eventFunc = function() {
            if(document.readyState === 'loading') {
                return;
            }
            document.removeEventListener('readystatechange', eventFunc, false);
            analyticsAddScript(xhr.response);
        };

        document.addEventListener('readystatechange', eventFunc, false);
	};
	xhr.setRequestHeader('Content-Type','text/plain');
	xhr.send(dataText);
}
__ez.queue.addFunc("productAnalytics", "productAnalytics", null, true, ['ezaqBaseReady'], false, false, false, true);
</script><base />
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>CRUD using SQLAlchemy ORM - SQLAlchemy Tutorial - OverIQ.com</title>

    
    



    <meta name="description" content="Creating Session #

When using SQLAlchemy ORM, we interact with the database using the Session object. The Session object also wraps the database con…"/>



    <link rel="canonical" href="index.html"/>


<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="CRUD using SQLAlchemy ORM"/>

    <meta property="og:description" content="Creating Session #

When using SQLAlchemy ORM, we interact with the database using the Session object. The Session object also wraps the database con…"/>


<meta property="og:url" content="https://overiq.com/sqlalchemy-101/crud-using-sqlalchemy-orm/"/>
<meta property="og:site_name" content="OverIQ.com"/>


<meta property="article:publisher" content="https://www.facebook.com/OverIQ/"/>



<meta name="twitter:card" content="summary_large_image"/>

    <meta name="twitter:description" content="Creating Session #

When using SQLAlchemy ORM, we interact with the database using the Session object. The Session object also wraps the database con…"/>


<meta name="twitter:title" content="CRUD using SQLAlchemy ORM"/>
<meta name="twitter:site" content="@infoOverIQ"/>

<meta name="twitter:creator" content="@infoOverIQ"/>




    
    
    


    
    
    


    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../feed.xml/index.html"/>
    
    
    <link href="../../../fonts.googleapis.com/cssd2d5.css?family=Open+Sans" rel="stylesheet"/>
    <link rel="stylesheet" href="../../../maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="icon" href="../../static/wiki/favicon.png" sizes="32x32"/>

    <link rel="stylesheet" href="../../static/CACHE/css/output.db46da465a8b.css" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-125424793-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125424793-1');
    </script>


<script type='text/javascript'>
var ezoTemplate = 'orig_site';
var ezouid = '1';
var ezoFormfactor = '1';
</script><script data-ezscrex="false" type='text/javascript'>
var soc_app_id = '0';
var did = 92771;
var ezdomain = 'overiq.com';
var ezoicSearchable = 1;
</script></head>
<body>

<div class="overiq-header text-center">
    <div class="site-branding">
        <p class="main-title">
            <a href="../../index.html" rel="home">
                OverIQ.com
            </a>
        </p>
    </div>
</div>

<!-- Navigation -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html">Home</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                

                <li>
                    <a href="../../blog/index.html">Blog</a>
                </li>
                <li>
                    <a href="../../contact/index.html">Contact</a>
                </li>
                <li>
                    <a href="../../about/index.html">About</a>
                </li>
            </ul>

            <ul class="nav navbar-nav navbar-right visible-lg visible-md">
                <li>
                    <a href="../../feed.xml/index.html" title="RSS" target="_blank">
                        <i class="fa fa-rss fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/overiq/" target="_blank" title="Github">
                        <i class="fa fa-github fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://www.facebook.com/OverIQ/" target="_blank" title="Facebook">
                        <i class="fa fa-facebook fa-lg" aria-hidden="true"></i>
                    </a>
                </li>
                <li>
                    <a href="https://twitter.com/infoOverIQ" target="_blank" title="Twitter">
                        <i class="fa fa-twitter fa-lg" aria-hidden="true"></i>
                    </a>
                </li>

                

            </ul>

            <form action="https://overiq.com/search/" class="navbar-form navbar-left" role="search">

                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search" name="query" value=""/>
                </div>

                <button type="submit" class="btn btn-default">Submit</button>
            </form>

        </div>



        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<div class="container">

    


    <div class="se-pre-con"></div>

    

    <div class="row">

        
        <div class="main">
            <div class="col-lg-8 col-md-8 col-sm-12">
                

    


    
        <ol class="breadcrumb">

    <li><a href="../../index.html">Home</a></li>

    
        
        <li><a href="../index.html">SQLAlchemy Tutorial</a></li>
        

        

        
    
        

        

        
            <li class="active">CRUD using SQLAlchemy ORM</li>
        
    

</ol>
    


<h1>CRUD using SQLAlchemy ORM</h1>




    <p><i class="fa fa-calendar" aria-hidden="true"></i>
        Last updated on July 27, 2020
    </p>


<hr/>



<span id="creating-session" class="anchor-target"></span><h2 class="heading">Creating Session <a class="header-link" href="#creating-session">#</a></h2>

<p>When using SQLAlchemy ORM, we interact with the database using the <code>Session</code> object. The <code>Session</code> object also wraps the database connection and transaction. The transaction implicitly starts as soon as the <code>Session</code> starts communicating with the database and will remain open until the <code>Session</code> is committed, rolled back or closed.</p>

<p>One way to create a <code>Session</code> object is to use the <code>Session</code> class from the <code>sqlalchemy.orm</code> package.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Session</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&#34;postgres+psycopg2://postgres:pass@localhost/mydb&#34;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>You will have to create the <code>Session</code> object everytime you want to communicate with the database.</p>

<p>The <code>Session</code> constructor accepts a number of argument to customize its working. If we choose to create Session using this method, we would have to call the <code>Session</code> constructor with the same set of parameters over and over again throughout the application.</p>

<p>To make things easier, SQLAlchemy provides <code>sessionmaker</code> class which creates <code>Session</code> class with default arguments set for its constructor.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span><span class="p">,</span> <span class="n">Session</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>You should call call <code>sessionmaker</code> once in your application at the global scope. </p>

<p>Once we have access to the custom <code>Session</code> class you can instantiate it as many time as you need without passing any arguments to it.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that instantiating <code>Session</code> object doesn&#39;t instantly establish connection to the database. The connection is established only when you start sending queries to the database.</p>

<p><strong>Note:</strong> There is more to Session than this tutorial covers. For more details checkout the official documentation.</p>
<span id="inserting-data" class="anchor-target"></span><h2 class="heading">Inserting Data <a class="header-link" href="#inserting-data">#</a></h2>

<p>To create a new record using SQLAlchemy ORM, we follow these steps:</p>

<ol>
<li>Create an object.</li>
<li>Add the object to the session.</li>
<li>Commit the session.</li>
</ol>

<p>Let&#39;s create two new <code>Customer</code> objects as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">c1</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Toby&#39;</span><span class="p">,</span> 
              <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Miller&#39;</span><span class="p">,</span> 
              <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;tmiller&#39;</span><span class="p">,</span> 
              <span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;tmiller@example.com&#39;</span><span class="p">,</span> 
              <span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;1662 Kinney Street&#39;</span><span class="p">,</span>
              <span class="n">town</span> <span class="o">=</span> <span class="s1">&#39;Wolfden&#39;</span>
             <span class="p">)</span>

<span class="n">c2</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Scott&#39;</span><span class="p">,</span> 
              <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Harvey&#39;</span><span class="p">,</span> 
              <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;scottharvey&#39;</span><span class="p">,</span> 
              <span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;scottharvey@example.com&#39;</span><span class="p">,</span> 
              <span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;424 Patterson Street&#39;</span><span class="p">,</span>
              <span class="n">town</span> <span class="o">=</span> <span class="s1">&#39;Beckinsdale&#39;</span>
             <span class="p">)</span>
<span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>(&lt;Customer:None-johngreen&gt;, &lt;Customer:None-katwilson&gt;)
</pre></div>
</div>
<p>Here we have created two <code>Customer</code> objects. We can access the attributes of an object using the dot(<code>.</code>) operator as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">last_name</span>
<span class="n">c2</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">last_name</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>(&#39;John&#39;, &#39;Green&#39;)
(&#39;Katherine&#39;, &#39;Wilson&#39;)
</pre></div>
</td></tr></tbody></table></div>
<p>Next, we add the objects to the session.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Adding objects to the session doesn&#39;t actually writes them to the database, it only prepares the objects to be saved in the next commit. We can verify this by checking the primary key of the objects.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>(None, None)
</pre></div>
</div>
<p>The value of <code>id</code> attribute of both the objects is <code>None</code>. That means our objects are not yet saved in the database.</p>

<p>Instead of adding one object to the session at a time, we can use <code>add_all()</code> method. The <code>add_all()</code> method accepts a list of objects to be added to the session.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">])</span>
</pre></div>
</div>
<p>Adding an object to the session multiple times doesn&#39;t throw any errors. At any time, you can view the objects added to the session using <code>session.new</code>.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">new</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>IdentitySet([&lt;Customer:None-johngreen&gt;, &lt;Customer:None-katwilson&gt;])
</pre></div>
</div>
<p>Finally, to save the objects to the database call <code>commit()</code> method as follows:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Once you commit the transaction, the connection resources referenced by the <code>Session</code> object is returned to the connection pool. Subsequent operations will occur in a new transaction.</p>

<p>Accessing the <code>id</code> attribute of the <code>Customer</code> object will now return the primary key instead of <code>None</code>.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>(1, 2)
</pre></div>
</div>
<p>At this point, the <code>Customer</code> table should look like this:</p>

<p><img src="../../media/uploads/2018/8/3/Selection_005-ba3cff10-46c5-4818-9456-5863e3442589.png" loading="lazy" alt=""/></p>

<p>Our customers haven&#39;t ordered anything. So <code>c1.orders</code> and <code>c2.orders</code> would return an empty list.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="o">.</span><span class="n">orders</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">orders</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>([], [])
</pre></div>
</div>
<p>Let&#39;s add some more customers to the <code>customers</code> table:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">c3</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span>
            <span class="n">first_name</span> <span class="o">=</span> <span class="s2">&#34;John&#34;</span><span class="p">,</span> 
            <span class="n">last_name</span> <span class="o">=</span> <span class="s2">&#34;Lara&#34;</span><span class="p">,</span> 
            <span class="n">username</span> <span class="o">=</span> <span class="s2">&#34;johnlara&#34;</span><span class="p">,</span> 
            <span class="n">email</span> <span class="o">=</span> <span class="s2">&#34;johnlara@mail.com&#34;</span><span class="p">,</span> 
            <span class="n">address</span> <span class="o">=</span> <span class="s2">&#34;3073 Derek Drive&#34;</span><span class="p">,</span>
            <span class="n">town</span> <span class="o">=</span> <span class="s2">&#34;Norfolk&#34;</span>
<span class="p">)</span>

<span class="n">c4</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span>          
            <span class="n">first_name</span> <span class="o">=</span> <span class="s2">&#34;Sarah&#34;</span><span class="p">,</span> 
            <span class="n">last_name</span> <span class="o">=</span> <span class="s2">&#34;Tomlin&#34;</span><span class="p">,</span> 
            <span class="n">username</span> <span class="o">=</span> <span class="s2">&#34;sarahtomlin&#34;</span><span class="p">,</span> 
            <span class="n">email</span> <span class="o">=</span> <span class="s2">&#34;sarahtomlin@mail.com&#34;</span><span class="p">,</span>
            <span class="n">address</span> <span class="o">=</span> <span class="s2">&#34;3572 Poplar Avenue&#34;</span><span class="p">,</span>
            <span class="n">town</span> <span class="o">=</span> <span class="s2">&#34;Norfolk&#34;</span>        
<span class="p">)</span>

<span class="n">c5</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Toby&#39;</span><span class="p">,</span> 
              <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Miller&#39;</span><span class="p">,</span> 
              <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;tmiller&#39;</span><span class="p">,</span> 
              <span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;tmiller@example.com&#39;</span><span class="p">,</span> 
              <span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;1662 Kinney Street&#39;</span><span class="p">,</span>
              <span class="n">town</span> <span class="o">=</span> <span class="s1">&#39;Wolfden&#39;</span>
             <span class="p">)</span>

<span class="n">c6</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Scott&#39;</span><span class="p">,</span> 
              <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Harvey&#39;</span><span class="p">,</span> 
              <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;scottharvey&#39;</span><span class="p">,</span> 
              <span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;scottharvey@example.com&#39;</span><span class="p">,</span> 
              <span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;424 Patterson Street&#39;</span><span class="p">,</span>
              <span class="n">town</span> <span class="o">=</span> <span class="s1">&#39;Beckinsdale&#39;</span>
             <span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="n">c6</span><span class="p">])</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Before we can take orders, let&#39;s add some products to the <code>items</code> table.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">i1</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">9.21</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mf">10.81</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">i2</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Pen&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">3.45</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mf">4.51</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">i3</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Headphone&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">15.52</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mf">16.81</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">i4</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Travel Bag&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">20.1</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mf">24.21</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">i5</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Keyboard&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">20.1</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mf">22.11</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">i6</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Monitor&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">200.14</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mf">212.89</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">i7</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Watch&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">100.58</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mf">104.41</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">i8</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Water Bottle&#39;</span><span class="p">,</span> <span class="n">cost_price</span> <span class="o">=</span> <span class="mf">20.89</span><span class="p">,</span> <span class="n">selling_price</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i3</span><span class="p">,</span> <span class="n">i4</span><span class="p">,</span> <span class="n">i5</span><span class="p">,</span> <span class="n">i6</span><span class="p">,</span> <span class="n">i7</span><span class="p">,</span> <span class="n">i8</span><span class="p">])</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Create some orders now:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">o1</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">customer</span> <span class="o">=</span> <span class="n">c1</span><span class="p">)</span>
<span class="n">o2</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">customer</span> <span class="o">=</span> <span class="n">c1</span><span class="p">)</span>

<span class="n">line_item1</span> <span class="o">=</span> <span class="n">OrderLine</span><span class="p">(</span><span class="n">order</span> <span class="o">=</span> <span class="n">o1</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span>  <span class="mi">3</span><span class="p">)</span>
<span class="n">line_item2</span> <span class="o">=</span> <span class="n">OrderLine</span><span class="p">(</span><span class="n">order</span> <span class="o">=</span> <span class="n">o1</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="n">i2</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span>  <span class="mi">2</span><span class="p">)</span>
<span class="n">line_item3</span> <span class="o">=</span> <span class="n">OrderLine</span><span class="p">(</span><span class="n">order</span> <span class="o">=</span> <span class="n">o2</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">)</span>
<span class="n">line_item3</span> <span class="o">=</span> <span class="n">OrderLine</span><span class="p">(</span><span class="n">order</span> <span class="o">=</span> <span class="n">o2</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="n">i2</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span>  <span class="mi">4</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">])</span>

<span class="n">session</span><span class="o">.</span><span class="n">new</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Notice that we are only adding <code>Order</code> objects (i.e <code>o1</code> and <code>o2</code>) to the session. The <code>Order</code> and <code>OrderLine</code> object are associated with a one-to-many relationship. Adding an <code>Order</code> object to the session implicitly adds related <code>OrderLine</code> object to the session as well. However, even you still add the <code>OrderLine</code> object manually to the session, you will not get any error.</p>

<p>Instead of passing <code>Order</code> object at the time of creating <code>OrderLine</code> instance, we can also do this:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">o3</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">customer</span> <span class="o">=</span> <span class="n">c1</span><span class="p">)</span>
<span class="n">orderline1</span> <span class="o">=</span> <span class="n">OrderLine</span><span class="p">(</span><span class="n">item</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">orderline2</span> <span class="o">=</span> <span class="n">OrderLine</span><span class="p">(</span><span class="n">item</span> <span class="o">=</span> <span class="n">i2</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">o3</span><span class="o">.</span><span class="n">order_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderline1</span><span class="p">)</span>
<span class="n">o3</span><span class="o">.</span><span class="n">order_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderline2</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">o3</span><span class="p">])</span>

<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>After this commit, the <code>orders</code> and <code>order_lines</code> table should now look like this:</p>

<p>[]</p>

<p>Access the <code>orders</code> attribute of the <code>Customer</code> object again, this time you will get a non-empty list like this:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="o">.</span><span class="n">orders</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Order:8&gt;, &lt;Order:9&gt;]
</pre></div>
</div>
<p>From the other side of the relationship, we can access the <code>Customer</code> object to which the order belongs to using the <code>customer</code> attribute on the <code>Order</code> object.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">o1</span><span class="o">.</span><span class="n">customer</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>&lt;Customer:1-tmiller&gt;
</pre></div>
</div>
<p>The customer <code>c1</code> now has two orders. To view the order lines in an order use the <code>order_lines</code> attribute of the <code>Order</code> object.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">order_lines</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">order_lines</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>([&lt;OrderLine:1&gt;, &lt;OrderLine:2&gt;], [&lt;OrderLine:3&gt;, &lt;OrderLine:4&gt;])
</pre></div>
</div>
<p>To access the item in an order line use <code>item</code> attribute.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">c1</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">order_lines</span><span class="p">:</span>
    <span class="n">ol</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">quantity</span>
    
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;-------&#39;</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="n">c1</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">order_lines</span><span class="p">:</span>
    <span class="n">ol</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="n">ol</span><span class="o">.</span><span class="n">quantity</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>(1, &lt;Item:1-Chair&gt;, 3)
(2, &lt;Item:2-Pen&gt;, 2)
-------
(3, &lt;Item:1-Chair&gt;, 1)
(4, &lt;Item:2-Pen&gt;, 4)
</pre></div>
</td></tr></tbody></table></div>
<p>Remember that, all of this became possible because of the <code>relationship()</code> we defined in our models.</p>
<span id="querying-data" class="anchor-target"></span><h2 class="heading">Querying Data <a class="header-link" href="#querying-data">#</a></h2>

<p>To query database we use the <code>query()</code> method of the <code>session</code> object. The <code>query()</code> method returns an object of type <code>sqlalchemy.orm.query.Query</code>, simply called <code>Query</code>. The <code>Query</code> object represents the <code>SELECT</code> statement that will be used to query the database. The following table lists some common methods of the <code>Query</code> class.</p>
<div style="overflow-x:auto"><table class="table table-bordered table-hover table-condensed"><thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>all()</code></td>
<td>returns the result of the query (represented by <code>Query</code>) as a list.</td>
</tr>
<tr>
<td><code>count()</code></td>
<td>returns the total number of records in the query.</td>
</tr>
<tr>
<td><code>first()</code></td>
<td>returns the first result of the query or <code>None</code>, if there are no rows in the result.</td>
</tr>
<tr>
<td><code>scalar()</code></td>
<td>returns the first column of the first row or <code>None</code> if the result set is empty. If multiple rows are encountered it throws <code>MultipleResultsFound</code> exception.</td>
</tr>
<tr>
<td><code>one</code></td>
<td>returns exactly only row. If it encounters multiple rows it throws <code>MultipleResultsFound</code> exception. If the result set is empty it throws <code>NoResultFound</code> exception.</td>
</tr>
<tr>
<td><code>get(pk)</code></td>
<td>returns an object that matches the given primary key (pk), or <code>None</code>, if no such object is found.</td>
</tr>
<tr>
<td><code>filter(*criterion)</code></td>
<td>returns a new <code>Query</code> instance after applying the <code>WHERE</code> clause to the query.</td>
</tr>
<tr>
<td><code>limit(limit)</code></td>
<td>return a new <code>Query</code> instance after applying the <code>LIMIT</code> clause to the query.</td>
</tr>
<tr>
<td><code>offset(offset)</code></td>
<td>return a new <code>Query</code> instance after applying the <code>OFFSET</code> clause to the query.</td>
</tr>
<tr>
<td><code>order_by(*criterion)</code></td>
<td>return a new <code>Query</code> instance after applying <code>ORDER BY</code> clause to the query.</td>
</tr>
<tr>
<td><code>join(*props, **kwargs)</code></td>
<td>return a new <code>Query</code> instance after creating SQL INNER JOIN on the query.</td>
</tr>
<tr>
<td><code>outerjoin(*props, **kwargs)</code></td>
<td>return a new <code>Query</code> instance after creating SQL LEFT OUTER JOIN on the query.</td>
</tr>
<tr>
<td><code>group_by(*criterion)</code></td>
<td>return a new <code>Query</code> instance after adding <code>GROUP BY</code> clause to the query.</td>
</tr>
<tr>
<td><code>having(criterion)</code></td>
<td>return a new <code>Query</code> instance after adding <code>HAVING</code> clause to the query.</td>
</tr>
</tbody>
</table></div><span id="all-method" class="anchor-target"></span><h3 class="heading">all() method <a class="header-link" href="#all-method">#</a></h3>

<p>In its simplest form, the <code>query()</code> method can take one or more model class or columns as arguments. The following code returns all the records from the <code>customers</code> table.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Customer:1-jongreen&gt;,
 &lt;Customer:2-katwilson&gt;,
 &lt;Customer:3-johnlara&gt;,
 &lt;Customer:4-sarahtomlin&gt;,
 &lt;Customer:5-tmiller&gt;,
 &lt;Customer:6-scottharvey&gt;]
</pre></div>
</td></tr></tbody></table></div>
<p>Similarly, the following code returns all the records from the <code>items</code> and <code>orders</code> table.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Item:1-Chair&gt;,
 &lt;Item:2-Pen&gt;,
 &lt;Item:3-Headphone&gt;,
 &lt;Item:4-Travel Bag&gt;,
 &lt;Item:5-Keyboard&gt;,
 &lt;Item:6-Monitor&gt;,
 &lt;Item:7-Watch&gt;,
 &lt;Item:8-Water Bottle&gt;]

[&lt;Order:1&gt;, &lt;Order:2&gt;, &lt;Order:3&gt;]
</pre></div>
</td></tr></tbody></table></div>
<p>To get the raw SQL used to query the database simply print the <code>sqlalchemy.orm.query.Query</code> object as follows:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers. ID AS customers_id,
    customers.first_name AS customers_first_name,
    customers.last_name AS customers_last_name,
    customers.username AS customers_username,
    customers.email AS customers_email,
    customers.address AS customers_address,
    customers.town AS customers_town,
    customers.created_on AS customers_created_on,
    customers.updated_on AS customers_updated_on
FROM
    customers
</pre></div>
</td></tr></tbody></table></div>
<p>Calling <code>all()</code> method on a large result set is inefficient instead we can use a for loop to iterate over the <code>Query</code> object as follows::</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">first_name</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>1 John
2 Katherine
3 John
4 Sarah
5 Toby
6 Scott
</pre></div>
</td></tr></tbody></table></div>
<p>The preceding queries have returned data from all columns of the table. We can prevent this by passing the column names explicitly to the <code>query()</code> method as follows:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(1, &#39;John&#39;),
 (2, &#39;Katherine&#39;),
 (3, &#39;John&#39;),
 (4, &#39;Sarah&#39;),
 (5, &#39;Toby&#39;),
 (6, &#39;Scott&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>Notice that now each item in the list is a tuple instead of a model instance.</p>
<span id="count-method" class="anchor-target"></span><h3 class="heading">count() method <a class="header-link" href="#count-method">#</a></h3>

<p>The <code>count()</code> method returns the number of results returned by the query.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c1"># get the total number of records in the customers table</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c1"># get the total number of records in the items table</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c1"># get the total number of records in the orders table</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>6
8
3
</pre></div>
</td></tr></tbody></table></div><span id="first-method" class="anchor-target"></span><h3 class="heading">first() method <a class="header-link" href="#first-method">#</a></h3>

<p>The <code>first()</code> method returns the first result of the query or <code>None</code> if the query returns zero results.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;Customer:1-johngreen&gt;
&lt;Item:1-Chair&gt;
&lt;Order:1&gt;
</pre></div>
</td></tr></tbody></table></div><span id="get-method" class="anchor-target"></span><h3 class="heading">get() method <a class="header-link" href="#get-method">#</a></h3>

<p>The <code>get()</code> method returns the instance which matches the primary key passed to it or <code>None</code> if no such object found.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;Customer:1-johngreen&gt;
&lt;Item:1-Chair&gt;
</pre></div>
</td></tr></tbody></table></div><span id="filter-method" class="anchor-target"></span><h3 class="heading">filter() method <a class="header-link" href="#filter-method">#</a></h3>

<p>The <code>filter()</code> method allows us to filter the result by adding <code>WHERE</code> clause to the query. At the minimum, it accepts a column, an operator and a value. Here is an example:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Customer:1-johngreen&gt;, &lt;Customer:3-johnlara&gt;]
</pre></div>
</div>
<p>This query returns all the customers whose first name is <code>John</code>. The SQL equivalent of the query is:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers.id AS customers_id,
    customers.first_name AS customers_first_name,
    customers.last_name AS customers_last_name,
    customers.username AS customers_username,
    customers.email AS customers_email,
    customers.address AS customers_address,
    customers.town AS customers_town,
    customers.created_on AS customers_created_on,
    customers.updated_on AS customers_updated_on
FROM
    customers
WHERE
    customers.first_name = %(first_name_1)s
</pre></div>
</td></tr></tbody></table></div>
<p>The string <code>%(first_name_1)s</code> in the <code>WHERE</code> clause is a placeholder and will be replaced by the actual value (i.e <code>John</code>) when the query is executed. </p>

<p>We can pass multiple filters to the <code>filter()</code> method and they will be joined together using SQL <code>AND</code> operator. For example:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Customer</span><span class="o">.</span><span class="n">town</span> <span class="o">==</span> <span class="s2">&#34;Norfolk&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Customer:1-johngreen&gt;, &lt;Customer:3-johnlara&gt;, &lt;Customer:4-sarahtomlin&gt;]
</pre></div>
</div>
<p>This query returns all the customers whose primary key is less than or equal to 5 and town name starts with <code>Nor</code>. Its SQL equivalent is:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Customer</span><span class="o">.</span><span class="n">town</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;Nor%&#34;</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>

<p>Another way to combine conditions is to use conjunctions (i.e. <code>and_()</code>, <code>or_()</code> and <code>not_()</code>). Here are some examples:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># find all customers who either live in Peterbrugh or Norfolk</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">or_</span><span class="p">(</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">town</span> <span class="o">==</span> <span class="s1">&#39;Peterbrugh&#39;</span><span class="p">,</span> 
    <span class="n">Customer</span><span class="o">.</span><span class="n">town</span> <span class="o">==</span> <span class="s1">&#39;Norfolk&#39;</span>
<span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="c1"># find all customers whose first name is John and live in Norfolk</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> 
    <span class="n">Customer</span><span class="o">.</span><span class="n">town</span> <span class="o">==</span> <span class="s1">&#39;Norfolk&#39;</span>
<span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="c1"># find all johns who don&#39;t live in Peterbrugh</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> 
    <span class="n">not_</span><span class="p">(</span>
        <span class="n">Customer</span><span class="o">.</span><span class="n">town</span> <span class="o">==</span> <span class="s1">&#39;Peterbrugh&#39;</span><span class="p">,</span> 
    <span class="p">)</span>
<span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Customer:1-johngreen&gt;,
 &lt;Customer:2-katwilson&gt;,
 &lt;Customer:3-johnlara&gt;,
 &lt;Customer:4-sarahtomlin&gt;]

[&lt;Customer:1-johngreen&gt;, &lt;Customer:3-johnlara&gt;]

[&lt;Customer:1-johngreen&gt;, &lt;Customer:3-johnlara&gt;]
</pre></div>
</td></tr></tbody></table></div>
<p>The following listing shows how to use some common comparison operators with the <code>filter()</code> method.</p>
<span id="is-null" class="anchor-target"></span><h3 class="heading">IS NULL <a class="header-link" href="#is-null">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">date_shipped</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Order:1&gt;, &lt;Order:2&gt;, &lt;Order:3&gt;]
</pre></div>
</div><span id="is-not-null" class="anchor-target"></span><h3 class="heading">IS NOT NULL <a class="header-link" href="#is-not-null">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">date_shipped</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[]
</pre></div>
</div><span id="in" class="anchor-target"></span><h3 class="heading">IN <a class="header-link" href="#in">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s1">&#39;Toby&#39;</span><span class="p">,</span> <span class="s1">&#39;Sarah&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Customer:4-sarahtomlin&gt;, &lt;Customer:5-tmiller&gt;]
</pre></div>
</div><span id="not-in" class="anchor-target"></span><h3 class="heading">NOT IN <a class="header-link" href="#not-in">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span><span class="o">.</span><span class="n">notin_</span><span class="p">([</span><span class="s1">&#39;Toby&#39;</span><span class="p">,</span> <span class="s1">&#39;Sarah&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Customer:1-johngreen&gt;,
 &lt;Customer:2-katwilson&gt;,
 &lt;Customer:3-johnlara&gt;,
 &lt;Customer:6-scottharvey&gt;]
</pre></div>
</td></tr></tbody></table></div><span id="between" class="anchor-target"></span><h3 class="heading">BETWEEN <a class="header-link" href="#between">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">cost_price</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Item:3-Headphone&gt;,
 &lt;Item:4-Travel Bag&gt;,
 &lt;Item:5-Keyboard&gt;,
 &lt;Item:8-Water Bottle&gt;]
</pre></div>
</td></tr></tbody></table></div><span id="not-between" class="anchor-target"></span><h3 class="heading">NOT BETWEEN <a class="header-link" href="#not-between">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">not_</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">cost_price</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Item:1-Chair&gt;, &lt;Item:2-Pen&gt;, &lt;Item:6-Monitor&gt;, &lt;Item:7-Watch&gt;]
</pre></div>
</div><span id="like" class="anchor-target"></span><h3 class="heading">LIKE <a class="header-link" href="#like">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%r</span><span class="s2">&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Item:1-Chair&gt;, &lt;Item:6-Monitor&gt;]
</pre></div>
</div>
<p>The <code>like()</code> method performs a case-sensitive match. For case-insensitive match use <code>ilike()</code>.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;w%&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Item:7-Watch&gt;, &lt;Item:8-Water Bottle&gt;]
</pre></div>
</div><span id="not-like" class="anchor-target"></span><h3 class="heading">NOT LIKE <a class="header-link" href="#not-like">#</a></h3>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">not_</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;W%&#34;</span><span class="p">)))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Item:1-Chair&gt;,
 &lt;Item:2-Pen&gt;,
 &lt;Item:3-Headphone&gt;,
 &lt;Item:4-Travel Bag&gt;,
 &lt;Item:5-Keyboard&gt;,
 &lt;Item:6-Monitor&gt;]
</pre></div>
</td></tr></tbody></table></div><span id="limit-method" class="anchor-target"></span><h3 class="heading">limit() method <a class="header-link" href="#limit-method">#</a></h3>

<p>The <code>limit()</code> method adds <code>LIMIT</code> clause to the query. It accepts the number of rows you want to return from the query.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;%avenue&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Customer:1-johngreen&gt;, &lt;Customer:2-katwilson&gt;]

[&lt;Customer:2-katwilson&gt;, &lt;Customer:4-sarahtomlin&gt;]
</pre></div>
</td></tr></tbody></table></div>
<p>The SQL equivalent of the above queries is as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;%avenue&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers. id AS customers_id,
    customers.first_name AS customers_first_name,
    customers.last_name AS customers_last_name,
    customers.username AS customers_username,
    customers.email AS customers_email,
    customers.address AS customers_address,
    customers.town AS customers_town,
    customers.created_on AS customers_created_on,
    customers.updated_on AS customers_updated_on
FROM
    customers
LIMIT %(param_1)s 

SELECT
    customers.id AS customers_id,
    customers.first_name AS customers_first_name,
    customers.last_name AS customers_last_name,
    customers.username AS customers_username,
    customers.email AS customers_email,
    customers.address AS customers_address,
    customers.town AS customers_town,
    customers.created_on AS customers_created_on,
    customers.updated_on AS customers_updated_on
FROM
    customers
WHERE
    customers.address ILIKE % (address_1)s
LIMIT %(param_1)s
</pre></div>
</td></tr></tbody></table></div><span id="offset-method" class="anchor-target"></span><h3 class="heading">offset() method <a class="header-link" href="#offset-method">#</a></h3>

<p>The <code>offset()</code> method adds the <code>OFFSET</code> clause to the query. It accepts offset as an argument. It is commonly used with the <code>limit()</code> clause.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Customer:3-johnlara&gt;, &lt;Customer:4-sarahtomlin&gt;]
</pre></div>
</div>
<p>The SQL equivalent of the above query is as follows:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers. ID AS customers_id,
    customers.first_name AS customers_first_name,
    customers.last_name AS customers_last_name,
    customers.username AS customers_username,
    customers.email AS customers_email,
    customers.address AS customers_addrees,
    customers.town AS customers_town,
    customers.created_on AS customers_created_on,
    customers.updated_on AS customers_updated_on
FROM
    customers
LIMIT %(param_1)s OFFSET %(param_2)s
</pre></div>
</td></tr></tbody></table></div><span id="order_by-method" class="anchor-target"></span><h3 class="heading">order_by() method <a class="header-link" href="#order_by-method">#</a></h3>

<p>The <code>order_by()</code> method is used to order the result by adding <code>ORDER BY</code> clause to the query. It accepts column names on which the order should be based. By default, it sorts in ascending order.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;wa%&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;wa%&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">cost_price</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Item:7-Watch&gt;, &lt;Item:8-Water Bottle&gt;]
[&lt;Item:8-Water Bottle&gt;, &lt;Item:7-Watch&gt;]
</pre></div>
</td></tr></tbody></table></div>
<p>To sort in descending order use <code>desc()</code> function as follows:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">desc</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;wa%&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">cost_price</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Item:7-Watch&gt;, &lt;Item:8-Water Bottle&gt;]
</pre></div>
</div><span id="join-method" class="anchor-target"></span><h3 class="heading">join() method <a class="header-link" href="#join-method">#</a></h3>

<p>The <code>join()</code> method is used to create SQL INNER JOIN. It accepts table name for which you want to create SQL JOIN.</p>

<p>Let&#39;s use <code>join()</code> method to find all the customers who have one or more orders.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[&lt;Customer:1-johngreen&gt;]
</pre></div>
</div>
<p>This query is equivalent to the following SQL:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Order</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SELECT
    customers.id AS customers_id,
    customers.first_name AS customers_first_name,
    customers.last_name AS customers_last_name,
    customers.username AS customers_username,
    customers.email AS customers_email,
    customers.address AS customers_address,
    customers.town AS customers_town,
    customers.created_on AS customers_created_on,
    customers.updated_on AS customers_updated_on
FROM
    customers
JOIN orders ON customers.id = orders.customer_id
</pre></div>
</td></tr></tbody></table></div>
<p>The <code>join()</code> method is commonly used to get the data from one or more table in a single query. For example:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Customer</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">Order</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[(1, &#39;johngreen&#39;, 1), (1, &#39;johngreen&#39;, 2), (1, &#39;johngreen&#39;, 3)]
</pre></div>
</div>
<p>We can create SQL JOIN for more than two table by chaining <code>join()</code> method as follows:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Table1</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Table2</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Table3</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Table4</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is another example, which uses 3 joins to find all the items in the <code>John Green</code>&#39;s first order.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> 
    <span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
    <span class="n">Item</span><span class="o">.</span><span class="n">selling_price</span><span class="p">,</span> 
    <span class="n">OrderLine</span><span class="o">.</span><span class="n">quantity</span>
<span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OrderLine</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s1">&#39;Green&#39;</span><span class="p">,</span>
    <span class="n">Order</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[(&#39;John&#39;, &#39;Chair&#39;, Decimal(&#39;10.81&#39;), 3), (&#39;John&#39;, &#39;Pen&#39;, Decimal(&#39;4.51&#39;), 2)]
</pre></div>
</div><span id="outerjoin-method" class="anchor-target"></span><h3 class="heading">outerjoin() method <a class="header-link" href="#outerjoin-method">#</a></h3>

<p>The <code>outerjoin()</code> method works just like <code>join()</code> but creates <code>LEFT OUTER JOIN</code>. </p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>        
    <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
    <span class="n">Order</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(&#39;John&#39;, 1),
 (&#39;John&#39;, 2),
 (&#39;John&#39;, 3),
 (&#39;Katherine&#39;, None),
 (&#39;Toby&#39;, None),
 (&#39;Scott&#39;, None),
 (&#39;Sarah&#39;, None),
 (&#39;John&#39;, None)]
</pre></div>
</td></tr></tbody></table></div>
<p>In this query, the left table is the <code>customers</code> table. Thus, it will return all the rows from <code>customers</code> table (the left table), and only the rows that meet the join condition are returned from the <code>orders</code> table (the right table).</p>

<p>You can also create a <code>FULL OUTER JOIN</code> by passing <code>full=True</code> to <code>outerjoin()</code> method. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>        
    <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
    <span class="n">Order</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">Order</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(&#39;John&#39;, 1),
 (&#39;John&#39;, 2),
 (&#39;John&#39;, 3),
 (&#39;Katherine&#39;, None),
 (&#39;Toby&#39;, None),
 (&#39;Scott&#39;, None),
 (&#39;Sarah&#39;, None),
 (&#39;John&#39;, None)]
</pre></div>
</td></tr></tbody></table></div><span id="group_by-method" class="anchor-target"></span><h3 class="heading">group_by() method <a class="header-link" href="#group_by-method">#</a></h3>

<p>We group results using the <code>group_by()</code> method. It accepts one or more columns and groups the rows according to the values in the column.</p>

<p>The following query uses <code>join()</code> and <code>group_by()</code> to count the number of orders made by john green.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s1">&#39;Green&#39;</span><span class="p">,</span>    
<span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>3
</pre></div>
</div><span id="having-method" class="anchor-target"></span><h3 class="heading">having() method <a class="header-link" href="#having-method">#</a></h3>

<p>To filter out the results based on the values returned by aggregate functions we use <code>having()</code> method which adds the <code>HAVING</code> clause to the <code>SELECT</code> statement. Just like the <code>where()</code> clause, it accepts a condition.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># find the number of customers lives in each town</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;town_count&#39;</span><span class="p">),</span>    
    <span class="n">Customer</span><span class="o">.</span><span class="n">town</span>
<span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">town</span><span class="p">)</span><span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>[(3, &#39;Norfolk&#39;)]
</pre></div>
</div><span id="dealing-with-duplicates" class="anchor-target"></span><h2 class="heading">Dealing with Duplicates <a class="header-link" href="#dealing-with-duplicates">#</a></h2>

<p>To deal with the duplicate rows in the result set we use the <code>DISTINCT</code> option. We can add <code>DISTINCT</code> option to the <code>SELECT</code> statement using the <code>distinct()</code> method. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">distinct</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">town</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span>  <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">town</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">id</span>  <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>        
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">town</span><span class="p">)),</span>
    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">town</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(&#39;Norfolk&#39;),
 (&#39;Peterbrugh&#39;),
 (&#39;Norfolk&#39;),
 (&#39;Norfolk&#39;),
 (&#39;Wolfden&#39;),
 (&#39;Beckinsdale&#39;)]

[(&#39;Peterbrugh&#39;), (&#39;Beckinsdale&#39;), (&#39;Wolfden&#39;), (&#39;Norfolk&#39;)]

[(4, 6)]
</pre></div>
</td></tr></tbody></table></div><span id="casting" class="anchor-target"></span><h2 class="heading">Casting <a class="header-link" href="#casting">#</a></h2>

<p>Casting (converting) data from one type to another is a common operation and is done via <code>cast()</code> function from the <code>sqlalchemy</code> package.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Date</span><span class="p">,</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">union</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="n">cast</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">pi</span><span class="p">(),</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">cast</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">pi</span><span class="p">(),</span> <span class="n">Numeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span>
    <span class="n">cast</span><span class="p">(</span><span class="s2">&#34;2010-12-01&#34;</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">),</span>
    <span class="n">cast</span><span class="p">(</span><span class="s2">&#34;2010-12-01&#34;</span><span class="p">,</span> <span class="n">Date</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(3,
  Decimal(&#39;3.14&#39;),
  datetime.datetime(2010, 12, 1, 0, 0),
  datetime.date(2010, 12, 1))]
</pre></div>
</td></tr></tbody></table></div><span id="unions" class="anchor-target"></span><h2 class="heading">Unions <a class="header-link" href="#unions">#</a></h2>

<p>To union queries we use the <code>union()</code> method of the <code>Query</code> object. It takes one or more queries. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">s1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;Wa%&#34;</span><span class="p">))</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%e</span><span class="s2">%&#34;</span><span class="p">))</span>
<span class="n">s1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(2, &#39;Pen&#39;),
 (4, &#39;Travel Bag&#39;),
 (3, &#39;Headphone&#39;),
 (5, &#39;Keyboard&#39;),
 (7, &#39;Watch&#39;),
 (8, &#39;Water Bottle&#39;)]
</pre></div>
</td></tr></tbody></table></div>
<p>By default, <code>union()</code> removes all the duplicate rows from the result set. If you want to keep the duplicates use <code>union_all()</code>.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="o">.</span><span class="n">union_all</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[(7, &#39;Watch&#39;),
 (8, &#39;Water Bottle&#39;),
 (2, &#39;Pen&#39;),
 (3, &#39;Headphone&#39;),
 (4, &#39;Travel Bag&#39;),
 (5, &#39;Keyboard&#39;),
 (8, &#39;Water Bottle&#39;)]
</pre></div>
</td></tr></tbody></table></div><span id="updating-data" class="anchor-target"></span><h2 class="heading">Updating Data <a class="header-link" href="#updating-data">#</a></h2>

<p>To update an object simply set its attribute to a new value, add the object to the session and commit the changes.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">i</span><span class="o">.</span><span class="n">selling_price</span> <span class="o">=</span> <span class="mf">25.91</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p>This way we can only update a single object at a time. To update multiple rows at once use <code>update()</code> method of the <code>Query</code> object. It returns the total number of records updated. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># update quantity of all quantity of items to 60 whose name starts with &#39;W&#39;</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;W%&#34;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">60</span><span class="p">},</span> <span class="n">synchronize_session</span><span class="o">=</span><span class="s1">&#39;fetch&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>2
</pre></div>
</div><span id="deleting-data" class="anchor-target"></span><h2 class="heading">Deleting Data <a class="header-link" href="#deleting-data">#</a></h2>

<p>To delete an object use the <code>delete()</code> method of the session object. It accepts an object and marks it to be deleted in the next commit.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Monitor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="n">i</span>
<span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>&lt;Item:6-Monitor&gt;
</pre></div>
</div>
<p>This commit removes the <code>Monitor</code> from the <code>items</code> table.</p>

<p>To delete multiple records at once use the <code>delete()</code> method of the <code>Query</code> object.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="s2">&#34;W%&#34;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">synchronize_session</span><span class="o">=</span><span class="s1">&#39;fetch&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
<p>This commit deletes all the items whose name start with <code>W</code>.</p>
<span id="raw-queries" class="anchor-target"></span><h2 class="heading">Raw Queries <a class="header-link" href="#raw-queries">#</a></h2>

<p>ORM also give you the flexibility to directly to use directly use SQL using the <code>text()</code> function. For example:</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">text</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&#34;first_name = &#39;John&#39;&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&#34;town like &#39;Nor%&#39;&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&#34;town like &#39;Nor%&#39;&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&#34;first_name, id desc&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table></div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[&lt;Customer:1-johngreen&gt;, &lt;Customer:3-johnlara&gt;]

[&lt;Customer:1-johngreen&gt;, &lt;Customer:3-johnlara&gt;, &lt;Customer:4-sarahtomlin&gt;]

[&lt;Customer:3-johnlara&gt;, &lt;Customer:1-johngreen&gt;, &lt;Customer:4-sarahtomlin&gt;]
</pre></div>
</td></tr></tbody></table></div><span id="transactions" class="anchor-target"></span><h2 class="heading">Transactions <a class="header-link" href="#transactions">#</a></h2>

<p>A transaction is a way to execute a set of SQL statements such that either all of the statements are executed successfully or nothing at all. If any of the statement involved in the transaction fails then the database is returned to the state it was in before the transaction was initiated.</p>

<p>We currently have two orders in the database. The process of dispatching the order is as follows:</p>

<ol>
<li>Set the shipping date in the <code>date_shipped</code> column in <code>orders</code> table</li>
<li>Subtract the quantity of ordered items from the <code>items</code> table</li>
</ol>

<p>Both of these actions must be performed as a unit to ensure that the data in the tables are correct.</p>

<p>In the following listing, we define <code>dispatch_order()</code> method which accepts <code>order_id</code> as an argument, and performs the above-mentioned tasks in a transaction.</p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">update</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">IntegrityError</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<span class="k">def</span> <span class="nf">dispatch_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">):</span>

    <span class="c1"># check whether order_id is valid or not</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">order</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;Invalid order id: {}.&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">order_id</span><span class="p">))</span>    
        
    <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">date_shipped</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Order already shipped.&#34;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">order_lines</span><span class="p">:</span>
            <span class="n">i</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">quantity</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">quantity</span>            
        
        <span class="n">order</span><span class="o">.</span><span class="n">date_shipped</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>                            
        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Transaction completed.&#34;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Rolling back ...&#34;</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Transaction failed.&#34;</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div>
<p>Our first order is for 3 chairs and 2 pens. Calling <code>dispatch_order()</code> function with order id of <code>1</code>, will return the following output:</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">dispatch_order</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-text"><div class="highlight"><pre><span></span>Transaction completed.
</pre></div>
</div>
<p>At this point, <code>items</code> and <code>order_lines</code> tables should look like this:</p>

<p>[]</p>

<p>[]</p>

<p>Our next order is for 1 chair and 4 pens, but we now only have 3 pens in the stock!</p>

<p>Let&#39;s try running <code>dispatch_order()</code> for second order and see what happens.</p>
<div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">dispatch_order</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="codeblock language-python"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">)</span> <span class="n">new</span> <span class="n">row</span> <span class="k">for</span> <span class="n">relation</span> <span class="s2">&#34;items&#34;</span> <span class="n">violates</span> <span class="n">check</span> <span class="n">constraint</span> <span class="s2">&#34;quantity_check&#34;</span>
<span class="n">DETAIL</span><span class="p">:</span>  <span class="n">Failing</span> <span class="n">row</span> <span class="n">contains</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Pen</span><span class="p">,</span> <span class="mf">3.45</span><span class="p">,</span> <span class="mf">4.51</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span>
 <span class="p">[</span><span class="n">SQL</span><span class="p">:</span> <span class="s1">&#39;UPDATE items SET quantity=</span><span class="si">%(quantity)s</span><span class="s1"> WHERE items.id = </span><span class="si">%(items_id)s</span><span class="s1">&#39;</span><span class="p">]</span> <span class="p">[</span><span class="n">parameters</span><span class="p">:</span> <span class="p">({</span><span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;items_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;items_id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})]</span> <span class="p">(</span><span class="n">Background</span> <span class="n">on</span> <span class="n">this</span> <span class="n">error</span> <span class="n">at</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sqlalche</span><span class="o">.</span><span class="n">me</span><span class="o">/</span><span class="n">e</span><span class="o">/</span><span class="n">gkpj</span><span class="p">)</span>
<span class="n">Rolling</span> <span class="n">back</span> <span class="o">...</span>
<span class="n">Transaction</span> <span class="n">failed</span><span class="o">.</span>
</pre></div>
</td></tr></tbody></table></div>
<p>As expected, our shipment failed because we don&#39;t have enough pens in the stock and because we are using transaction our database is returned to the state it was in before the transaction was started.</p>

<p>I hope this tutorial would be informative for you. If you have encountered any typo or error. Get in touch using the contact page or comment box below.</p>



    



        <nav aria-label="pagination">
            <ul class="pager">
                
                    <li class="previous">
                        <a href="../defining-schema-in-sqlalchemy-orm/index.html" title="Defining Schema in SQLAlchemy ORM">
                            <span class="fa fa-arrow-left" aria-hidden="true"></span>
                            Defining Schema in SQLAlchemy ORM
                        </a>
                    </li>
                

                
            </ul>
        </nav>







    <hr/>
    <div id="disqus_thread">
    <p style="margin-bottom: 10px" class="text-center">
        <a href="#" class=" btn btn-primary comments-holder" onclick="loadDisqus();return false;">
            <i class="fa fa-comments" aria-hidden="true"></i> Load Comments
        </a>
    </p>
    </div>
    <hr/>
    <script>
        var is_disqus_loaded = false;
        function loadDisqus() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '../../../overiqcom.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        };
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>







            </div>
        </div>


        <div class="sidebar">
        
            <div class="col-lg-4 col-md-4 col-sm-12">
                

    
        
    <div class="well">
        <h4>SQLAlchemy Tutorial</h4>
        <ul>
            
                <li><a href="../intro-to-sqlalchemy/index.html">Intro to SqlAlchemy</a></li>
            
                <li><a href="../installing-sqlalchemy-and-connecting-to-database/index.html">Installing SQLAlchemy and connecting to database</a></li>
            
                <li><a href="../defining-schema-in-sqlalchemy-core/index.html">Defining Schema in SQLAlchemy Core</a></li>
            
                <li><a href="../crud-using-sqlalchemy-core/index.html">CRUD using SQLAlchemy Core</a></li>
            
                <li><a href="../defining-schema-in-sqlalchemy-orm/index.html">Defining Schema in SQLAlchemy ORM</a></li>
            
                <li><a href="index.html">CRUD using SQLAlchemy ORM</a></li>
            
        </ul>
    </div>

    

    
        

<div class="well">
    <h4>Recent Posts</h4>
    <ul>
        
            <li><a href="../../machine-learning-experts-you-should-be-following-online/index.html">Machine Learning Experts You Should Be Following Online</a></li>
        
            <li><a href="../../4-ways-to-prepare-for-the-ap-computer-science-a-exam/index.html">4 Ways to Prepare for the AP Computer Science A Exam</a></li>
        
            <li><a href="../../finance-assignment-online-help-for-the-busy-and-tired-students-get-help-from-experts/index.html">Finance Assignment Online Help for the Busy and Tired Students: Get Help from Experts</a></li>
        
            <li><a href="../../top-9-machine-learning-algorithms-for-data-scientists/index.html">Top 9 Machine Learning Algorithms for Data Scientists</a></li>
        
            <li><a href="../../data-science-learning-path-or-steps-to-become-a-data-scientist-final/index.html">Data Science Learning Path or Steps to become a data scientist Final</a></li>
        
            <li><a href="../../enable-edit-button-in-shutter-in-linux-mint-19-and-ubuntu-18-04/index.html">Enable Edit Button in Shutter In Linux Mint 19 and Ubuntu 18.04</a></li>
        
            <li><a href="../../python-3-time-module/index.html">Python 3 time module</a></li>
        
            <li><a href="../../pygments-tutorial/index.html">Pygments Tutorial</a></li>
        
            <li><a href="../../how-to-use-virtualenv/index.html">How to use Virtualenv?</a></li>
        
            <li><a href="../../installing-mysql-windows-linux-and-mac/index.html">Installing MySQL (Windows, Linux and Mac)</a></li>
        
            <li><a href="../../what-is-if-__name__-__main__-in-python/index.html">What is if __name__ == &#39;__main__&#39;  in Python ?</a></li>
        
            <li><a href="../../installing-goaccess-a-real-time-web-log-analyzer/index.html">Installing GoAccess (A Real-time web log analyzer)</a></li>
        
            <li><a href="../../installing-isso/index.html">Installing Isso</a></li>
        
    </ul>
</div>

<!-- Blog Search Well -->





















    



            </div>
        </div>
    </div>



    

</div>

<!-- Footer -->
<footer class="overiq-footer">
    <div class="container">
        <div class="row">

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../terms-of-use/index.html">Terms</a></li>
                    <li><a href="../../privacy-policy/index.html">Privacy Policy</a></li>
                    <li><a href="../../sitemap.xml/index.html">Sitemap</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../contact/index.html">Contact</a></li>
                    <li><a href="../../blog/index.html">Blog</a></li>
                </ul>

            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="https://www.facebook.com/OverIQ/">Facebook</a></li>
                    <li><a href="https://twitter.com/infoOverIQ">Twitter</a></li>
                    <li><a href="https://github.com/overiq">Github</a></li>
                </ul>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 overiq-footer-links">
                <ul>
                    <li><a href="../../c-programming-101/index.html">C Tutorial</a></li>
                    <li><a href="../../python-101/index.html">Python Tutorial</a></li>
                    <li><a href="../../django-1-11/index.html">Django Tutorial</a></li>
                    <li><a href="../../flask-101/index.html">Flask Tutorial</a></li>
                    <li><a href="../../mysql-connector-python-101/index.html">MySQL Connector/Python Tutorial</a></li>
                    <li><a href="../index.html">SQLAlchemy Tutorial</a></li>
                    <li><a href="../../c-examples/index.html">C Programming Examples</a></li>
                </ul>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <div class="row text-center">
            <p>© 2025 OverIQ.com</p>
            <small><a href="#">Back to top</a></small>
        </div>

        <!-- /.row -->
    </div>
</footer>



<script type="text/javascript" src="../../static/CACHE/js/output.2e0ff002c1a4.js"></script>




<script async="" src="../../../cdn.jsdelivr.net/npm/cookieconsent%403/build/cookieconsent.min.js" data-cfasync="false"></script>

<script>

    
    window.addEventListener('load', function () {
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#5ca9e0",
                    "text": "#ffffff"
                },
                "button": {
                    "background": "#fff",
                    "text": "#237afc"
                }
            },
            "theme": "classic",
            "position": "top",
            "static": true,
            "content": {
                "href": "https://overiq.com/privacy-policy/"
            }
        });
    });


</script>

<script src="../../../polyfill.io/v3/polyfill.min1162.js?features=es6"></script>
<script id="MathJax-script" defer="" src="../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml.js"></script>

<script async="" type="text/javascript" src="../../../cdn.carbonads.com/carbonfbdb.js?serve=CE7DC53E&amp;placement=overiqcom" id="_carbonads_js"></script>





<script data-cfasync="false">function _emitEzConsentEvent(){var customEvent=new CustomEvent("ezConsentEvent",{detail:{ezTcfConsent:window.ezTcfConsent},bubbles:true,cancelable:true,});document.dispatchEvent(customEvent);}
(function(window,document){function _setAllEzConsentTrue(){window.ezTcfConsent.loaded=true;window.ezTcfConsent.store_info=true;window.ezTcfConsent.develop_and_improve_services=true;window.ezTcfConsent.measure_ad_performance=true;window.ezTcfConsent.measure_content_performance=true;window.ezTcfConsent.select_basic_ads=true;window.ezTcfConsent.create_ad_profile=true;window.ezTcfConsent.select_personalized_ads=true;window.ezTcfConsent.create_content_profile=true;window.ezTcfConsent.select_personalized_content=true;window.ezTcfConsent.understand_audiences=true;window.ezTcfConsent.use_limited_data_to_select_content=true;window.ezTcfConsent.select_personalized_content=true;}
function _clearEzConsentCookie(){document.cookie="ezCMPCookieConsent=tcf2;Domain=.overiq.com;Path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT";}
_clearEzConsentCookie();if(typeof window.__tcfapi!=="undefined"){window.ezgconsent=false;var amazonHasRun=false;function _ezAllowed(tcdata,purpose){return(tcdata.purpose.consents[purpose]||tcdata.purpose.legitimateInterests[purpose]);}
function _handleConsentDecision(tcdata){window.ezTcfConsent.loaded=true;if(!tcdata.vendor.consents["347"]&&!tcdata.vendor.legitimateInterests["347"]){window._emitEzConsentEvent();return;}
window.ezTcfConsent.store_info=_ezAllowed(tcdata,"1");window.ezTcfConsent.develop_and_improve_services=_ezAllowed(tcdata,"10");window.ezTcfConsent.measure_content_performance=_ezAllowed(tcdata,"8");window.ezTcfConsent.select_basic_ads=_ezAllowed(tcdata,"2");window.ezTcfConsent.create_ad_profile=_ezAllowed(tcdata,"3");window.ezTcfConsent.select_personalized_ads=_ezAllowed(tcdata,"4");window.ezTcfConsent.create_content_profile=_ezAllowed(tcdata,"5");window.ezTcfConsent.measure_ad_performance=_ezAllowed(tcdata,"7");window.ezTcfConsent.use_limited_data_to_select_content=_ezAllowed(tcdata,"11");window.ezTcfConsent.select_personalized_content=_ezAllowed(tcdata,"6");window.ezTcfConsent.understand_audiences=_ezAllowed(tcdata,"9");window._emitEzConsentEvent();}
function _handleGoogleConsentV2(tcdata){if(!tcdata||!tcdata.purpose||!tcdata.purpose.consents){return;}
var googConsentV2={};if(tcdata.purpose.consents[1]){googConsentV2.ad_storage='granted';googConsentV2.analytics_storage='granted';}
if(tcdata.purpose.consents[3]&&tcdata.purpose.consents[4]){googConsentV2.ad_personalization='granted';}
if(tcdata.purpose.consents[1]&&tcdata.purpose.consents[7]){googConsentV2.ad_user_data='granted';}
if(googConsentV2.analytics_storage=='denied'){gtag('set','url_passthrough',true);}
gtag('consent','update',googConsentV2);}
__tcfapi("addEventListener",2,function(tcdata,success){if(!success||!tcdata){window._emitEzConsentEvent();return;}
if(!tcdata.gdprApplies){_setAllEzConsentTrue();window._emitEzConsentEvent();return;}
if(tcdata.eventStatus==="useractioncomplete"||tcdata.eventStatus==="tcloaded"){if(typeof gtag!='undefined'){_handleGoogleConsentV2(tcdata);}
_handleConsentDecision(tcdata);if(tcdata.purpose.consents["1"]===true&&tcdata.vendor.consents["755"]!==false){window.ezgconsent=true;(adsbygoogle=window.adsbygoogle||[]).pauseAdRequests=0;}
if(window.__ezconsent){__ezconsent.setEzoicConsentSettings(ezConsentCategories);}
__tcfapi("removeEventListener",2,function(success){return null;},tcdata.listenerId);if(!(tcdata.purpose.consents["1"]===true&&_ezAllowed(tcdata,"2")&&_ezAllowed(tcdata,"3")&&_ezAllowed(tcdata,"4"))){if(typeof __ez=="object"&&typeof __ez.bit=="object"&&typeof window["_ezaq"]=="object"&&typeof window["_ezaq"]["page_view_id"]=="string"){__ez.bit.Add(window["_ezaq"]["page_view_id"],[new __ezDotData("non_personalized_ads",true),]);}}}});}else{_setAllEzConsentTrue();window._emitEzConsentEvent();}})(window,document);</script></body>
<!-- Mirrored from overiq.com/sqlalchemy-101/crud-using-sqlalchemy-orm/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Feb 2025 11:16:16 GMT -->
</html>